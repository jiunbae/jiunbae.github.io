{"version":3,"file":"7954-787b70a78e77bc34e68e.js","mappings":"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","sources":["webpack://jiunbae.github.io/./src/views/AudioVisualizer/scene.ts"],"sourcesContent":["import * as THREE from 'three'\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js'\nimport { EffectComposer } from 'three/examples/jsm/postprocessing/EffectComposer.js'\nimport { RenderPass } from 'three/examples/jsm/postprocessing/RenderPass.js'\nimport { UnrealBloomPass } from 'three/examples/jsm/postprocessing/UnrealBloomPass.js'\n\nexport type VisualizationMode = 'terrain' | 'radial' | 'waveform'\n\nexport class AudioVisualizerScene {\n  private renderer!: THREE.WebGLRenderer\n  private scene!: THREE.Scene\n  private camera!: THREE.PerspectiveCamera\n  private controls!: OrbitControls\n  private composer!: EffectComposer\n  private bloomPass!: UnrealBloomPass\n  private userBloomStrength = 1.5\n  private clock = new THREE.Clock()\n  private animationId = 0\n  private disposed = false\n\n  // Audio\n  private audioContext: AudioContext | null = null\n  private analyser: AnalyserNode | null = null\n  private sourceNode: AudioBufferSourceNode | MediaStreamAudioSourceNode | null = null\n  private mediaStream: MediaStream | null = null\n  private frequencyData: Uint8Array<ArrayBuffer> = new Uint8Array(0)\n  private timeDomainData: Uint8Array<ArrayBuffer> = new Uint8Array(0)\n  private isPlaying = false\n\n  // Visualization objects\n  private currentMode: VisualizationMode = 'terrain'\n  private terrainMesh: THREE.Mesh | null = null\n  private radialGroup: THREE.Group | null = null\n  private radialBars: THREE.Mesh[] = []\n  private waveformMesh: THREE.Mesh | null = null\n\n  // Camera presets per mode\n  private cameraTargets: Record<VisualizationMode, { pos: THREE.Vector3; target: THREE.Vector3 }> = {\n    terrain: { pos: new THREE.Vector3(0, 12, 18), target: new THREE.Vector3(0, 0, 0) },\n    radial: { pos: new THREE.Vector3(0, 0, 20), target: new THREE.Vector3(0, 0, 0) },\n    waveform: { pos: new THREE.Vector3(0, 5, 16), target: new THREE.Vector3(0, 0, 0) }\n  }\n\n  // Public properties\n  private _autoRotate = true\n\n  get autoRotate(): boolean {\n    return this._autoRotate\n  }\n\n  set autoRotate(value: boolean) {\n    this._autoRotate = value\n    if (this.controls) this.controls.autoRotate = value\n  }\n\n  get bloomStrength(): number {\n    return this.bloomPass?.strength ?? 1.5\n  }\n\n  set bloomStrength(value: number) {\n    this.userBloomStrength = value\n    if (this.bloomPass) this.bloomPass.strength = value\n  }\n\n  constructor(private container: HTMLDivElement) {\n    this.init()\n    this.buildTerrain()\n    this.buildRadial()\n    this.buildWaveform()\n    this.setMode('terrain')\n    this.animate()\n  }\n\n  private init() {\n    const { clientWidth: w, clientHeight: h } = this.container\n\n    // Renderer\n    this.renderer = new THREE.WebGLRenderer({ antialias: true, alpha: false })\n    this.renderer.setSize(w, h)\n    this.renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2))\n    this.renderer.toneMapping = THREE.ACESFilmicToneMapping\n    this.renderer.toneMappingExposure = 1.0\n    this.container.appendChild(this.renderer.domElement)\n\n    this.renderer.domElement.addEventListener('webglcontextlost', this.handleContextLost)\n    this.renderer.domElement.addEventListener('webglcontextrestored', this.handleContextRestored)\n\n    // Scene\n    this.scene = new THREE.Scene()\n    this.scene.background = new THREE.Color(0x080810)\n    this.scene.fog = new THREE.FogExp2(0x080810, 0.012)\n\n    // Camera\n    this.camera = new THREE.PerspectiveCamera(60, w / h, 0.1, 200)\n    this.camera.position.set(0, 12, 18)\n\n    // Controls\n    this.controls = new OrbitControls(this.camera, this.renderer.domElement)\n    this.controls.enableDamping = true\n    this.controls.dampingFactor = 0.05\n    this.controls.autoRotate = this._autoRotate\n    this.controls.autoRotateSpeed = 0.3\n    this.controls.minDistance = 5\n    this.controls.maxDistance = 60\n\n    // Post-processing\n    this.composer = new EffectComposer(this.renderer)\n    this.composer.addPass(new RenderPass(this.scene, this.camera))\n    this.bloomPass = new UnrealBloomPass(new THREE.Vector2(w, h), 1.5, 0.6, 0.15)\n    this.composer.addPass(this.bloomPass)\n\n    // Lights\n    const ambient = new THREE.AmbientLight(0x222244, 0.6)\n    this.scene.add(ambient)\n\n    const dirLight = new THREE.DirectionalLight(0xffffff, 0.4)\n    dirLight.position.set(10, 20, 10)\n    this.scene.add(dirLight)\n\n    // Resize\n    window.addEventListener('resize', this.onResize)\n  }\n\n  // --- Audio setup ---\n\n  private ensureAudioContext() {\n    if (this.disposed) return\n    if (!this.audioContext || this.audioContext.state === 'closed') {\n      this.audioContext = new AudioContext()\n    }\n    if (this.audioContext.state === 'suspended') {\n      this.audioContext.resume()\n    }\n    return this.audioContext\n  }\n\n  private setupAnalyser(source: AudioNode) {\n    const ctx = this.ensureAudioContext()\n    if (!ctx) return\n    this.analyser = ctx.createAnalyser()\n    this.analyser.fftSize = 2048\n    this.analyser.smoothingTimeConstant = 0.8\n    source.connect(this.analyser)\n    this.analyser.connect(ctx.destination)\n    this.frequencyData = new Uint8Array(this.analyser.frequencyBinCount)\n    this.timeDomainData = new Uint8Array(this.analyser.fftSize)\n    this.isPlaying = true\n  }\n\n  async loadAudioFile(file: File) {\n    this.stopAudio()\n    const ctx = this.ensureAudioContext()\n    if (!ctx) return\n    const arrayBuffer = await file.arrayBuffer()\n    const audioBuffer = await ctx.decodeAudioData(arrayBuffer)\n\n    const source = ctx.createBufferSource()\n    source.buffer = audioBuffer\n    source.loop = true\n    this.sourceNode = source\n    this.setupAnalyser(source)\n    // Disconnect analyser from destination for file playback and reconnect properly\n    // analyser is already connected in setupAnalyser\n    source.start(0)\n  }\n\n  async startMic() {\n    this.stopAudio()\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia({ audio: true })\n      this.mediaStream = stream\n      const ctx = this.ensureAudioContext()\n      if (!ctx) return\n      const source = ctx.createMediaStreamSource(stream)\n      this.sourceNode = source\n\n      // For mic, don't connect analyser to destination to avoid feedback\n      this.analyser = ctx.createAnalyser()\n      this.analyser.fftSize = 2048\n      this.analyser.smoothingTimeConstant = 0.8\n      source.connect(this.analyser)\n      this.frequencyData = new Uint8Array(this.analyser.frequencyBinCount)\n      this.timeDomainData = new Uint8Array(this.analyser.fftSize)\n      this.isPlaying = true\n    } catch (err) {\n      console.error('Microphone access denied:', err)\n      throw err\n    }\n  }\n\n  stopAudio() {\n    this.isPlaying = false\n    if (this.sourceNode) {\n      try {\n        this.sourceNode.disconnect()\n        if (this.sourceNode instanceof AudioBufferSourceNode) {\n          this.sourceNode.stop()\n        }\n      } catch {\n        // already stopped\n      }\n      this.sourceNode = null\n    }\n    if (this.mediaStream) {\n      this.mediaStream.getTracks().forEach(t => t.stop())\n      this.mediaStream = null\n    }\n    if (this.analyser) {\n      try {\n        this.analyser.disconnect()\n      } catch {\n        // already disconnected\n      }\n      this.analyser = null\n    }\n    this.frequencyData = new Uint8Array(0)\n    this.timeDomainData = new Uint8Array(0)\n  }\n\n  // --- Visualization modes ---\n\n  setMode(mode: VisualizationMode) {\n    this.currentMode = mode\n\n    // Toggle visibility\n    if (this.terrainMesh) this.terrainMesh.visible = mode === 'terrain'\n    if (this.radialGroup) this.radialGroup.visible = mode === 'radial'\n    if (this.waveformMesh) this.waveformMesh.visible = mode === 'waveform'\n\n    // Animate camera to preset\n    const preset = this.cameraTargets[mode]\n    this.camera.position.copy(preset.pos)\n    this.controls.target.copy(preset.target)\n    this.controls.update()\n  }\n\n  // --- Build visualizations ---\n\n  private buildTerrain() {\n    const segments = 128\n    const size = 40\n    const geometry = new THREE.PlaneGeometry(size, size, segments - 1, segments - 1)\n    geometry.rotateX(-Math.PI / 2)\n\n    const material = new THREE.ShaderMaterial({\n      vertexColors: true,\n      wireframe: true,\n      transparent: true,\n      uniforms: {\n        uOpacity: { value: 0.85 }\n      },\n      vertexShader: `\n        attribute vec3 customColor;\n        varying vec3 vColor;\n        void main() {\n          vColor = customColor;\n          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }\n      `,\n      fragmentShader: `\n        uniform float uOpacity;\n        varying vec3 vColor;\n        void main() {\n          gl_FragColor = vec4(vColor, uOpacity);\n        }\n      `\n    })\n\n    // Initialize color attribute\n    const count = geometry.attributes.position.count\n    const colors = new Float32Array(count * 3)\n    for (let i = 0; i < count; i++) {\n      colors[i * 3] = 0.0\n      colors[i * 3 + 1] = 0.1\n      colors[i * 3 + 2] = 0.4\n    }\n    geometry.setAttribute('customColor', new THREE.BufferAttribute(colors, 3))\n\n    this.terrainMesh = new THREE.Mesh(geometry, material)\n    this.scene.add(this.terrainMesh)\n  }\n\n  private buildRadial() {\n    this.radialGroup = new THREE.Group()\n    this.radialBars = []\n    const barCount = 128\n    const radius = 8\n\n    for (let i = 0; i < barCount; i++) {\n      const angle = (i / barCount) * Math.PI * 2\n      const geometry = new THREE.BoxGeometry(0.25, 1, 0.25)\n      // Shift geometry pivot to bottom\n      geometry.translate(0, 0.5, 0)\n\n      const hue = i / barCount\n      const color = new THREE.Color().setHSL(hue, 1.0, 0.5)\n      const material = new THREE.MeshStandardMaterial({\n        color,\n        emissive: color,\n        emissiveIntensity: 0.6,\n        roughness: 0.3,\n        metalness: 0.5\n      })\n\n      const bar = new THREE.Mesh(geometry, material)\n      bar.position.x = Math.cos(angle) * radius\n      bar.position.z = Math.sin(angle) * radius\n      bar.lookAt(0, 0, 0)\n      bar.rotateX(Math.PI / 2)\n\n      this.radialBars.push(bar)\n      this.radialGroup.add(bar)\n    }\n\n    this.scene.add(this.radialGroup)\n  }\n\n  private buildWaveform() {\n    // Create a flat ribbon that will be deformed by waveform data\n    const lengthSegments = 256\n    const widthSegments = 4\n    const geometry = new THREE.PlaneGeometry(30, 3, lengthSegments, widthSegments)\n\n    const material = new THREE.ShaderMaterial({\n      side: THREE.DoubleSide,\n      transparent: true,\n      uniforms: {\n        uTime: { value: 0 },\n        uIntensity: { value: 1.0 }\n      },\n      vertexShader: `\n        varying vec2 vUv;\n        varying float vDisplacement;\n        void main() {\n          vUv = uv;\n          vDisplacement = position.y;\n          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }\n      `,\n      fragmentShader: `\n        uniform float uTime;\n        uniform float uIntensity;\n        varying vec2 vUv;\n        varying float vDisplacement;\n        void main() {\n          float d = abs(vDisplacement) * 0.5;\n          vec3 col1 = vec3(0.1, 0.3, 1.0);\n          vec3 col2 = vec3(1.0, 0.2, 0.8);\n          vec3 col3 = vec3(0.0, 1.0, 0.6);\n          vec3 color = mix(col1, col2, d);\n          color = mix(color, col3, sin(vUv.x * 6.28 + uTime) * 0.3 + 0.3);\n          float glow = exp(-d * 2.0) * uIntensity;\n          color += glow * 0.4;\n          float alpha = 0.6 + glow * 0.4;\n          gl_FragColor = vec4(color, alpha);\n        }\n      `\n    })\n\n    this.waveformMesh = new THREE.Mesh(geometry, material)\n    this.scene.add(this.waveformMesh)\n  }\n\n  // --- Update visualizations ---\n\n  private updateTerrain() {\n    if (!this.terrainMesh || this.frequencyData.length === 0) return\n    const geometry = this.terrainMesh.geometry\n    const positions = geometry.attributes.position\n    const colors = geometry.attributes.customColor as THREE.BufferAttribute\n    const segments = 128\n    const freqBins = this.frequencyData.length\n\n    // Sample frequency data to fill 128 columns\n    for (let ix = 0; ix < segments; ix++) {\n      const freqIndex = Math.floor((ix / segments) * Math.min(freqBins, 512))\n      const amplitude = (this.frequencyData[freqIndex] || 0) / 255\n\n      for (let iz = 0; iz < segments; iz++) {\n        const vertexIndex = iz * segments + ix\n        // Displace Y\n        const dist = Math.abs(iz - segments / 2) / (segments / 2)\n        const falloff = 1.0 - dist * dist\n        const y = amplitude * 8 * falloff\n\n        positions.setY(vertexIndex, y)\n\n        // Color by height\n        const t = amplitude * falloff\n        // Low=blue(0,0.3,1) mid=green(0,1,0.3) high=red(1,0.2,0)\n        let r: number, g: number, b: number\n        if (t < 0.5) {\n          const s = t / 0.5\n          r = s * 0.0\n          g = 0.3 + s * 0.7\n          b = 1.0 - s * 0.7\n        } else {\n          const s = (t - 0.5) / 0.5\n          r = s * 1.0\n          g = 1.0 - s * 0.8\n          b = 0.3 - s * 0.3\n        }\n        colors.setXYZ(vertexIndex, r, g, b)\n      }\n    }\n    positions.needsUpdate = true\n    colors.needsUpdate = true\n  }\n\n  private updateRadial() {\n    if (!this.radialGroup || this.frequencyData.length === 0) return\n    const barCount = this.radialBars.length\n    const freqBins = this.frequencyData.length\n\n    for (let i = 0; i < barCount; i++) {\n      const freqIndex = Math.floor((i / barCount) * Math.min(freqBins, 512))\n      const amplitude = (this.frequencyData[freqIndex] || 0) / 255\n      const scaleY = 0.2 + amplitude * 12\n      this.radialBars[i].scale.y = scaleY\n\n      // Update emissive intensity based on amplitude\n      const mat = this.radialBars[i].material as THREE.MeshStandardMaterial\n      mat.emissiveIntensity = 0.3 + amplitude * 1.5\n    }\n  }\n\n  private updateWaveform() {\n    if (!this.waveformMesh || this.timeDomainData.length === 0) return\n    const geometry = this.waveformMesh.geometry\n    const positions = geometry.attributes.position\n    const count = positions.count\n    const lengthSegments = 257 // PlaneGeometry(_, _, 256, 4) => 257 cols, 5 rows\n    const widthSegments = 5\n\n    for (let ix = 0; ix < lengthSegments; ix++) {\n      const dataIndex = Math.floor((ix / lengthSegments) * this.timeDomainData.length)\n      const sample = ((this.timeDomainData[dataIndex] || 128) - 128) / 128\n\n      for (let iy = 0; iy < widthSegments; iy++) {\n        const vertexIndex = iy * lengthSegments + ix\n        if (vertexIndex >= count) continue\n        // Center rows get full displacement, edges taper\n        const rowT = Math.abs(iy - 2) / 2\n        const taper = 1.0 - rowT\n        positions.setY(vertexIndex, sample * 4 * taper)\n\n        // Add subtle Z depth undulation\n        const z = Math.sin(ix * 0.05 + this.clock.getElapsedTime() * 0.5) * 2 * taper\n        positions.setZ(vertexIndex, (iy - 2) * 0.6 + z * 0.3)\n      }\n    }\n    positions.needsUpdate = true\n  }\n\n  // --- Animation loop ---\n\n  private handleContextLost = (e: Event) => {\n    e.preventDefault()\n    cancelAnimationFrame(this.animationId)\n    const overlay = document.createElement('div')\n    overlay.style.cssText = 'position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.8);color:#fff;font:14px/1.5 sans-serif;cursor:pointer;z-index:100'\n    overlay.textContent = 'WebGL context lost â€” click to reload'\n    overlay.addEventListener('click', () => location.reload())\n    this.container.style.position = 'relative'\n    this.container.appendChild(overlay)\n  }\n\n  private handleContextRestored = () => {\n    location.reload()\n  }\n\n  private animate = () => {\n    if (this.disposed) return\n    this.animationId = requestAnimationFrame(this.animate)\n\n    const elapsed = this.clock.getElapsedTime()\n\n    // Read audio data\n    if (this.isPlaying && this.analyser) {\n      this.analyser.getByteFrequencyData(this.frequencyData)\n      this.analyser.getByteTimeDomainData(this.timeDomainData)\n    }\n\n    // Dynamic bloom based on bass\n    if (this.isPlaying && this.frequencyData.length > 0) {\n      let bassSum = 0\n      const bassBins = Math.min(8, this.frequencyData.length)\n      for (let i = 0; i < bassBins; i++) {\n        bassSum += this.frequencyData[i]\n      }\n      const bassAvg = bassSum / bassBins / 255\n      // Modulate around the user-set strength (use stored value to avoid feedback decay)\n      this.bloomPass.strength = this.userBloomStrength * (0.7 + bassAvg * 0.6)\n    }\n\n    // Update active visualization\n    switch (this.currentMode) {\n      case 'terrain':\n        this.updateTerrain()\n        break\n      case 'radial':\n        this.updateRadial()\n        // Gentle rotation of the radial group\n        if (this.radialGroup) {\n          this.radialGroup.rotation.y += 0.002\n        }\n        break\n      case 'waveform':\n        this.updateWaveform()\n        if (this.waveformMesh) {\n          const mat = this.waveformMesh.material as THREE.ShaderMaterial\n          mat.uniforms.uTime.value = elapsed\n        }\n        break\n    }\n\n    // Gently idle-animate terrain even without audio\n    if (this.currentMode === 'terrain' && !this.isPlaying && this.terrainMesh) {\n      const geo = this.terrainMesh.geometry\n      const pos = geo.attributes.position\n      const cols = geo.attributes.customColor as THREE.BufferAttribute\n      const segments = 128\n      for (let ix = 0; ix < segments; ix++) {\n        for (let iz = 0; iz < segments; iz++) {\n          const vi = iz * segments + ix\n          const y = Math.sin(ix * 0.08 + elapsed * 0.5) * Math.cos(iz * 0.08 + elapsed * 0.3) * 0.5\n          pos.setY(vi, y)\n          const t = (y + 0.5) / 1.0\n          cols.setXYZ(vi, t * 0.2, 0.1 + t * 0.3, 0.4 + (1 - t) * 0.3)\n        }\n      }\n      pos.needsUpdate = true\n      cols.needsUpdate = true\n    }\n\n    this.controls.update()\n    this.composer.render()\n  }\n\n  private onResize = () => {\n    if (this.disposed) return\n    const { clientWidth: w, clientHeight: h } = this.container\n    this.camera.aspect = w / h\n    this.camera.updateProjectionMatrix()\n    this.renderer.setSize(w, h)\n    this.composer.setSize(w, h)\n  }\n\n  dispose() {\n    this.disposed = true\n    cancelAnimationFrame(this.animationId)\n    window.removeEventListener('resize', this.onResize)\n    this.stopAudio()\n    if (this.audioContext && this.audioContext.state !== 'closed') {\n      this.audioContext.close()\n    }\n    this.controls.dispose()\n    this.scene.traverse(child => {\n      if (child instanceof THREE.Mesh) {\n        child.geometry.dispose()\n        if (Array.isArray(child.material)) {\n          child.material.forEach(m => m.dispose())\n        } else {\n          child.material.dispose()\n        }\n      }\n    })\n    this.renderer.domElement.removeEventListener('webglcontextlost', this.handleContextLost)\n    this.renderer.domElement.removeEventListener('webglcontextrestored', this.handleContextRestored)\n    this.renderer.dispose()\n    this.composer.dispose()\n    if (this.renderer.domElement.parentElement) {\n      this.renderer.domElement.parentElement.removeChild(this.renderer.domElement)\n    }\n  }\n}\n"],"names":["AudioVisualizerScene","container","userBloomStrength","clock","THREE","animationId","disposed","audioContext","analyser","sourceNode","mediaStream","frequencyData","Uint8Array","timeDomainData","isPlaying","currentMode","terrainMesh","radialGroup","radialBars","waveformMesh","cameraTargets","terrain","pos","target","radial","waveform","_autoRotate","handleContextLost","e","preventDefault","cancelAnimationFrame","this","overlay","document","createElement","style","cssText","textContent","addEventListener","location","reload","position","appendChild","handleContextRestored","animate","requestAnimationFrame","elapsed","getElapsedTime","getByteFrequencyData","getByteTimeDomainData","length","bassSum","bassBins","Math","min","i","bassAvg","bloomPass","strength","updateTerrain","updateRadial","rotation","y","updateWaveform","material","uniforms","uTime","value","geo","geometry","attributes","cols","customColor","segments","ix","iz","vi","sin","cos","setY","t","setXYZ","needsUpdate","controls","update","composer","render","onResize","clientWidth","w","clientHeight","h","camera","aspect","updateProjectionMatrix","renderer","setSize","init","buildTerrain","buildRadial","buildWaveform","setMode","_proto","prototype","antialias","alpha","setPixelRatio","window","devicePixelRatio","toneMapping","toneMappingExposure","domElement","scene","background","fog","set","OrbitControls","enableDamping","dampingFactor","autoRotate","autoRotateSpeed","minDistance","maxDistance","EffectComposer","addPass","RenderPass","UnrealBloomPass","ambient","add","dirLight","ensureAudioContext","state","AudioContext","resume","setupAnalyser","source","ctx","createAnalyser","fftSize","smoothingTimeConstant","connect","destination","frequencyBinCount","loadAudioFile","async","file","stopAudio","arrayBuffer","audioBuffer","decodeAudioData","createBufferSource","buffer","loop","start","startMic","stream","navigator","mediaDevices","getUserMedia","audio","createMediaStreamSource","err","console","error","disconnect","AudioBufferSourceNode","stop","getTracks","forEach","mode","visible","preset","copy","rotateX","PI","vertexColors","wireframe","transparent","uOpacity","vertexShader","fragmentShader","count","colors","Float32Array","setAttribute","angle","translate","hue","color","setHSL","emissive","emissiveIntensity","roughness","metalness","bar","x","z","lookAt","push","side","uIntensity","positions","freqBins","freqIndex","floor","amplitude","vertexIndex","dist","abs","falloff","r","g","b","s","barCount","scaleY","scale","dataIndex","sample","iy","taper","setZ","dispose","removeEventListener","close","traverse","child","Array","isArray","m","parentElement","removeChild","_createClass","key","get","_this$bloomPass$stren","_this$bloomPass"],"sourceRoot":""}