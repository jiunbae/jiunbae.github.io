{"componentChunkName":"component---src-templates-post-tsx","path":"/posts/home-dev/","result":{"data":{"markdownRemark":{"html":"<h1 id=\"home-lab-네트워크-dmzport-forward에서-tailscale--cloudflare-tunnel로-갈아탄-기록\">Home Lab 네트워크 “DMZ/Port Forward”에서 “Tailscale + Cloudflare Tunnel”로 갈아탄 기록</h1>\n<blockquote>\n<p>목표: <strong>공개 노출은 최소(필요한 것만)</strong>, 나머지는 <strong>전부 private</strong>로.<br>\n결과: Router inbound(Port Forward/DMZ) “0”에 가깝게 만들고, 관리/운영이 쉬워졌다.</p>\n</blockquote>\n<hr>\n<h2 id=\"배경-왜-갈아탔나\">배경: 왜 갈아탔나</h2>\n<p>처음에는 공유기(<code class=\"language-text\">ipTIME</code>)에서 <strong>DMZ + Port Forward</strong>로 외부에서 집 NAS/PC로 들어오게 만들었다. 편리했지만 여러 보안적 문제들이 있음에도 눈감고 10년정도 사용했다. 최근에 Tailscale에 대한 여러 긍정적 이야기를 듣기도 했고, 홈 서버에서 제대로 서비스를 배포해보고 싶어서 그리고 LLM의 도움을 받아서 쉽고 빠르게 설정할 수 있을것 같아 이번 기회에 공부하며 환경을 구성했다.</p>\n<hr>\n<h2 id=\"기존-구성\">기존 구성</h2>\n<p><svg id=\"mermaid-0\" width=\"100%\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" class=\"flowchart\" style=\"max-width: 774.375px;\" viewBox=\"0 0 774.375 863.265625\" role=\"graphics-document document\" aria-roledescription=\"flowchart-v2\"><style>#mermaid-0{font-family:inherit;font-size:16px;fill:#333;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-0 .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-0 .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-0 .error-icon{fill:#552222;}#mermaid-0 .error-text{fill:#552222;stroke:#552222;}#mermaid-0 .edge-thickness-normal{stroke-width:1px;}#mermaid-0 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-0 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-0 .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-0 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-0 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-0 .marker{fill:#333333;stroke:#333333;}#mermaid-0 .marker.cross{stroke:#333333;}#mermaid-0 svg{font-family:inherit;font-size:16px;}#mermaid-0 p{margin:0;}#mermaid-0 .label{font-family:inherit;color:#333;}#mermaid-0 .cluster-label text{fill:#333;}#mermaid-0 .cluster-label span{color:#333;}#mermaid-0 .cluster-label span p{background-color:transparent;}#mermaid-0 .label text,#mermaid-0 span{fill:#333;color:#333;}#mermaid-0 .node rect,#mermaid-0 .node circle,#mermaid-0 .node ellipse,#mermaid-0 .node polygon,#mermaid-0 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-0 .rough-node .label text,#mermaid-0 .node .label text,#mermaid-0 .image-shape .label,#mermaid-0 .icon-shape .label{text-anchor:middle;}#mermaid-0 .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-0 .rough-node .label,#mermaid-0 .node .label,#mermaid-0 .image-shape .label,#mermaid-0 .icon-shape .label{text-align:center;}#mermaid-0 .node.clickable{cursor:pointer;}#mermaid-0 .root .anchor path{fill:#333333!important;stroke-width:0;stroke:#333333;}#mermaid-0 .arrowheadPath{fill:#333333;}#mermaid-0 .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-0 .flowchart-link{stroke:#333333;fill:none;}#mermaid-0 .edgeLabel{background-color:rgba(232,232,232, 0.8);text-align:center;}#mermaid-0 .edgeLabel p{background-color:rgba(232,232,232, 0.8);}#mermaid-0 .edgeLabel rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#mermaid-0 .labelBkg{background-color:rgba(232, 232, 232, 0.5);}#mermaid-0 .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-0 .cluster text{fill:#333;}#mermaid-0 .cluster span{color:#333;}#mermaid-0 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:inherit;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-0 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#333;}#mermaid-0 rect.text{fill:none;stroke-width:0;}#mermaid-0 .icon-shape,#mermaid-0 .image-shape{background-color:rgba(232,232,232, 0.8);text-align:center;}#mermaid-0 .icon-shape p,#mermaid-0 .image-shape p{background-color:rgba(232,232,232, 0.8);padding:2px;}#mermaid-0 .icon-shape rect,#mermaid-0 .image-shape rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#mermaid-0 .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-0 .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-0 :root{--mermaid-font-family:arial,sans-serif;}</style><g><marker id=\"mermaid-0_flowchart-v2-pointEnd\" class=\"marker flowchart-v2\" viewBox=\"0 0 10 10\" refX=\"5\" refY=\"5\" markerUnits=\"userSpaceOnUse\" markerWidth=\"8\" markerHeight=\"8\" orient=\"auto\"><path d=\"M 0 0 L 10 5 L 0 10 z\" class=\"arrowMarkerPath\" style=\"stroke-width: 1; stroke-dasharray: 1, 0;\"></path></marker><marker id=\"mermaid-0_flowchart-v2-pointStart\" class=\"marker flowchart-v2\" viewBox=\"0 0 10 10\" refX=\"4.5\" refY=\"5\" markerUnits=\"userSpaceOnUse\" markerWidth=\"8\" markerHeight=\"8\" orient=\"auto\"><path d=\"M 0 5 L 10 10 L 10 0 z\" class=\"arrowMarkerPath\" style=\"stroke-width: 1; stroke-dasharray: 1, 0;\"></path></marker><marker id=\"mermaid-0_flowchart-v2-circleEnd\" class=\"marker flowchart-v2\" viewBox=\"0 0 10 10\" refX=\"11\" refY=\"5\" markerUnits=\"userSpaceOnUse\" markerWidth=\"11\" markerHeight=\"11\" orient=\"auto\"><circle cx=\"5\" cy=\"5\" r=\"5\" class=\"arrowMarkerPath\" style=\"stroke-width: 1; stroke-dasharray: 1, 0;\"></circle></marker><marker id=\"mermaid-0_flowchart-v2-circleStart\" class=\"marker flowchart-v2\" viewBox=\"0 0 10 10\" refX=\"-1\" refY=\"5\" markerUnits=\"userSpaceOnUse\" markerWidth=\"11\" markerHeight=\"11\" orient=\"auto\"><circle cx=\"5\" cy=\"5\" r=\"5\" class=\"arrowMarkerPath\" style=\"stroke-width: 1; stroke-dasharray: 1, 0;\"></circle></marker><marker id=\"mermaid-0_flowchart-v2-crossEnd\" class=\"marker cross flowchart-v2\" viewBox=\"0 0 11 11\" refX=\"12\" refY=\"5.2\" markerUnits=\"userSpaceOnUse\" markerWidth=\"11\" markerHeight=\"11\" orient=\"auto\"><path d=\"M 1,1 l 9,9 M 10,1 l -9,9\" class=\"arrowMarkerPath\" style=\"stroke-width: 2; stroke-dasharray: 1, 0;\"></path></marker><marker id=\"mermaid-0_flowchart-v2-crossStart\" class=\"marker cross flowchart-v2\" viewBox=\"0 0 11 11\" refX=\"-1\" refY=\"5.2\" markerUnits=\"userSpaceOnUse\" markerWidth=\"11\" markerHeight=\"11\" orient=\"auto\"><path d=\"M 1,1 l 9,9 M 10,1 l -9,9\" class=\"arrowMarkerPath\" style=\"stroke-width: 2; stroke-dasharray: 1, 0;\"></path></marker><g class=\"root\"><g class=\"clusters\"><g class=\"cluster\" id=\"HOME\" data-look=\"classic\"><rect style=\"\" x=\"8\" y=\"353.265625\" width=\"758.375\" height=\"502\"></rect><g class=\"cluster-label\" transform=\"translate(287.1875, 353.265625)\"><foreignObject width=\"200\" height=\"48\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;\"><span class=\"nodeLabel\"><p>Home LAN 192.168.0.0/24 (BEFORE)</p></span></div></foreignObject></g></g><g class=\"cluster\" id=\"DEV\" data-look=\"classic\"><rect style=\"\" x=\"320.234375\" y=\"8\" width=\"252.28125\" height=\"128\"></rect><g class=\"cluster-label\" transform=\"translate(387.6875, 8)\"><foreignObject width=\"117.375\" height=\"24\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\"><span class=\"nodeLabel\"><p>Remote Devices</p></span></div></foreignObject></g></g></g><g class=\"edgePaths\"><path d=\"M446.375,111L446.375,115.167C446.375,119.333,446.375,127.667,446.375,138C446.375,148.333,446.375,160.667,446.375,172.333C446.375,184,446.375,195,446.375,200.5L446.375,206\" id=\"L_DEVICES_Internet_0\" class=\"edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link\" style=\";\" data-edge=\"true\" data-et=\"edge\" data-id=\"L_DEVICES_Internet_0\" data-points=\"W3sieCI6NDQ2LjM3NSwieSI6MTExfSx7IngiOjQ0Ni4zNzUsInkiOjEzNn0seyJ4Ijo0NDYuMzc1LCJ5IjoxNzN9LHsieCI6NDQ2LjM3NSwieSI6MjEwfV0=\" marker-end=\"url(#mermaid-0_flowchart-v2-pointEnd)\"></path><path d=\"M446.375,279.266L446.375,285.432C446.375,291.599,446.375,303.932,446.375,316.266C446.375,328.599,446.375,340.932,446.375,350.599C446.375,360.266,446.375,367.266,446.375,370.766L446.375,374.266\" id=\"L_Internet_IPTIME_0\" class=\"edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link\" style=\";\" data-edge=\"true\" data-et=\"edge\" data-id=\"L_Internet_IPTIME_0\" data-points=\"W3sieCI6NDQ2LjM3NSwieSI6Mjc5LjI2NTYyNX0seyJ4Ijo0NDYuMzc1LCJ5IjozMTYuMjY1NjI1fSx7IngiOjQ0Ni4zNzUsInkiOjM1My4yNjU2MjV9LHsieCI6NDQ2LjM3NSwieSI6Mzc4LjI2NTYyNX1d\" marker-end=\"url(#mermaid-0_flowchart-v2-pointEnd)\"></path><path d=\"M366.836,456.266L354.259,462.432C341.682,468.599,316.529,480.932,303.952,494.599C291.375,508.266,291.375,523.266,291.375,530.766L291.375,538.266\" id=\"L_IPTIME_NAS_0\" class=\"edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link\" style=\";\" data-edge=\"true\" data-et=\"edge\" data-id=\"L_IPTIME_NAS_0\" data-points=\"W3sieCI6MzY2LjgzNTUyNjMxNTc4OTUsInkiOjQ1Ni4yNjU2MjV9LHsieCI6MjkxLjM3NSwieSI6NDkzLjI2NTYyNX0seyJ4IjoyOTEuMzc1LCJ5Ijo1NDIuMjY1NjI1fV0=\" marker-end=\"url(#mermaid-0_flowchart-v2-pointEnd)\"></path><path d=\"M525.914,456.266L538.491,462.432C551.068,468.599,576.221,480.932,588.798,492.599C601.375,504.266,601.375,515.266,601.375,520.766L601.375,526.266\" id=\"L_IPTIME_WIN_0\" class=\"edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link\" style=\";\" data-edge=\"true\" data-et=\"edge\" data-id=\"L_IPTIME_WIN_0\" data-points=\"W3sieCI6NTI1LjkxNDQ3MzY4NDIxMDUsInkiOjQ1Ni4yNjU2MjV9LHsieCI6NjAxLjM3NSwieSI6NDkzLjI2NTYyNX0seyJ4Ijo2MDEuMzc1LCJ5Ijo1MzAuMjY1NjI1fV0=\" marker-end=\"url(#mermaid-0_flowchart-v2-pointEnd)\"></path><path d=\"M291.375,644.266L291.375,650.432C291.375,656.599,291.375,668.932,291.375,679.266C291.375,689.599,291.375,697.932,291.375,702.099L291.375,706.266\" id=\"L_NAS_DC_0\" class=\"edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link\" style=\";\" data-edge=\"true\" data-et=\"edge\" data-id=\"L_NAS_DC_0\" data-points=\"W3sieCI6MjkxLjM3NSwieSI6NjQ0LjI2NTYyNX0seyJ4IjoyOTEuMzc1LCJ5Ijo2ODEuMjY1NjI1fSx7IngiOjI5MS4zNzUsInkiOjcwNi4yNjU2MjV9XQ==\"></path></g><g class=\"edgeLabels\"><g class=\"edgeLabel\" transform=\"translate(446.375, 173)\"><g class=\"label\" data-id=\"L_DEVICES_Internet_0\" transform=\"translate(-27.1328125, -12)\"><foreignObject width=\"54.265625\" height=\"24\"><div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"labelBkg\" style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\"><span class=\"edgeLabel\"><p>Internet</p></span></div></foreignObject></g></g><g class=\"edgeLabel\" transform=\"translate(446.375, 316.265625)\"><g class=\"label\" data-id=\"L_Internet_IPTIME_0\" transform=\"translate(-28.921875, -12)\"><foreignObject width=\"57.84375\" height=\"24\"><div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"labelBkg\" style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\"><span class=\"edgeLabel\"><p>Inbound</p></span></div></foreignObject></g></g><g class=\"edgeLabel\" transform=\"translate(291.375, 493.265625)\"><g class=\"label\" data-id=\"L_IPTIME_NAS_0\" transform=\"translate(-49.7890625, -12)\"><foreignObject width=\"99.578125\" height=\"24\"><div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"labelBkg\" style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\"><span class=\"edgeLabel\"><p>DMZ: all ports</p></span></div></foreignObject></g></g><g class=\"edgeLabel\" transform=\"translate(601.375, 493.265625)\"><g class=\"label\" data-id=\"L_IPTIME_WIN_0\" transform=\"translate(-56.9140625, -12)\"><foreignObject width=\"113.828125\" height=\"24\"><div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"labelBkg\" style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\"><span class=\"edgeLabel\"><p>Port Forwarding</p></span></div></foreignObject></g></g><g class=\"edgeLabel\"><g class=\"label\" data-id=\"L_NAS_DC_0\" transform=\"translate(0, 0)\"><foreignObject width=\"0\" height=\"0\"><div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"labelBkg\" style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\"><span class=\"edgeLabel\"></span></div></foreignObject></g></g></g><g class=\"nodes\"><g class=\"root\" transform=\"translate(35, 698.265625)\"><g class=\"clusters\"><g class=\"cluster\" id=\"DC\" data-look=\"classic\"><rect style=\"\" x=\"8\" y=\"8\" width=\"496.75\" height=\"124\"></rect><g class=\"cluster-label\" transform=\"translate(156.375, 8)\"><foreignObject width=\"200\" height=\"48\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;\"><span class=\"nodeLabel\"><p>NAS: Docker Compose (manual deploy)</p></span></div></foreignObject></g></g></g><g class=\"edgePaths\"><path d=\"M253.109,70L259.359,70C265.609,70,278.109,70,289.943,70C301.776,70,312.943,70,318.526,70L324.109,70\" id=\"L_DCY_SVC_0\" class=\"edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link\" style=\";\" data-edge=\"true\" data-et=\"edge\" data-id=\"L_DCY_SVC_0\" data-points=\"W3sieCI6MjUzLjEwOTM3NSwieSI6NzB9LHsieCI6MjkwLjYwOTM3NSwieSI6NzB9LHsieCI6MzI4LjEwOTM3NSwieSI6NzB9XQ==\" marker-end=\"url(#mermaid-0_flowchart-v2-pointEnd)\"></path></g><g class=\"edgeLabels\"><g class=\"edgeLabel\"><g class=\"label\" data-id=\"L_DCY_SVC_0\" transform=\"translate(0, 0)\"><foreignObject width=\"0\" height=\"0\"><div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"labelBkg\" style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\"><span class=\"edgeLabel\"></span></div></foreignObject></g></g></g><g class=\"nodes\"><g class=\"node default\" id=\"flowchart-DCY-5\" transform=\"translate(149.3046875, 70)\"><rect class=\"basic label-container\" style=\"\" x=\"-103.8046875\" y=\"-27\" width=\"207.609375\" height=\"54\"></rect><g class=\"label\" style=\"\" transform=\"translate(-73.8046875, -12)\"><rect></rect><foreignObject width=\"147.609375\" height=\"24\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\"><span class=\"nodeLabel\"><p>docker-compose.yml</p></span></div></foreignObject></g></g><g class=\"node default\" id=\"flowchart-SVC-6\" transform=\"translate(397.6796875, 70)\"><rect class=\"basic label-container\" style=\"\" x=\"-69.5703125\" y=\"-27\" width=\"139.140625\" height=\"54\"></rect><g class=\"label\" style=\"\" transform=\"translate(-39.5703125, -12)\"><rect></rect><foreignObject width=\"79.140625\" height=\"24\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\"><span class=\"nodeLabel\"><p>Services ...</p></span></div></foreignObject></g></g></g></g><g class=\"node default\" id=\"flowchart-Internet-0\" transform=\"translate(446.375, 244.6328125)\"><circle class=\"basic label-container\" style=\"\" r=\"34.6328125\" cx=\"0\" cy=\"0\"></circle><g class=\"label\" style=\"\" transform=\"translate(-27.1328125, -12)\"><rect></rect><foreignObject width=\"54.265625\" height=\"24\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\"><span class=\"nodeLabel\"><p>Internet</p></span></div></foreignObject></g></g><g class=\"node default\" id=\"flowchart-DEVICES-1\" transform=\"translate(446.375, 72)\"><rect class=\"basic label-container\" style=\"\" x=\"-91.140625\" y=\"-39\" width=\"182.28125\" height=\"78\"></rect><g class=\"label\" style=\"\" transform=\"translate(-61.140625, -24)\"><rect></rect><foreignObject width=\"122.28125\" height=\"48\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\"><span class=\"nodeLabel\"><p>User devices<br></br>SSH -> *.jiun.dev</p></span></div></foreignObject></g></g><g class=\"node default\" id=\"flowchart-IPTIME-2\" transform=\"translate(446.375, 417.265625)\"><rect class=\"basic label-container\" style=\"\" x=\"-126.0546875\" y=\"-39\" width=\"252.109375\" height=\"78\"></rect><g class=\"label\" style=\"\" transform=\"translate(-96.0546875, -24)\"><rect></rect><foreignObject width=\"192.109375\" height=\"48\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\"><span class=\"nodeLabel\"><p>ipTIME Router 192.168.0.1<br></br>DMZ -> 192.168.0.3 (NAS)</p></span></div></foreignObject></g></g><g class=\"node default\" id=\"flowchart-NAS-3\" transform=\"translate(291.375, 593.265625)\"><rect class=\"basic label-container\" style=\"\" x=\"-130\" y=\"-51\" width=\"260\" height=\"102\"></rect><g class=\"label\" style=\"\" transform=\"translate(-100, -36)\"><rect></rect><foreignObject width=\"200\" height=\"72\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;\"><span class=\"nodeLabel\"><p>Synology NAS (DSM) 192.168.0.3<br></br>SSL: *.jiun.dev</p></span></div></foreignObject></g></g><g class=\"node default\" id=\"flowchart-WIN-4\" transform=\"translate(601.375, 593.265625)\"><rect class=\"basic label-container\" style=\"\" x=\"-130\" y=\"-63\" width=\"260\" height=\"126\"></rect><g class=\"label\" style=\"\" transform=\"translate(-100, -48)\"><rect></rect><foreignObject width=\"200\" height=\"96\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;\"><span class=\"nodeLabel\"><p>Windows Desktop 192.168.0.2<br></br>Port Forwarded (external)<br></br>WSL</p></span></div></foreignObject></g></g></g></g></g></svg></p>\n<hr>\n<h2 id=\"설계-목표\">설계 목표</h2>\n<ul>\n<li>Public:\n<ul>\n<li><code class=\"language-text\">nas.jiun.dev</code> 하나(= DSM 관리 UI)만, <strong>Cloudflare Tunnel</strong>로 공개</li>\n</ul>\n</li>\n<li>Private:\n<ul>\n<li>Home LAN(192.168.0.0/24) 접근은 <strong>Tailscale Subnet Router</strong>로만</li>\n<li><code class=\"language-text\">registry.dev.domain</code>는 <strong>Tailscale 내부에서만</strong> Push/Pull</li>\n</ul>\n</li>\n<li>운영:\n<ul>\n<li><code class=\"language-text\">dev.domain</code>는 서비스가 많아질 것이므로 **k3s + IaC(kubectl)**로 유지</li>\n<li><code class=\"language-text\">jiun.dev</code>는 cloudflared만 필요해서 <strong>DSM Docker</strong>로 분리 운영</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h2 id=\"현재-구성\">현재 구성</h2>\n<p><svg id=\"mermaid-1\" width=\"100%\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" class=\"flowchart\" style=\"max-width: 1386.40234375px;\" viewBox=\"0 0 1386.40234375 845\" role=\"graphics-document document\" aria-roledescription=\"flowchart-v2\"><style>#mermaid-1{font-family:inherit;font-size:16px;fill:#333;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-1 .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-1 .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-1 .error-icon{fill:#552222;}#mermaid-1 .error-text{fill:#552222;stroke:#552222;}#mermaid-1 .edge-thickness-normal{stroke-width:1px;}#mermaid-1 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-1 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-1 .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-1 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-1 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-1 .marker{fill:#333333;stroke:#333333;}#mermaid-1 .marker.cross{stroke:#333333;}#mermaid-1 svg{font-family:inherit;font-size:16px;}#mermaid-1 p{margin:0;}#mermaid-1 .label{font-family:inherit;color:#333;}#mermaid-1 .cluster-label text{fill:#333;}#mermaid-1 .cluster-label span{color:#333;}#mermaid-1 .cluster-label span p{background-color:transparent;}#mermaid-1 .label text,#mermaid-1 span{fill:#333;color:#333;}#mermaid-1 .node rect,#mermaid-1 .node circle,#mermaid-1 .node ellipse,#mermaid-1 .node polygon,#mermaid-1 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-1 .rough-node .label text,#mermaid-1 .node .label text,#mermaid-1 .image-shape .label,#mermaid-1 .icon-shape .label{text-anchor:middle;}#mermaid-1 .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-1 .rough-node .label,#mermaid-1 .node .label,#mermaid-1 .image-shape .label,#mermaid-1 .icon-shape .label{text-align:center;}#mermaid-1 .node.clickable{cursor:pointer;}#mermaid-1 .root .anchor path{fill:#333333!important;stroke-width:0;stroke:#333333;}#mermaid-1 .arrowheadPath{fill:#333333;}#mermaid-1 .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-1 .flowchart-link{stroke:#333333;fill:none;}#mermaid-1 .edgeLabel{background-color:rgba(232,232,232, 0.8);text-align:center;}#mermaid-1 .edgeLabel p{background-color:rgba(232,232,232, 0.8);}#mermaid-1 .edgeLabel rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#mermaid-1 .labelBkg{background-color:rgba(232, 232, 232, 0.5);}#mermaid-1 .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-1 .cluster text{fill:#333;}#mermaid-1 .cluster span{color:#333;}#mermaid-1 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:inherit;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-1 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#333;}#mermaid-1 rect.text{fill:none;stroke-width:0;}#mermaid-1 .icon-shape,#mermaid-1 .image-shape{background-color:rgba(232,232,232, 0.8);text-align:center;}#mermaid-1 .icon-shape p,#mermaid-1 .image-shape p{background-color:rgba(232,232,232, 0.8);padding:2px;}#mermaid-1 .icon-shape rect,#mermaid-1 .image-shape rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#mermaid-1 .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-1 .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-1 :root{--mermaid-font-family:arial,sans-serif;}</style><g><marker id=\"mermaid-1_flowchart-v2-pointEnd\" class=\"marker flowchart-v2\" viewBox=\"0 0 10 10\" refX=\"5\" refY=\"5\" markerUnits=\"userSpaceOnUse\" markerWidth=\"8\" markerHeight=\"8\" orient=\"auto\"><path d=\"M 0 0 L 10 5 L 0 10 z\" class=\"arrowMarkerPath\" style=\"stroke-width: 1; stroke-dasharray: 1, 0;\"></path></marker><marker id=\"mermaid-1_flowchart-v2-pointStart\" class=\"marker flowchart-v2\" viewBox=\"0 0 10 10\" refX=\"4.5\" refY=\"5\" markerUnits=\"userSpaceOnUse\" markerWidth=\"8\" markerHeight=\"8\" orient=\"auto\"><path d=\"M 0 5 L 10 10 L 10 0 z\" class=\"arrowMarkerPath\" style=\"stroke-width: 1; stroke-dasharray: 1, 0;\"></path></marker><marker id=\"mermaid-1_flowchart-v2-circleEnd\" class=\"marker flowchart-v2\" viewBox=\"0 0 10 10\" refX=\"11\" refY=\"5\" markerUnits=\"userSpaceOnUse\" markerWidth=\"11\" markerHeight=\"11\" orient=\"auto\"><circle cx=\"5\" cy=\"5\" r=\"5\" class=\"arrowMarkerPath\" style=\"stroke-width: 1; stroke-dasharray: 1, 0;\"></circle></marker><marker id=\"mermaid-1_flowchart-v2-circleStart\" class=\"marker flowchart-v2\" viewBox=\"0 0 10 10\" refX=\"-1\" refY=\"5\" markerUnits=\"userSpaceOnUse\" markerWidth=\"11\" markerHeight=\"11\" orient=\"auto\"><circle cx=\"5\" cy=\"5\" r=\"5\" class=\"arrowMarkerPath\" style=\"stroke-width: 1; stroke-dasharray: 1, 0;\"></circle></marker><marker id=\"mermaid-1_flowchart-v2-crossEnd\" class=\"marker cross flowchart-v2\" viewBox=\"0 0 11 11\" refX=\"12\" refY=\"5.2\" markerUnits=\"userSpaceOnUse\" markerWidth=\"11\" markerHeight=\"11\" orient=\"auto\"><path d=\"M 1,1 l 9,9 M 10,1 l -9,9\" class=\"arrowMarkerPath\" style=\"stroke-width: 2; stroke-dasharray: 1, 0;\"></path></marker><marker id=\"mermaid-1_flowchart-v2-crossStart\" class=\"marker cross flowchart-v2\" viewBox=\"0 0 11 11\" refX=\"-1\" refY=\"5.2\" markerUnits=\"userSpaceOnUse\" markerWidth=\"11\" markerHeight=\"11\" orient=\"auto\"><path d=\"M 1,1 l 9,9 M 10,1 l -9,9\" class=\"arrowMarkerPath\" style=\"stroke-width: 2; stroke-dasharray: 1, 0;\"></path></marker><g class=\"root\"><g class=\"clusters\"><g class=\"cluster\" id=\"HOME\" data-look=\"classic\"><rect style=\"\" x=\"351.46875\" y=\"210\" width=\"1026.93359375\" height=\"627\"></rect><g class=\"cluster-label\" transform=\"translate(765.755859375, 210)\"><foreignObject width=\"198.359375\" height=\"24\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\"><span class=\"nodeLabel\"><p>Home LAN 192.168.32.0/24</p></span></div></foreignObject></g></g><g class=\"cluster\" id=\"DEV\" data-look=\"classic\"><rect style=\"\" x=\"8\" y=\"8\" width=\"1170.62890625\" height=\"128\"></rect><g class=\"cluster-label\" transform=\"translate(534.626953125, 8)\"><foreignObject width=\"117.375\" height=\"24\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\"><span class=\"nodeLabel\"><p>Remote Devices</p></span></div></foreignObject></g></g><g class=\"cluster\" id=\"TAILNET\" data-look=\"classic\"><rect style=\"\" x=\"24.2265625\" y=\"210\" width=\"176.25\" height=\"152\"></rect><g class=\"cluster-label\" transform=\"translate(56.46875, 210)\"><foreignObject width=\"111.765625\" height=\"24\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\"><span class=\"nodeLabel\"><p>Tailscale Tailnet</p></span></div></foreignObject></g></g><g class=\"cluster\" id=\"PROXMOX\" data-look=\"classic\"><rect style=\"\" x=\"371.46875\" y=\"460\" width=\"773.76171875\" height=\"352\"></rect><g class=\"cluster-label\" transform=\"translate(658.349609375, 460)\"><foreignObject width=\"200\" height=\"48\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;\"><span class=\"nodeLabel\"><p>Proxmox VE (Aoostar WTR Pro)</p></span></div></foreignObject></g></g></g><g class=\"edgePaths\"><path d=\"M471.403,84.774L411.561,93.312C351.719,101.85,232.036,118.925,172.194,133.629C112.352,148.333,112.352,160.667,112.352,173C112.352,185.333,112.352,197.667,112.352,211.333C112.352,225,112.352,240,112.352,247.5L112.352,255\" id=\"L_DEVICES_TS_0\" class=\"edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link\" style=\";\" data-edge=\"true\" data-et=\"edge\" data-id=\"L_DEVICES_TS_0\" data-points=\"W3sieCI6NDc1LjM2MzI4MTI1LCJ5Ijo4NC4yMDkzNzEzODA4MDI3fSx7IngiOjExMi4zNTE1NjI1LCJ5IjoxMzZ9LHsieCI6MTEyLjM1MTU2MjUsInkiOjE3M30seyJ4IjoxMTIuMzUxNTYyNSwieSI6MjEwfSx7IngiOjExMi4zNTE1NjI1LCJ5IjoyNTl9XQ==\" marker-start=\"url(#mermaid-1_flowchart-v2-pointStart)\" marker-end=\"url(#mermaid-1_flowchart-v2-pointEnd)\"></path><path d=\"M833.732,503.583L814.396,496.319C795.06,489.055,756.387,474.528,737.051,459.097C717.715,443.667,717.715,427.333,622.498,411C527.281,394.667,336.848,378.333,238.243,362.608C139.639,346.883,132.864,331.767,129.476,324.208L126.089,316.65\" id=\"L_GW_TS_0\" class=\"edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link\" style=\";\" data-edge=\"true\" data-et=\"edge\" data-id=\"L_GW_TS_0\" data-points=\"W3sieCI6ODM3LjQ3NjU2MjUsInkiOjUwNC45ODk3NzgwNTE5OTM1NH0seyJ4Ijo3MTcuNzE0ODQzNzUsInkiOjQ2MH0seyJ4Ijo3MTcuNzE0ODQzNzUsInkiOjQxMX0seyJ4IjoxNDYuNDE0MDYyNSwieSI6MzYyfSx7IngiOjEyNC40NTI3MTM4MTU3ODk0OCwieSI6MzEzfV0=\" marker-start=\"url(#mermaid-1_flowchart-v2-pointStart)\" marker-end=\"url(#mermaid-1_flowchart-v2-pointEnd)\"></path><path d=\"M102.596,316.813L100.211,324.345C97.827,331.876,93.058,346.938,162.608,362.636C232.158,378.333,376.026,394.667,447.96,411C519.895,427.333,519.895,443.667,572.172,462.481C624.449,481.294,729.003,502.589,781.28,513.236L833.557,523.883\" id=\"L_TS_GW_0\" class=\"edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link\" style=\";\" data-edge=\"true\" data-et=\"edge\" data-id=\"L_TS_GW_0\" data-points=\"W3sieCI6MTAzLjgwMzA0Mjc2MzE1Nzg5LCJ5IjozMTN9LHsieCI6ODguMjg5MDYyNSwieSI6MzYyfSx7IngiOjUxOS44OTQ1MzEyNSwieSI6NDExfSx7IngiOjUxOS44OTQ1MzEyNSwieSI6NDYwfSx7IngiOjgzNy40NzY1NjI1LCJ5Ijo1MjQuNjgxNTIzNTM3NDQyfV0=\" marker-start=\"url(#mermaid-1_flowchart-v2-pointStart)\" marker-end=\"url(#mermaid-1_flowchart-v2-pointEnd)\"></path><path d=\"M646.52,82.02L723.362,91.016C800.204,100.013,953.889,118.007,1030.732,133.17C1107.574,148.333,1107.574,160.667,1107.574,173C1107.574,185.333,1107.574,197.667,1107.574,216.5C1107.574,235.333,1107.574,260.667,1107.574,286C1107.574,311.333,1107.574,336.667,1107.574,357.5C1107.574,378.333,1107.574,394.667,1107.574,411C1107.574,427.333,1107.574,443.667,1100.787,455.672C1093.999,467.677,1080.425,475.354,1073.637,479.192L1066.85,483.031\" id=\"L_DEVICES_GW_0\" class=\"edge-thickness-normal edge-pattern-dotted edge-thickness-normal edge-pattern-solid flowchart-link\" style=\";\" data-edge=\"true\" data-et=\"edge\" data-id=\"L_DEVICES_GW_0\" data-points=\"W3sieCI6NjQ2LjUxOTUzMTI1LCJ5Ijo4Mi4wMTk1MjI5MzE1ODM5OX0seyJ4IjoxMTA3LjU3NDIxODc1LCJ5IjoxMzZ9LHsieCI6MTEwNy41NzQyMTg3NSwieSI6MTczfSx7IngiOjExMDcuNTc0MjE4NzUsInkiOjIxMH0seyJ4IjoxMTA3LjU3NDIxODc1LCJ5IjoyODZ9LHsieCI6MTEwNy41NzQyMTg3NSwieSI6MzYyfSx7IngiOjExMDcuNTc0MjE4NzUsInkiOjQxMX0seyJ4IjoxMTA3LjU3NDIxODc1LCJ5Ijo0NjB9LHsieCI6MTA2My4zNjgxMTk2NzMyOTU1LCJ5Ijo0ODV9XQ==\" marker-end=\"url(#mermaid-1_flowchart-v2-pointEnd)\"></path><path d=\"M270.109,324.633L270.109,330.861C270.109,337.089,270.109,349.544,270.109,363.939C270.109,378.333,270.109,394.667,270.109,411C270.109,427.333,270.109,443.667,270.109,458.002C270.109,472.338,270.109,484.676,270.109,490.845L270.109,497.014\" id=\"L_Internet_CF_0\" class=\"edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link\" style=\";\" data-edge=\"true\" data-et=\"edge\" data-id=\"L_Internet_CF_0\" data-points=\"W3sieCI6MjcwLjEwOTM3NSwieSI6MzIwLjYzMjgxMjV9LHsieCI6MjcwLjEwOTM3NSwieSI6MzYyfSx7IngiOjI3MC4xMDkzNzUsInkiOjQxMX0seyJ4IjoyNzAuMTA5Mzc1LCJ5Ijo0NjB9LHsieCI6MjcwLjEwOTM3NSwieSI6NTAxLjAxMzUwMDIxMzYyMzA1fV0=\" marker-start=\"url(#mermaid-1_flowchart-v2-pointStart)\" marker-end=\"url(#mermaid-1_flowchart-v2-pointEnd)\"></path><path d=\"M317.766,568.028L349.482,581.356C381.198,594.685,444.63,621.343,476.346,640.171C508.063,659,508.063,670,508.063,675.5L508.063,681\" id=\"L_CF_K3S_0\" class=\"edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link\" style=\";\" data-edge=\"true\" data-et=\"edge\" data-id=\"L_CF_K3S_0\" data-points=\"W3sieCI6MzE0LjA3ODEyNSwieSI6NTY2LjQ3NzkwMzk5ODk0OTR9LHsieCI6NTA4LjA2MjUsInkiOjY0OH0seyJ4Ijo1MDguMDYyNSwieSI6Njg1fV0=\" marker-start=\"url(#mermaid-1_flowchart-v2-pointStart)\" marker-end=\"url(#mermaid-1_flowchart-v2-pointEnd)\"></path><path d=\"M837.477,609.612L825.587,616.01C813.698,622.408,789.919,635.204,778.03,647.102C766.141,659,766.141,670,766.141,675.5L766.141,681\" id=\"L_GW_MON_0\" class=\"edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link\" style=\";\" data-edge=\"true\" data-et=\"edge\" data-id=\"L_GW_MON_0\" data-points=\"W3sieCI6ODM3LjQ3NjU2MjUsInkiOjYwOS42MTE4NzI1MzAwNTk3fSx7IngiOjc2Ni4xNDA2MjUsInkiOjY0OH0seyJ4Ijo3NjYuMTQwNjI1LCJ5Ijo2ODV9XQ==\" marker-end=\"url(#mermaid-1_flowchart-v2-pointEnd)\"></path><path d=\"M988.233,611L991.783,617.167C995.333,623.333,1002.432,635.667,1005.982,647.333C1009.531,659,1009.531,670,1009.531,675.5L1009.531,681\" id=\"L_GW_REG_0\" class=\"edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link\" style=\";\" data-edge=\"true\" data-et=\"edge\" data-id=\"L_GW_REG_0\" data-points=\"W3sieCI6OTg4LjIzMzEyNSwieSI6NjExfSx7IngiOjEwMDkuNTMxMjUsInkiOjY0OH0seyJ4IjoxMDA5LjUzMTI1LCJ5Ijo2ODV9XQ==\" marker-end=\"url(#mermaid-1_flowchart-v2-pointEnd)\"></path><path d=\"M895.41,337L895.41,341.167C895.41,345.333,895.41,353.667,895.41,366C895.41,378.333,895.41,394.667,895.41,411C895.41,427.333,895.41,443.667,895.41,451.833L895.41,460\" id=\"L_IPTIME_PROXMOX_0\" class=\"edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link\" style=\";\" data-edge=\"true\" data-et=\"edge\" data-id=\"L_IPTIME_PROXMOX_0\" data-points=\"W3sieCI6ODk1LjQxMDE1NjI1LCJ5IjozMzd9LHsieCI6ODk1LjQxMDE1NjI1LCJ5IjozNjJ9LHsieCI6ODk1LjQxMDE1NjI1LCJ5Ijo0MTF9LHsieCI6ODk1LjQxMDE1NjI1LCJ5Ijo0NjB9LHsieCI6OTExLjQ3NzkzODU2NTM0MDksInkiOjQ4NX1d\"></path><path d=\"M1145.23,666.655L1180.23,692.514\" id=\"L_PROXMOX_NAS_0\" class=\"edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link\" style=\";\" data-edge=\"true\" data-et=\"edge\" data-id=\"L_PROXMOX_NAS_0\" data-points=\"W3sieCI6MTA0My4xNTg3ODkwNjI1LCJ5Ijo2MTF9LHsieCI6MTA5Ni43MTQ4NDM3NSwieSI6NjQ4fSx7IngiOjExODAuMjMwNDY4NzUsInkiOjY5Mi41MTQyNjY3ODY1NDI0fV0=\"></path></g><g class=\"edgeLabels\"><g class=\"edgeLabel\" transform=\"translate(112.3515625, 173)\"><g class=\"label\" data-id=\"L_DEVICES_TS_0\" transform=\"translate(-77.8203125, -12)\"><foreignObject width=\"155.640625\" height=\"24\"><div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"labelBkg\" style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\"><span class=\"edgeLabel\"><p>Tailscale over Internet</p></span></div></foreignObject></g></g><g class=\"edgeLabel\" transform=\"translate(717.71484375, 411)\"><g class=\"label\" data-id=\"L_GW_TS_0\" transform=\"translate(-77.8203125, -12)\"><foreignObject width=\"155.640625\" height=\"24\"><div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"labelBkg\" style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\"><span class=\"edgeLabel\"><p>Tailscale over Internet</p></span></div></foreignObject></g></g><g class=\"edgeLabel\" transform=\"translate(519.89453125, 411)\"><g class=\"label\" data-id=\"L_TS_GW_0\" transform=\"translate(-100, -24)\"><foreignObject width=\"200\" height=\"48\"><div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"labelBkg\" style=\"display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;\"><span class=\"edgeLabel\"><p>Subnet routes 192.168.32.0/24</p></span></div></foreignObject></g></g><g class=\"edgeLabel\" transform=\"translate(1107.57421875, 286)\"><g class=\"label\" data-id=\"L_DEVICES_GW_0\" transform=\"translate(-82.7109375, -12)\"><foreignObject width=\"165.421875\" height=\"24\"><div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"labelBkg\" style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\"><span class=\"edgeLabel\"><p>DNS: *.internal.jiun.dev</p></span></div></foreignObject></g></g><g class=\"edgeLabel\" transform=\"translate(270.109375, 411)\"><g class=\"label\" data-id=\"L_Internet_CF_0\" transform=\"translate(-61.359375, -12)\"><foreignObject width=\"122.71875\" height=\"24\"><div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"labelBkg\" style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\"><span class=\"edgeLabel\"><p>HTTPS *.jiun.dev</p></span></div></foreignObject></g></g><g class=\"edgeLabel\" transform=\"translate(508.0625, 648)\"><g class=\"label\" data-id=\"L_CF_K3S_0\" transform=\"translate(-24.1640625, -12)\"><foreignObject width=\"48.328125\" height=\"24\"><div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"labelBkg\" style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\"><span class=\"edgeLabel\"><p>Tunnel</p></span></div></foreignObject></g></g><g class=\"edgeLabel\" transform=\"translate(766.140625, 648)\"><g class=\"label\" data-id=\"L_GW_MON_0\" transform=\"translate(-52.4609375, -12)\"><foreignObject width=\"104.921875\" height=\"24\"><div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"labelBkg\" style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\"><span class=\"edgeLabel\"><p>Reverse Proxy</p></span></div></foreignObject></g></g><g class=\"edgeLabel\" transform=\"translate(1009.53125, 648)\"><g class=\"label\" data-id=\"L_GW_REG_0\" transform=\"translate(-52.4609375, -12)\"><foreignObject width=\"104.921875\" height=\"24\"><div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"labelBkg\" style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\"><span class=\"edgeLabel\"><p>Reverse Proxy</p></span></div></foreignObject></g></g><g class=\"edgeLabel\"><g class=\"label\" data-id=\"L_IPTIME_PROXMOX_0\" transform=\"translate(0, 0)\"><foreignObject width=\"0\" height=\"0\"><div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"labelBkg\" style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\"><span class=\"edgeLabel\"></span></div></foreignObject></g></g><g class=\"edgeLabel\"><g class=\"label\" data-id=\"L_PROXMOX_NAS_0\" transform=\"translate(0, 0)\"><foreignObject width=\"0\" height=\"0\"><div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"labelBkg\" style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\"><span class=\"edgeLabel\"></span></div></foreignObject></g></g></g><g class=\"nodes\"><g class=\"node default\" id=\"flowchart-Internet-0\" transform=\"translate(270.109375, 286)\"><circle class=\"basic label-container\" style=\"\" r=\"34.6328125\" cx=\"0\" cy=\"0\"></circle><g class=\"label\" style=\"\" transform=\"translate(-27.1328125, -12)\"><rect></rect><foreignObject width=\"54.265625\" height=\"24\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\"><span class=\"nodeLabel\"><p>Internet</p></span></div></foreignObject></g></g><g class=\"node default\" id=\"flowchart-CF-1\" transform=\"translate(270.109375, 548)\"><path d=\"M0,10.3243322571177 a43.96875,10.3243322571177 0,0,0 87.9375,0 a43.96875,10.3243322571177 0,0,0 -87.9375,0 l0,73.3243322571177 a43.96875,10.3243322571177 0,0,0 87.9375,0 l0,-73.3243322571177\" class=\"basic label-container\" style=\"\" transform=\"translate(-43.96875, -46.986498385676555)\"></path><g class=\"label\" style=\"\" transform=\"translate(-36.46875, -14)\"><rect></rect><foreignObject width=\"72.9375\" height=\"48\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\"><span class=\"nodeLabel\"><p>Cloudflare<br></br>jiun.dev</p></span></div></foreignObject></g></g><g class=\"node default\" id=\"flowchart-TS-2\" transform=\"translate(112.3515625, 286)\"><rect class=\"basic label-container\" style=\"\" x=\"-53.125\" y=\"-27\" width=\"106.25\" height=\"54\"></rect><g class=\"label\" style=\"\" transform=\"translate(-23.125, -12)\"><rect></rect><foreignObject width=\"46.25\" height=\"24\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\"><span class=\"nodeLabel\"><p>Tailnet</p></span></div></foreignObject></g></g><g class=\"node default\" id=\"flowchart-DEVICES-3\" transform=\"translate(560.94140625, 72)\"><rect class=\"basic label-container\" style=\"\" x=\"-85.578125\" y=\"-39\" width=\"171.15625\" height=\"78\"></rect><g class=\"label\" style=\"\" transform=\"translate(-55.578125, -24)\"><rect></rect><foreignObject width=\"111.15625\" height=\"48\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\"><span class=\"nodeLabel\"><p>User devices<br></br>Tailscale clients</p></span></div></foreignObject></g></g><g class=\"node default\" id=\"flowchart-IPTIME-4\" transform=\"translate(895.41015625, 286)\"><rect class=\"basic label-container\" style=\"\" x=\"-94.453125\" y=\"-51\" width=\"188.90625\" height=\"102\"></rect><g class=\"label\" style=\"\" transform=\"translate(-64.453125, -36)\"><rect></rect><foreignObject width=\"128.90625\" height=\"72\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\"><span class=\"nodeLabel\"><p>ipTIME<br></br>DMZ OFF<br></br>Port Forward OFF</p></span></div></foreignObject></g></g><g class=\"node default\" id=\"flowchart-GW-5\" transform=\"translate(951.96875, 548)\"><rect class=\"basic label-container\" style=\"\" x=\"-114.4921875\" y=\"-63\" width=\"228.984375\" height=\"126\"></rect><g class=\"label\" style=\"\" transform=\"translate(-84.4921875, -48)\"><rect></rect><foreignObject width=\"168.984375\" height=\"96\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\"><span class=\"nodeLabel\"><p>Gateway LXC<br></br>192.168.32.10<br></br>Tailscale Subnet Router<br></br>CoreDNS, nginx</p></span></div></foreignObject></g></g><g class=\"node default\" id=\"flowchart-MON-6\" transform=\"translate(766.140625, 736)\"><rect class=\"basic label-container\" style=\"\" x=\"-106.484375\" y=\"-51\" width=\"212.96875\" height=\"102\"></rect><g class=\"label\" style=\"\" transform=\"translate(-76.484375, -36)\"><rect></rect><foreignObject width=\"152.96875\" height=\"72\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\"><span class=\"nodeLabel\"><p>Monitoring LXC<br></br>192.168.32.20<br></br>Prometheus, Grafana</p></span></div></foreignObject></g></g><g class=\"node default\" id=\"flowchart-REG-7\" transform=\"translate(1009.53125, 736)\"><rect class=\"basic label-container\" style=\"\" x=\"-86.90625\" y=\"-51\" width=\"173.8125\" height=\"102\"></rect><g class=\"label\" style=\"\" transform=\"translate(-56.90625, -36)\"><rect></rect><foreignObject width=\"113.8125\" height=\"72\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\"><span class=\"nodeLabel\"><p>Registry LXC<br></br>192.168.32.30<br></br>Docker Registry</p></span></div></foreignObject></g></g><g class=\"node default\" id=\"flowchart-K3S-8\" transform=\"translate(508.0625, 736)\"><rect class=\"basic label-container\" style=\"\" x=\"-101.59375\" y=\"-51\" width=\"203.1875\" height=\"102\"></rect><g class=\"label\" style=\"\" transform=\"translate(-71.59375, -36)\"><rect></rect><foreignObject width=\"143.1875\" height=\"72\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\"><span class=\"nodeLabel\"><p>k3s VM<br></br>192.168.32.66<br></br>cloudflared, ArgoCD</p></span></div></foreignObject></g></g><g class=\"node default\" id=\"flowchart-NAS-9\" transform=\"translate(1261.81640625, 736)\"><rect class=\"basic label-container\" style=\"\" x=\"-81.5859375\" y=\"-51\" width=\"163.171875\" height=\"102\"></rect><g class=\"label\" style=\"\" transform=\"translate(-51.5859375, -36)\"><rect></rect><foreignObject width=\"103.171875\" height=\"72\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\"><span class=\"nodeLabel\"><p>Synology NAS<br></br>192.168.32.65<br></br>Storage</p></span></div></foreignObject></g></g></g></g></g></svg></p>\n<h3 id=\"구성-변경-사항-202412--202501\">구성 변경 사항 (2024.12 → 2025.01)</h3>\n<p>초기 구성 이후 몇 가지 변경이 있었다:</p>\n<ul>\n<li><strong>NAS VMM → Proxmox VE</strong>: Synology NAS의 VMM은 리소스가 제한적이라 별도 미니 PC에 Proxmox VE를 설치했다</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 780px; border-radius: 5px; overflow: hidden;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 91.7948717948718%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAAE0klEQVR42h2T2VPTVxiGc9GxMx1brduIVkVFjawhIQlkT37klxASEoxZIYat4lZcwAotIFZoVbReaK2ttmVxpa5MVcCijlanbu1QsWK1btPpeNH/4emRi/fiXJznvN/7fkfh9Ydw+4L4l4Vp/HgDm+vX07mnk4s/X+b+6Ai79x/EF4yxpbaCykQlJ84PcX7wOgNXb3Pl1giXrv3K0I273H7whPuPnqF4e1omb72vZMIUJTUrV/JJUz07dnVwaXiI+w9H+LbnKFbZz/bWZrY1b6X39AVOXxxm8Ppdfrk3yu9jzxl9/i+PXr7myb//oTCYzdRWR6hKBmmoC7NubRXtn7fTP3CZ4Zv3OHPxOt/09rOv6wwtHV+yvrGVVRubqNuylW2d+zjYdZzevjOcOHuBC8PXUfQdauTSiS8417uT/jPdnD5/hcFrD4RGOTdwh77+G3T9OMjuA0do2b6Hus2trGloYf2n7dR+VE+h08P0mamo1XpU6nwUY78d4fGt/SwrDVFgDVFZ20hrxwEOH/lJuLvF+aE79JweplMA23buY+uufWxubWfFiiQ+2UnA60VnlFiwKIdcrQnFyO1TnD25H5enFI3KgCbXSEamjhyNGYc7SKJmA02f7RUj97F971ci51oCHpmA20HYJ1MiSawKxwg6pHGniq7ebiLJtWhNbnRaG3arG8nuxmF3YTHb0eebUGaoCYSiREOl+GXbOCgiFPfLZC7NYt6suZSYsvhg1hwUpZEknkAMi+QjKysfQ74Do8GO1SJR6JAJ+gPibEGToyKxrJgyv3scFPYW4pXMxMrKiFbUYHf5sBV6UBT547hLosjeEMolGnR5FvL1JsxGKzaTFU+hE51GiyVfx4cRL8mAi0RAZnmxHclsIFK2gupVq0nW1BKOJ1FEEiupa2imrWM3er2V7EwNGtGYXqfHWmCkyG5Dm6tCMuSxLl5MTVAmWVqI32UWD+soDcWFooRicaIJAWxp20FDUxvlFStRpquFyyxyVRq06jxMWh0uiwFdTgaySc2mhIfVyyUBtGM35mF1FBITkHA8gXd5GT7x2xRycVA0amSRMoe585SkLVSSmZFFnsjMmJuL26hDn7MUryWXxqSbuohEzGPAbrMQF9mVxirwB8NsqvZwrkNCkS1g6WLMzOw8UhdkMHX6XFLnLyJLmU5BdhbuAjUG1RKCdhUtlS7qIzaxMiLbYDnRWJSWNR4u7bLzotfK6z4ZhVUqQl8gWtQayc7RMmlyCu++N52UlDlkpKVRlJ+NQ7uYiKSirbKQ2oCJWNDFzo1Oru4x8/Kog39OOvn7mCwkWg4Iu8UlAZwuDwViPVJTFzJ1ygwmTpzMjKnTSF+cij57Pgm3muaExKF6A3e/tvDqmJUXxySe9Mo87nEKSfzV40CxPFYuGionGArjKvKgFe0uXaJkZspsJrwzidyp09HOSyFRpKO30cazHiHhZqzbOa7HQo+6JP783sEjIcUbWHmyUixogmi8jCJfKXqTgwKtiqA1jTXmuUQWz2ZblZbnxz08Pe5jrMclHLkY+0Hm4SEHo4clcRZOu0WGyaoaKqprSFZWEYrGKBP57Fln4eZeC08P2xgR4w3sMPCwq4hXp4I8PeYXl4uFG5eACeB3bxzKAurkj4MS/wNtHguzICH+dAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Aoostar WTR PRO\"\n        title=\"\"\n        src=\"/static/255621e2b6d334f5a9cc29a71ff786ce/a1792/aoostar-wtr-pro.png\"\n        srcset=\"/static/255621e2b6d334f5a9cc29a71ff786ce/cb9a0/aoostar-wtr-pro.png 195w,\n/static/255621e2b6d334f5a9cc29a71ff786ce/727ba/aoostar-wtr-pro.png 390w,\n/static/255621e2b6d334f5a9cc29a71ff786ce/a1792/aoostar-wtr-pro.png 780w,\n/static/255621e2b6d334f5a9cc29a71ff786ce/105d8/aoostar-wtr-pro.png 1170w,\n/static/255621e2b6d334f5a9cc29a71ff786ce/9f9a4/aoostar-wtr-pro.png 1560w,\n/static/255621e2b6d334f5a9cc29a71ff786ce/b75f8/aoostar-wtr-pro.png 2124w\"\n        sizes=\"(max-width: 780px) 100vw, 780px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>구매한 장비는 <strong>Aoostar WTR PRO</strong>로, AMD Ryzen 7 5825U(8C/16T)를 탑재한 미니 PC다. 주요 선택 이유는:</p>\n<ul>\n<li><strong>저전력 고성능</strong>: TDP 45W로 24시간 상시 가동에 적합하면서도 8코어로 가상화에 충분한 성능</li>\n<li><strong>확장성</strong>: RAM 최대 64GB, M.2 SSD 2개, 3.5인치 HDD 4개 장착 가능</li>\n<li><strong>듀얼 2.5GbE</strong>: 네트워크 분리나 링크 어그리게이션 가능</li>\n<li><strong>외관</strong>: 알류미늄인데 마감도 좋고 책상 위에 두어도 부담 없는 작은 폼팩터. 현재는 TV뒤에 가려져있다.</li>\n</ul>\n<p>NAS 옆에 두고 Proxmox VE를 설치해서 LXC/VM을 운영 중이다. 팬 소음이 거의 없어서 거실에 두어도 괜찮다.</p>\n<ul>\n<li><strong>역할 분리</strong>: 모든 서비스를 NAS에서 돌리던 것을 LXC/VM으로 분리. Gateway, Monitoring, Registry, k3s 각각 독립적으로 운영</li>\n<li><strong>Subnet Router 이전</strong>: NAS에서 Gateway LXC로 Tailscale Subnet Router를 옮겼다. 네트워크 진입점을 한 곳으로 모으기 위해</li>\n<li><strong>CoreDNS 도입</strong>: Split DNS를 위해 Gateway에 CoreDNS를 설치. 내부에서는 <code class=\"language-text\">*.internal.jiun.dev</code>로 접근</li>\n</ul>\n<blockquote>\n<p>이후 이 구성을 Terraform + Ansible로 코드화했다. 자세한 내용은 <a href=\"/posts/home-lab-iac\">Home Lab IaC</a> 글 참고.</p>\n</blockquote>\n<hr>\n<h2 id=\"구현-요약\">구현 요약</h2>\n<h3 id=\"1-iptime-dmzport-forward-끄기\">1) ipTIME: DMZ/Port Forward 끄기</h3>\n<ul>\n<li>DMZ OFF</li>\n<li>Port Forward OFF</li>\n</ul>\n<h3 id=\"2-tailscale-nas를-subnet-router로\">2) Tailscale: NAS를 Subnet Router로</h3>\n<p>NAS가 <code class=\"language-text\">192.168.0.0/24</code> route를 advertise 하고, Tailnet Admin에서 승인해서 “집 내부 IP로 접근”을 가능하게 만들었다. Subnet Router는 “특정 사설 Subnet만 tailnet에 연결”하는 패턴이라, Exit Node(전체 트래픽 우회)와 개념이 다르다.<sup id=\"fnref-tailscale-subnet\"><a href=\"#fn-tailscale-subnet\" class=\"footnote-ref\">tailscale-subnet</a></sup></p>\n<p>추가로, ACL/Tags를 붙이면 “누가 Home LAN에 들어올 수 있는지”를 강제할 수 있다.<sup id=\"fnref-tailscale-acl\"><a href=\"#fn-tailscale-acl\" class=\"footnote-ref\">tailscale-acl</a></sup><sup id=\"fnref-tailscale-tags\"><a href=\"#fn-tailscale-tags\" class=\"footnote-ref\">tailscale-tags</a></sup></p>\n<h3 id=\"3-cloudflare-tunneljiundev-dsm만-public으로\">3) Cloudflare Tunnel(jiun.dev): DSM만 Public으로</h3>\n<p>DSM은 <code class=\"language-text\">https://&lt;NAS></code> 형태로 내부에서 잘 열리는 걸 확인한 뒤, <code class=\"language-text\">nas.jiun.dev</code>를 Cloudflare Tunnel의 <strong>Public Hostname</strong>으로 publish하고, origin을 <code class=\"language-text\">https://127.0.0.1:6006</code>로 지정했다(DSM Docker에서 cloudflared 실행). Tunnel은 “공개 Hostname → 내부 origin”을 매핑하는 모델이다.<sup id=\"fnref-cf-tunnel-routing\"><a href=\"#fn-cf-tunnel-routing\" class=\"footnote-ref\">cf-tunnel-routing</a></sup></p>\n<p>DSM 인증서가 내부 전용이라 TLS 검증이 실패하면, cloudflared에서 <strong>No TLS Verify</strong>(또는 동등 설정)가 필요할 수 있다.<sup id=\"fnref-cf-origin-params\"><a href=\"#fn-cf-origin-params\" class=\"footnote-ref\">cf-origin-params</a></sup></p>\n<p>그리고 DSM 같은 관리면은 Cloudflare Access로 잠그는 게 깔끔하다(최소한 계정/MFA).<sup id=\"fnref-cf-access-selfhosted\"><a href=\"#fn-cf-access-selfhosted\" class=\"footnote-ref\">cf-access-selfhosted</a></sup></p>\n<h3 id=\"4-cloudflare-tunneldevdomain-k3s에-iac로-유지\">4) Cloudflare Tunnel(dev.domain): k3s에 IaC로 유지</h3>\n<p><code class=\"language-text\">dev.domain</code>는 서비스가 많아서 k3s에 이미 IaC로 cloudflared를 배포 중이라, 기존 패턴(Deployment + Secret) 그대로 유지했다. 즉:</p>\n<ul>\n<li><code class=\"language-text\">dev.domain</code>: k3s cloudflared (k8s Deployment)</li>\n<li><code class=\"language-text\">jiun.dev</code>: DSM Docker cloudflared (container 1개)</li>\n</ul>\n<h3 id=\"5-registrydevdomain-private-onlytailscale-내부에서만\">5) registry.dev.domain: private-only(Tailscale 내부에서만)</h3>\n<p>Registry는 Reverse Proxy 구조 자체는 유지하되, 실제 접근은 Tailscale 내부에서만 하도록 했다.</p>\n<ul>\n<li>Cloudflare Tunnel/Public Hostname에서 <code class=\"language-text\">registry.dev.domain</code>는 제외</li>\n<li>NAS Firewall에서 <code class=\"language-text\">100.64.0.0/10</code>(Tailscale)만 443 허용 같은 식으로 강제</li>\n<li>Split DNS로 <code class=\"language-text\">registry.dev.domain</code>가 tailnet 내부 IP로 해석되게 구성</li>\n</ul>\n<hr>\n<h2 id=\"split-dns와-coredns\">Split DNS와 CoreDNS</h2>\n<p>내부 서비스에 접근할 때 IP 주소를 외우고 싶지 않았다. <code class=\"language-text\">grafana.internal.jiun.dev</code>처럼 도메인으로 접근하고 싶었는데, 문제는 이 도메인이 외부에서는 해석되면 안 된다는 것이다. 이걸 해결하는 게 Split DNS다.</p>\n<h3 id=\"split-dns란\">Split DNS란</h3>\n<p>같은 도메인이라도 <strong>어디서 질의하느냐에 따라 다른 IP를 반환</strong>하는 구성이다:</p>\n<table>\n<thead>\n<tr>\n<th>도메인</th>\n<th>외부(인터넷)</th>\n<th>내부(Tailscale)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code class=\"language-text\">grafana.jiun.dev</code></td>\n<td>Cloudflare → Tunnel</td>\n<td>해석 안 됨 (또는 Tunnel)</td>\n</tr>\n<tr>\n<td><code class=\"language-text\">grafana.internal.jiun.dev</code></td>\n<td>해석 안 됨</td>\n<td>CoreDNS → 192.168.32.10</td>\n</tr>\n</tbody>\n</table>\n<p>외부 사용자가 <code class=\"language-text\">internal.jiun.dev</code>를 질의해도 응답이 없다. 이 도메인은 오직 내부 DNS(CoreDNS)에서만 해석된다.</p>\n<h3 id=\"coredns-구성\">CoreDNS 구성</h3>\n<p>Gateway LXC에 CoreDNS를 설치하고, Tailscale의 DNS 설정에서 이 서버를 지정했다. Corefile은 이렇게 생겼다:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">internal.jiun.dev {\n    hosts /etc/coredns/hosts.internal.jiun.dev {\n        fallthrough\n    }\n    forward . 1.1.1.1 8.8.8.8\n    log\n    errors\n}\n\njiun.dev {\n    hosts /etc/coredns/hosts.jiun.dev {\n        fallthrough\n    }\n    forward . 1.1.1.1 8.8.8.8\n    log\n    errors\n}\n\n. {\n    forward . 1.1.1.1 8.8.8.8\n    cache 30\n    log\n    errors\n}</code></pre></div>\n<p><code class=\"language-text\">internal.jiun.dev</code> 존은 hosts 파일에서 먼저 찾고, 없으면 upstream DNS로 forward한다. 나머지 도메인(<code class=\"language-text\">.</code>)은 그냥 upstream으로 보낸다.</p>\n<h3 id=\"dns-레코드-관리\">DNS 레코드 관리</h3>\n<p>hosts 파일은 이런 식으로 구성된다:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># /etc/coredns/hosts.internal.jiun.dev\n192.168.32.10  grafana.internal.jiun.dev\n192.168.32.10  prometheus.internal.jiun.dev\n192.168.32.10  registry.internal.jiun.dev\n192.168.32.10  argocd.internal.jiun.dev\n192.168.32.10  pve.internal.jiun.dev</code></pre></div>\n<p>대부분의 서비스가 Gateway(192.168.32.10)를 가리키는 이유는, Gateway에서 nginx 리버스 프록시로 각 서비스에 라우팅하기 때문이다. 도메인별로 다른 백엔드로 보내는 구조다.</p>\n<h3 id=\"tailscale-dns-설정\">Tailscale DNS 설정</h3>\n<p>Tailscale Admin Console에서 DNS 설정을 추가한다:</p>\n<ol>\n<li><strong>Nameservers</strong>: <code class=\"language-text\">192.168.32.10</code> (Gateway)를 Split DNS로 추가</li>\n<li><strong>Split DNS domains</strong>: <code class=\"language-text\">internal.jiun.dev</code>, <code class=\"language-text\">jiun.dev</code></li>\n</ol>\n<p>이렇게 하면 Tailscale 클라이언트는 <code class=\"language-text\">*.internal.jiun.dev</code> 질의를 Gateway로 보내고, Gateway의 CoreDNS가 내부 IP를 반환한다.</p>\n<p>결과적으로 Tailscale에 연결된 상태에서 <code class=\"language-text\">grafana.internal.jiun.dev</code>를 브라우저에 입력하면 내부 Grafana에 접속된다. 외부에서는 이 도메인이 존재하지 않는 것처럼 보인다.</p>\n<hr>\n<h2 id=\"보안-관점에서-본-변경\">보안 관점에서 본 변경</h2>\n<p>단순히 \"편해졌다\"가 아니라, 보안 측면에서도 의미 있는 개선이었다.</p>\n<h3 id=\"dmzport-forward의-위험성\">DMZ/Port Forward의 위험성</h3>\n<p>기존 구성의 문제점을 정리하면:</p>\n<table>\n<thead>\n<tr>\n<th>위험 요소</th>\n<th>설명</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>공격 표면 확대</strong></td>\n<td>DMZ로 NAS 전체 포트가 인터넷에 노출. 취약점 하나로 전체 시스템 침해 가능</td>\n</tr>\n<tr>\n<td><strong>무차별 대입 공격</strong></td>\n<td>SSH, DSM 로그인 페이지가 외부에서 접근 가능. 봇에 의한 brute force 시도</td>\n</tr>\n<tr>\n<td><strong>내부망 침투 경로</strong></td>\n<td>NAS가 뚫리면 같은 LAN의 다른 장비(PC, IoT 등)도 위험</td>\n</tr>\n<tr>\n<td><strong>암호화 미적용 구간</strong></td>\n<td>일부 서비스가 HTTP로 노출될 경우 MITM 가능</td>\n</tr>\n</tbody>\n</table>\n<p>10년간 별일 없었던 건 운이 좋았던 것일 수 있다. 취약점이 발견되거나 잘못된 설정이 있었다면 피해를 입었을 것이다.\n<del>사실 ssh 포트만 열어뒀는데 무차별 대입 공격 시도는 빈번했었다.</del></p>\n<h3 id=\"zero-trust-접근\">Zero Trust 접근</h3>\n<p>새 구성은 \"Zero Trust\" 원칙에 가깝다:</p>\n<ol>\n<li><strong>네트워크 위치를 신뢰하지 않음</strong>: 사내망이든 집이든 Tailscale 인증 없이는 접근 불가</li>\n<li><strong>기본 차단, 명시적 허용</strong>: Router inbound를 전부 막고, Cloudflare Tunnel로 필요한 것만 노출</li>\n<li><strong>최소 권한</strong>: 각 서비스별로 접근 권한을 Tailscale ACL로 제어 가능</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token comment\">// Tailscale ACL 예시</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"acls\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"action\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"accept\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"src\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"tag:admin\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"dst\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"192.168.32.0/24:*\"</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"action\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"accept\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"src\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"tag:developer\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"dst\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"192.168.32.66:443\"</span><span class=\"token punctuation\">]</span> <span class=\"token comment\">// k8s만 허용</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"계층별-보안\">계층별 보안</h3>\n<p>현재 구성의 보안 계층을 정리하면:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">┌─────────────────────────────────────────────────────────┐\n│ Layer 1: Network (Router)                               │\n│ - Inbound 전체 차단 (DMZ OFF, Port Forward OFF)           │\n│ - 물리적으로 외부에서 내부망 접근 불가                           │\n└─────────────────────────────────────────────────────────┘\n                          ↓\n┌─────────────────────────────────────────────────────────┐\n│ Layer 2: Overlay Network (Tailscale)                    │\n│ - WireGuard 기반 암호화 (상시 E2E 암호화)               │\n│ - 디바이스별 인증 (SSO 연동 가능)                       │\n│ - ACL로 접근 제어                                       │\n└─────────────────────────────────────────────────────────┘\n                          ↓\n┌─────────────────────────────────────────────────────────┐\n│ Layer 3: Application Gateway (Cloudflare Tunnel)        │\n│ - 외부 노출 서비스만 선택적 publish                     │\n│ - Cloudflare Access로 추가 인증 (MFA)                   │\n│ - DDoS 보호, WAF 적용 가능                              │\n└─────────────────────────────────────────────────────────┘\n                          ↓\n┌─────────────────────────────────────────────────────────┐\n│ Layer 4: Service Level                                  │\n│ - 각 서비스별 자체 인증 (Grafana, ArgoCD 등)            │\n│ - HTTPS 강제 (Let's Encrypt 또는 Cloudflare Origin CA) │\n└─────────────────────────────────────────────────────────┘</code></pre></div>\n<p>각 계층이 독립적으로 동작해서, 한 계층이 뚫려도 다음 계층에서 막을 수 있다.</p>\n<hr>\n<h2 id=\"결론\">결론</h2>\n<p>이번 Migration의 핵심은 기능 추가가 아니라 “경계 정리”였다.</p>\n<ul>\n<li>Router inbound를 없애고(DMZ/Port Forward OFF)</li>\n<li>Private는 Tailscale로 단일화하고</li>\n<li>Public은 Cloudflare Tunnel로 단일화했다</li>\n</ul>\n<p>이렇게 하니 보안/운영/확장성(Domain 추가, 서비스 추가)이 동시에 좋아졌다.</p>\n<p>특히 Tailscale을 사용해보고서 기능적 장점들도 많았지만 심리스하게 잘 동작한다는 점에서 매우 마음에 들었다.</p>\n<ul>\n<li>Inbound 없이 내부 네트워크처럼 붙고 WireGuard 기반이라 빠르고 운영이 쉽다.</li>\n<li>대부분 환경에서 Direct로 붙고 필요한경우 DERP relay로 자동 전환되기 때문에 안정적이다.</li>\n<li>Subnet Router로 <code class=\"language-text\">192.168.0.0/24</code> 처럼 LAN 전체를 내부망처럼 접근할 수 있어서 편리하다.</li>\n<li>ACL/Tags로 “누가 어디에 접근할 수 있는지”를 세밀하게 제어할 수 있다.</li>\n</ul>\n<p>미뤄뒀던 짐을 하나씩 정리하는 기분이 들었고, 앞으로도 집 개발 환경을 더 잘 활용할 수 있을 것 같다.</p>\n<h2 id=\"관련-글\">관련 글</h2>\n<ul>\n<li><a href=\"/posts/home-lab-iac\">Home Lab IaC</a></li>\n<li><a href=\"/posts/claude-code-cloud\">Claude Code Cloud</a></li>\n</ul>\n<hr>\n<h2 id=\"각주참고\">각주/참고</h2>\n<h3 id=\"추가-참고\">추가 참고</h3>\n<ul>\n<li><a href=\"https://coredns.io/manual/toc/\">CoreDNS Manual</a></li>\n<li><a href=\"https://tailscale.com/kb/1054/dns\">Tailscale Split DNS</a></li>\n<li><a href=\"https://www.nist.gov/publications/zero-trust-architecture\">Zero Trust Security Model (NIST)</a></li>\n</ul>\n<div class=\"footnotes\">\n<hr>\n<ol>\n<li id=\"fn-tailscale-subnet\">Tailscale Subnet routers: <a href=\"https://tailscale.com/kb/1019/subnets\">https://tailscale.com/kb/1019/subnets</a><a href=\"#fnref-tailscale-subnet\" class=\"footnote-backref\">↩</a></li>\n<li id=\"fn-tailscale-acl\">Tailscale ACLs: <a href=\"https://tailscale.com/kb/1018/acls\">https://tailscale.com/kb/1018/acls</a><a href=\"#fnref-tailscale-acl\" class=\"footnote-backref\">↩</a></li>\n<li id=\"fn-tailscale-tags\">Tailscale Tags: <a href=\"https://tailscale.com/kb/1068/tags\">https://tailscale.com/kb/1068/tags</a><a href=\"#fnref-tailscale-tags\" class=\"footnote-backref\">↩</a></li>\n<li id=\"fn-cf-tunnel-routing\">Cloudflare Tunnel routing(Public Hostname → origin): <a href=\"https://developers.cloudflare.com/cloudflare-one/networks/connectors/cloudflare-tunnel/routing-to-tunnel/\">https://developers.cloudflare.com/cloudflare-one/networks/connectors/cloudflare-tunnel/routing-to-tunnel/</a><a href=\"#fnref-cf-tunnel-routing\" class=\"footnote-backref\">↩</a></li>\n<li id=\"fn-cf-origin-params\">cloudflared origin parameters(No TLS Verify 등): <a href=\"https://developers.cloudflare.com/cloudflare-one/networks/connectors/cloudflare-tunnel/configure-tunnels/cloudflared-parameters/origin-parameters/\">https://developers.cloudflare.com/cloudflare-one/networks/connectors/cloudflare-tunnel/configure-tunnels/cloudflared-parameters/origin-parameters/</a><a href=\"#fnref-cf-origin-params\" class=\"footnote-backref\">↩</a></li>\n<li id=\"fn-cf-access-selfhosted\">Cloudflare Access(Self-hosted apps): <a href=\"https://developers.cloudflare.com/cloudflare-one/access-controls/applications/http-apps/self-hosted-public-app/\">https://developers.cloudflare.com/cloudflare-one/access-controls/applications/http-apps/self-hosted-public-app/</a><a href=\"#fnref-cf-access-selfhosted\" class=\"footnote-backref\">↩</a></li>\n</ol>\n</div>","excerpt":"Home Lab 네트워크 “DMZ/Port Forward”에서 “Tailscale + Cloudflare Tunnel”로 갈아탄 기록 목표: 공개 노출은 최소(필요한 것만), 나머지는 전부 private로. 결과: Router inbound(Port Forward/DMZ) “0”에 가깝게 만들고, 관리/운영이 쉬워졌다. 배경: 왜 갈아탔나 처음에는 공유기…","frontmatter":{"date":"25.12.12","dateISO":"2025-12-12","description":"집 개발 환경 구축하기","slug":"/home-dev","heroImage":null,"heroImageAlt":null,"tags":["dev","homelab","tailscale","cloudflare"],"title":"Home Dev Environment"},"tableOfContents":"<ul>\n<li>\n<p><a href=\"#home-lab-%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC-dmzport-forward%EC%97%90%EC%84%9C-tailscale--cloudflare-tunnel%EB%A1%9C-%EA%B0%88%EC%95%84%ED%83%84-%EA%B8%B0%EB%A1%9D\">Home Lab 네트워크 “DMZ/Port Forward”에서 “Tailscale + Cloudflare Tunnel”로 갈아탄 기록</a></p>\n<ul>\n<li>\n<p><a href=\"#%EB%B0%B0%EA%B2%BD-%EC%99%9C-%EA%B0%88%EC%95%84%ED%83%94%EB%82%98\">배경: 왜 갈아탔나</a></p>\n</li>\n<li>\n<p><a href=\"#%EA%B8%B0%EC%A1%B4-%EA%B5%AC%EC%84%B1\">기존 구성</a></p>\n</li>\n<li>\n<p><a href=\"#%EC%84%A4%EA%B3%84-%EB%AA%A9%ED%91%9C\">설계 목표</a></p>\n</li>\n<li>\n<p><a href=\"#%ED%98%84%EC%9E%AC-%EA%B5%AC%EC%84%B1\">현재 구성</a></p>\n<ul>\n<li><a href=\"#%EA%B5%AC%EC%84%B1-%EB%B3%80%EA%B2%BD-%EC%82%AC%ED%95%AD-202412--202501\">구성 변경 사항 (2024.12 → 2025.01)</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EA%B5%AC%ED%98%84-%EC%9A%94%EC%95%BD\">구현 요약</a></p>\n<ul>\n<li><a href=\"#1-iptime-dmzport-forward-%EB%81%84%EA%B8%B0\">1) ipTIME: DMZ/Port Forward 끄기</a></li>\n<li><a href=\"#2-tailscale-nas%EB%A5%BC-subnet-router%EB%A1%9C\">2) Tailscale: NAS를 Subnet Router로</a></li>\n<li><a href=\"#3-cloudflare-tunneljiundev-dsm%EB%A7%8C-public%EC%9C%BC%EB%A1%9C\">3) Cloudflare Tunnel(jiun.dev): DSM만 Public으로</a></li>\n<li><a href=\"#4-cloudflare-tunneldevdomain-k3s%EC%97%90-iac%EB%A1%9C-%EC%9C%A0%EC%A7%80\">4) Cloudflare Tunnel(dev.domain): k3s에 IaC로 유지</a></li>\n<li><a href=\"#5-registrydevdomain-private-onlytailscale-%EB%82%B4%EB%B6%80%EC%97%90%EC%84%9C%EB%A7%8C\">5) registry.dev.domain: private-only(Tailscale 내부에서만)</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#split-dns%EC%99%80-coredns\">Split DNS와 CoreDNS</a></p>\n<ul>\n<li><a href=\"#split-dns%EB%9E%80\">Split DNS란</a></li>\n<li><a href=\"#coredns-%EA%B5%AC%EC%84%B1\">CoreDNS 구성</a></li>\n<li><a href=\"#dns-%EB%A0%88%EC%BD%94%EB%93%9C-%EA%B4%80%EB%A6%AC\">DNS 레코드 관리</a></li>\n<li><a href=\"#tailscale-dns-%EC%84%A4%EC%A0%95\">Tailscale DNS 설정</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EB%B3%B4%EC%95%88-%EA%B4%80%EC%A0%90%EC%97%90%EC%84%9C-%EB%B3%B8-%EB%B3%80%EA%B2%BD\">보안 관점에서 본 변경</a></p>\n<ul>\n<li><a href=\"#dmzport-forward%EC%9D%98-%EC%9C%84%ED%97%98%EC%84%B1\">DMZ/Port Forward의 위험성</a></li>\n<li><a href=\"#zero-trust-%EC%A0%91%EA%B7%BC\">Zero Trust 접근</a></li>\n<li><a href=\"#%EA%B3%84%EC%B8%B5%EB%B3%84-%EB%B3%B4%EC%95%88\">계층별 보안</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EA%B2%B0%EB%A1%A0\">결론</a></p>\n</li>\n<li>\n<p><a href=\"#%EA%B4%80%EB%A0%A8-%EA%B8%80\">관련 글</a></p>\n</li>\n<li>\n<p><a href=\"#%EA%B0%81%EC%A3%BC%EC%B0%B8%EA%B3%A0\">각주/참고</a></p>\n<ul>\n<li><a href=\"#%EC%B6%94%EA%B0%80-%EC%B0%B8%EA%B3%A0\">추가 참고</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>"}},"pageContext":{"id":"5b57d275-02a8-567d-979b-7668cea92799","frontmatter__slug":"/home-dev","previous":"/home-lab-iac","previousTitle":"Home Lab IaC","next":"/claude-code-cloud","nextTitle":"Claude Code Cloud"}},"staticQueryHashes":["12962592","3399079524","3470099541","4097432363","76375841"],"slicesMap":{}}