{"componentChunkName":"component---src-templates-post-tsx","path":"/posts/fastconformer-stt-development/","result":{"data":{"markdownRemark":{"html":"<h1 id=\"fastconformer로-stt-엔진-만들면서-배운-것들\">FastConformer로 STT 엔진 만들면서 배운 것들</h1>\n<p>Return Zero에서 STT 엔진 개발을 맡게 되었습니다. 한국어와 일본어를 동시에 지원해야 했는데, 기존 모델로는 만족스러운 성능이 나오지 않아서 FastConformer를 도입하게 되었습니다. 그 과정에서 겪은 문제들과 해결 방법을 공유합니다.</p>\n<h2 id=\"왜-fastconformer였나\">왜 FastConformer였나</h2>\n<p>처음에는 Whisper를 고려했습니다. OpenAI에서 공개한 모델이고, 성능도 좋다고 알려져 있으니까요. 하지만 Whisper에는 치명적인 문제가 있었습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># Whisper의 문제: 전체 오디오를 받아야 처리 시작</span>\n<span class=\"token keyword\">import</span> whisper\n\nmodel <span class=\"token operator\">=</span> whisper<span class=\"token punctuation\">.</span>load_model<span class=\"token punctuation\">(</span><span class=\"token string\">\"base\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 30초 오디오 전체를 받은 후에야 처리 가능</span>\nresult <span class=\"token operator\">=</span> model<span class=\"token punctuation\">.</span>transcribe<span class=\"token punctuation\">(</span><span class=\"token string\">\"audio.wav\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 실시간 서비스에서 이러면 30초 지연 발생</span>\n<span class=\"token comment\"># 사용자가 말 끝나고 30초 기다려야 텍스트가 나온다</span></code></pre></div>\n<p>저희 서비스는 실시간으로 자막을 보여줘야 했습니다. Whisper처럼 전체 오디오를 다 받은 다음에 처리하면 사용자 경험이 매우 나빠집니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># 스트리밍 STT 요구사항</span>\nREQUIREMENTS <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"latency\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">\"target\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"&lt;500ms\"</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># 말한 지 0.5초 내에 텍스트</span>\n        <span class=\"token string\">\"whisper\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"30000ms\"</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># Whisper는 전체 오디오 길이만큼 대기</span>\n        <span class=\"token string\">\"verdict\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"불가능\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"realtime_factor\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">\"target\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"&lt;0.3\"</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># 1초 오디오를 0.3초 안에 처리</span>\n        <span class=\"token string\">\"description\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"RTF = 처리시간 / 오디오시간\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"memory\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">\"target\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"&lt;8GB\"</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># 서버 1대에 여러 요청 동시 처리</span>\n        <span class=\"token string\">\"description\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"동시 요청 수 = GPU 메모리 / 모델 메모리\"</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><a href=\"https://arxiv.org/abs/2305.05084\">FastConformer</a>는 NVIDIA에서 발표한 모델로, 스트리밍 처리가 가능합니다. 오디오가 들어오는 대로 바로바로 텍스트로 변환할 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># FastConformer 스트리밍 처리 개념</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">StreamingFastConformer</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    FastConformer의 핵심 장점:\n    1. 청크 단위 처리 - 전체 오디오 기다리지 않음\n    2. 캐시 활용 - 이전 컨텍스트 재계산 없이 재사용\n    3. 낮은 지연시간 - 실시간 서비스에 적합\n    \"\"\"</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> model_path<span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        self<span class=\"token punctuation\">.</span>model <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>load_model<span class=\"token punctuation\">(</span>model_path<span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>encoder_cache <span class=\"token operator\">=</span> <span class=\"token boolean\">None</span>\n        self<span class=\"token punctuation\">.</span>decoder_cache <span class=\"token operator\">=</span> <span class=\"token boolean\">None</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">process_chunk</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> audio_chunk<span class=\"token punctuation\">:</span> np<span class=\"token punctuation\">.</span>ndarray<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">:</span>\n        <span class=\"token triple-quoted-string string\">\"\"\"\n        청크 단위로 오디오를 처리합니다.\n\n        Args:\n            audio_chunk: 1.6초 분량의 오디오 (16kHz 기준 25600 샘플)\n\n        Returns:\n            해당 구간의 텍스트\n        \"\"\"</span>\n        <span class=\"token comment\"># 인코더: 오디오 → 특징 벡터</span>\n        <span class=\"token comment\"># 캐시를 활용해 이전 청크 정보 유지</span>\n        features<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">.</span>encoder_cache <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span>encode<span class=\"token punctuation\">(</span>\n            audio_chunk<span class=\"token punctuation\">,</span>\n            cache<span class=\"token operator\">=</span>self<span class=\"token punctuation\">.</span>encoder_cache\n        <span class=\"token punctuation\">)</span>\n\n        <span class=\"token comment\"># 디코더: 특징 벡터 → 텍스트</span>\n        text<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">.</span>decoder_cache <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span>decode<span class=\"token punctuation\">(</span>\n            features<span class=\"token punctuation\">,</span>\n            cache<span class=\"token operator\">=</span>self<span class=\"token punctuation\">.</span>decoder_cache\n        <span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">return</span> text</code></pre></div>\n<h2 id=\"nemo-프레임워크-활용\">NeMo 프레임워크 활용</h2>\n<p>FastConformer를 직접 구현하는 것보다 NVIDIA의 <a href=\"https://github.com/NVIDIA/NeMo\">NeMo</a> 프레임워크를 활용하는 것이 효율적이었습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> nemo<span class=\"token punctuation\">.</span>collections<span class=\"token punctuation\">.</span>asr <span class=\"token keyword\">as</span> nemo_asr\n<span class=\"token keyword\">from</span> omegaconf <span class=\"token keyword\">import</span> OmegaConf\n\n<span class=\"token comment\"># 사전학습된 FastConformer 모델 로드</span>\nmodel <span class=\"token operator\">=</span> nemo_asr<span class=\"token punctuation\">.</span>models<span class=\"token punctuation\">.</span>EncDecCTCModelBPE<span class=\"token punctuation\">.</span>from_pretrained<span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"nvidia/parakeet-ctc-1.1b\"</span>  <span class=\"token comment\"># 1.1B 파라미터</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 또는 더 작은 모델</span>\nmodel_small <span class=\"token operator\">=</span> nemo_asr<span class=\"token punctuation\">.</span>models<span class=\"token punctuation\">.</span>EncDecCTCModelBPE<span class=\"token punctuation\">.</span>from_pretrained<span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"nvidia/parakeet-ctc-0.6b\"</span>  <span class=\"token comment\"># 600M 파라미터</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 모델 크기별 비교</span>\nMODEL_COMPARISON <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"parakeet-ctc-0.6b\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">\"params\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"600M\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"memory\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"2.4GB\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"WER_librispeech\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"2.5%\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"use_case\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"실시간 서비스, 리소스 제한 환경\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"parakeet-ctc-1.1b\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">\"params\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"1.1B\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"memory\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"4.4GB\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"WER_librispeech\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"1.8%\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"use_case\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"정확도 중시, 배치 처리\"</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"삽질-기록\">삽질 기록</h2>\n<h3 id=\"1-한국어-자모-분리-문제\">1. 한국어 자모 분리 문제</h3>\n<p>한국어 STT에서 가장 먼저 부딪힌 문제는 자모 분리였습니다. \"감사합니다\"를 \"간사합니다\"로 인식하는 등의 오류가 빈번했습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># 문제 상황: 자모 분리 방식에 따른 성능 차이</span>\nJAMO_ISSUES <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"original_text\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"감사합니다\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"wrong_recognition\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"간사합니다\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"cause\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"받침 'ㅁ'과 'ㄴ'의 음향적 유사성 + 잘못된 토크나이징\"</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\"># 기본 라이브러리 사용 시 문제</span>\n<span class=\"token keyword\">from</span> jamo <span class=\"token keyword\">import</span> h2j<span class=\"token punctuation\">,</span> j2hcj\n\n<span class=\"token comment\"># \"감\"을 분리하면</span>\nh2j<span class=\"token punctuation\">(</span><span class=\"token string\">\"감\"</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># 'ㄱㅏㅁ'</span>\n\n<span class=\"token comment\"># 그런데 토크나이저가 이걸 어떻게 처리하느냐에 따라 성능 차이 발생</span></code></pre></div>\n<p>결국 자모 분리 로직을 직접 구현했습니다. 특히 받침 처리가 까다로웠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">KoreanJamoProcessor</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    한국어 자모 처리기\n\n    핵심 개선:\n    1. 겹받침 처리 로직 개선\n    2. 음절 경계 인식 강화\n    3. 토크나이저와의 정합성\n    \"\"\"</span>\n\n    <span class=\"token comment\"># 초성, 중성, 종성 정의</span>\n    CHOSUNG <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token string\">'ㄱ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㄲ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㄴ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㄷ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㄸ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㄹ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㅁ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㅂ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㅃ'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'ㅅ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㅆ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㅇ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㅈ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㅉ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㅊ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㅋ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㅌ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㅍ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㅎ'</span>\n    <span class=\"token punctuation\">]</span>\n    JUNGSUNG <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token string\">'ㅏ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㅐ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㅑ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㅒ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㅓ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㅔ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㅕ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㅖ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㅗ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㅘ'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'ㅙ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㅚ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㅛ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㅜ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㅝ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㅞ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㅟ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㅠ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㅡ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㅢ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㅣ'</span>\n    <span class=\"token punctuation\">]</span>\n    JONGSUNG <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token string\">''</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㄱ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㄲ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㄳ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㄴ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㄵ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㄶ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㄷ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㄹ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㄺ'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'ㄻ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㄼ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㄽ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㄾ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㄿ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㅀ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㅁ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㅂ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㅄ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㅅ'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'ㅆ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㅇ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㅈ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㅊ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㅋ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㅌ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㅍ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㅎ'</span>\n    <span class=\"token punctuation\">]</span>\n\n    <span class=\"token comment\"># 겹받침 분해 규칙</span>\n    DOUBLE_JONGSUNG <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">'ㄳ'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'ㄱ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㅅ'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'ㄵ'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'ㄴ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㅈ'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'ㄶ'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'ㄴ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㅎ'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'ㄺ'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'ㄹ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㄱ'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'ㄻ'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'ㄹ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㅁ'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'ㄼ'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'ㄹ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㅂ'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'ㄽ'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'ㄹ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㅅ'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'ㄾ'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'ㄹ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㅌ'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'ㄿ'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'ㄹ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㅍ'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'ㅀ'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'ㄹ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㅎ'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'ㅄ'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'ㅂ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ㅅ'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">decompose</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> text<span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">list</span><span class=\"token punctuation\">[</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span>\n        <span class=\"token triple-quoted-string string\">\"\"\"\n        한글 텍스트를 자모 시퀀스로 분해합니다.\n\n        개선점:\n        - 겹받침은 두 개의 토큰으로 분리\n        - 음절 경계에 특수 토큰 추가 (선택적)\n        - 영어/숫자는 그대로 유지\n        \"\"\"</span>\n        result <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\n        <span class=\"token keyword\">for</span> char <span class=\"token keyword\">in</span> text<span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">if</span> <span class=\"token string\">'가'</span> <span class=\"token operator\">&lt;=</span> char <span class=\"token operator\">&lt;=</span> <span class=\"token string\">'힣'</span><span class=\"token punctuation\">:</span>\n                <span class=\"token comment\"># 한글 음절 분해</span>\n                code <span class=\"token operator\">=</span> <span class=\"token builtin\">ord</span><span class=\"token punctuation\">(</span>char<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token builtin\">ord</span><span class=\"token punctuation\">(</span><span class=\"token string\">'가'</span><span class=\"token punctuation\">)</span>\n                cho <span class=\"token operator\">=</span> code <span class=\"token operator\">//</span> <span class=\"token punctuation\">(</span><span class=\"token number\">21</span> <span class=\"token operator\">*</span> <span class=\"token number\">28</span><span class=\"token punctuation\">)</span>\n                jung <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>code <span class=\"token operator\">%</span> <span class=\"token punctuation\">(</span><span class=\"token number\">21</span> <span class=\"token operator\">*</span> <span class=\"token number\">28</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">//</span> <span class=\"token number\">28</span>\n                jong <span class=\"token operator\">=</span> code <span class=\"token operator\">%</span> <span class=\"token number\">28</span>\n\n                result<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>CHOSUNG<span class=\"token punctuation\">[</span>cho<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n                result<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>JUNGSUNG<span class=\"token punctuation\">[</span>jung<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n                <span class=\"token keyword\">if</span> jong <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span>\n                    jongsung <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>JONGSUNG<span class=\"token punctuation\">[</span>jong<span class=\"token punctuation\">]</span>\n                    <span class=\"token comment\"># 겹받침 분해</span>\n                    <span class=\"token keyword\">if</span> jongsung <span class=\"token keyword\">in</span> self<span class=\"token punctuation\">.</span>DOUBLE_JONGSUNG<span class=\"token punctuation\">:</span>\n                        j1<span class=\"token punctuation\">,</span> j2 <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>DOUBLE_JONGSUNG<span class=\"token punctuation\">[</span>jongsung<span class=\"token punctuation\">]</span>\n                        result<span class=\"token punctuation\">.</span>extend<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>j1<span class=\"token punctuation\">,</span> j2<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n                        result<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>jongsung<span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n                <span class=\"token comment\"># 비한글 문자는 그대로</span>\n                result<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>char<span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">return</span> result\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">compose</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> jamo_list<span class=\"token punctuation\">:</span> <span class=\"token builtin\">list</span><span class=\"token punctuation\">[</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">:</span>\n        <span class=\"token triple-quoted-string string\">\"\"\"\n        자모 시퀀스를 한글 텍스트로 조합합니다.\n        \"\"\"</span>\n        <span class=\"token comment\"># 구현 생략 - 분해의 역과정</span>\n        <span class=\"token keyword\">pass</span>\n\n\n<span class=\"token comment\"># 적용 후 성능 변화</span>\nJAMO_IMPROVEMENT <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"before\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">\"CER\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"4.8%\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"common_errors\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"받침 혼동\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"겹받침 오류\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"연음 처리 실패\"</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"after\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">\"CER\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"3.1%\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"improvement\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"35% 오류 감소\"</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"2-일본어-표기-통일-문제\">2. 일본어 표기 통일 문제</h3>\n<p>일본어는 또 다른 문제가 있었습니다. 같은 발음이 히라가나, 가타카나, 한자로 표기될 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># 일본어 표기의 다양성</span>\nJAPANESE_WRITING_SYSTEMS <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"arigatou\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">\"hiragana\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"ありがとう\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"kanji\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"有難う\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"same_pronunciation\"</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">True</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"coffee\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">\"katakana\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"コーヒー\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"hiragana\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"こーひー\"</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># 가능하지만 잘 안 씀</span>\n        <span class=\"token string\">\"note\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"외래어는 보통 가타카나\"</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\"># 문제: 학습 데이터마다 표기가 다름</span>\n<span class=\"token comment\"># → 모델이 혼란스러워함</span>\n<span class=\"token comment\"># → 같은 발음에 대해 다른 출력</span></code></pre></div>\n<p>저희는 히라가나 기준으로 통일하고, 후처리에서 한자/가타카나로 변환하는 방식을 택했습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> MeCab\n<span class=\"token keyword\">from</span> typing <span class=\"token keyword\">import</span> Optional\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">JapanesePostProcessor</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    일본어 후처리기\n\n    전략:\n    1. STT 출력은 히라가나로 통일\n    2. 형태소 분석으로 한자 후보 추출\n    3. 문맥에 맞는 표기로 변환\n    \"\"\"</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># MeCab 초기화 (형태소 분석기)</span>\n        self<span class=\"token punctuation\">.</span>mecab <span class=\"token operator\">=</span> MeCab<span class=\"token punctuation\">.</span>Tagger<span class=\"token punctuation\">(</span><span class=\"token string\">\"-Ochasen\"</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token comment\"># 가타카나로 표기해야 하는 외래어 사전</span>\n        self<span class=\"token punctuation\">.</span>gairaigo_dict <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>load_gairaigo_dict<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">process</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> hiragana_text<span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">:</span>\n        <span class=\"token triple-quoted-string string\">\"\"\"\n        히라가나 텍스트를 적절한 표기로 변환합니다.\n        \"\"\"</span>\n        <span class=\"token comment\"># 형태소 분석</span>\n        parsed <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>mecab<span class=\"token punctuation\">.</span>parse<span class=\"token punctuation\">(</span>hiragana_text<span class=\"token punctuation\">)</span>\n\n        result <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n        <span class=\"token keyword\">for</span> line <span class=\"token keyword\">in</span> parsed<span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">'\\n'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">if</span> line <span class=\"token operator\">==</span> <span class=\"token string\">'EOS'</span> <span class=\"token keyword\">or</span> line <span class=\"token operator\">==</span> <span class=\"token string\">''</span><span class=\"token punctuation\">:</span>\n                <span class=\"token keyword\">continue</span>\n\n            parts <span class=\"token operator\">=</span> line<span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">'\\t'</span><span class=\"token punctuation\">)</span>\n            surface <span class=\"token operator\">=</span> parts<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>  <span class=\"token comment\"># 표층형</span>\n            reading <span class=\"token operator\">=</span> parts<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">if</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>parts<span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">1</span> <span class=\"token keyword\">else</span> surface  <span class=\"token comment\"># 읽기</span>\n\n            <span class=\"token comment\"># 외래어는 가타카나로</span>\n            <span class=\"token keyword\">if</span> self<span class=\"token punctuation\">.</span>is_gairaigo<span class=\"token punctuation\">(</span>surface<span class=\"token punctuation\">,</span> reading<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n                result<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>to_katakana<span class=\"token punctuation\">(</span>surface<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token comment\"># 일반 단어는 한자 변환 시도</span>\n            <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n                converted <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>try_kanji_conversion<span class=\"token punctuation\">(</span>surface<span class=\"token punctuation\">,</span> reading<span class=\"token punctuation\">)</span>\n                result<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>converted<span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token string\">''</span><span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">is_gairaigo</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> surface<span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">,</span> reading<span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">bool</span><span class=\"token punctuation\">:</span>\n        <span class=\"token triple-quoted-string string\">\"\"\"외래어 여부 판정\"\"\"</span>\n        <span class=\"token comment\"># 사전 기반 + 규칙 기반 판정</span>\n        <span class=\"token keyword\">if</span> reading <span class=\"token keyword\">in</span> self<span class=\"token punctuation\">.</span>gairaigo_dict<span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">return</span> <span class=\"token boolean\">True</span>\n        <span class=\"token comment\"># 장음이 포함된 경우 외래어 가능성 높음</span>\n        <span class=\"token keyword\">if</span> <span class=\"token string\">'ー'</span> <span class=\"token keyword\">in</span> surface <span class=\"token keyword\">or</span> self<span class=\"token punctuation\">.</span>has_long_vowel_pattern<span class=\"token punctuation\">(</span>reading<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">return</span> <span class=\"token boolean\">True</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">False</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">to_katakana</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> hiragana<span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">:</span>\n        <span class=\"token triple-quoted-string string\">\"\"\"히라가나를 가타카나로 변환\"\"\"</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string\">''</span><span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span>\n            <span class=\"token builtin\">chr</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">ord</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">96</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">if</span> <span class=\"token string\">'ぁ'</span> <span class=\"token operator\">&lt;=</span> c <span class=\"token operator\">&lt;=</span> <span class=\"token string\">'ん'</span> <span class=\"token keyword\">else</span> c\n            <span class=\"token keyword\">for</span> c <span class=\"token keyword\">in</span> hiragana\n        <span class=\"token punctuation\">)</span>\n\n\n<span class=\"token comment\"># 적용 결과</span>\nJAPANESE_IMPROVEMENT <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"strategy\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"히라가나 통일 + 후처리 변환\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"before_CER\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"5.1%\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"after_CER\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"3.8%\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"readability\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"후처리 덕분에 자연스러운 표기\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"3-gpu-메모리-터짐\">3. GPU 메모리 터짐</h3>\n<p>FastConformer가 생각보다 메모리를 많이 사용했습니다. Attention 연산이 시퀀스 길이의 제곱에 비례하기 때문에, 긴 오디오가 들어오면 OOM(Out of Memory)이 발생했습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># 메모리 사용량 분석</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">estimate_memory</span><span class=\"token punctuation\">(</span>seq_len<span class=\"token punctuation\">:</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">,</span> d_model<span class=\"token punctuation\">:</span> <span class=\"token builtin\">int</span> <span class=\"token operator\">=</span> <span class=\"token number\">512</span><span class=\"token punctuation\">,</span> batch_size<span class=\"token punctuation\">:</span> <span class=\"token builtin\">int</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    Attention 메모리 사용량 추정\n\n    Q, K, V 각각: batch_size * seq_len * d_model\n    Attention matrix: batch_size * num_heads * seq_len * seq_len\n    \"\"\"</span>\n    qkv_memory <span class=\"token operator\">=</span> <span class=\"token number\">3</span> <span class=\"token operator\">*</span> batch_size <span class=\"token operator\">*</span> seq_len <span class=\"token operator\">*</span> d_model <span class=\"token operator\">*</span> <span class=\"token number\">4</span>  <span class=\"token comment\"># float32</span>\n    attn_memory <span class=\"token operator\">=</span> batch_size <span class=\"token operator\">*</span> <span class=\"token number\">8</span> <span class=\"token operator\">*</span> seq_len <span class=\"token operator\">*</span> seq_len <span class=\"token operator\">*</span> <span class=\"token number\">4</span>  <span class=\"token comment\"># 8 heads</span>\n\n    total_mb <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>qkv_memory <span class=\"token operator\">+</span> attn_memory<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1024</span> <span class=\"token operator\">*</span> <span class=\"token number\">1024</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> total_mb\n\n<span class=\"token comment\"># 시퀀스 길이별 메모리</span>\nMEMORY_BY_LENGTH <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"10sec (1000 frames)\"</span><span class=\"token punctuation\">:</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>estimate_memory<span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span><span class=\"token format-spec\">.1f</span><span class=\"token punctuation\">}</span></span><span class=\"token string\"> MB\"</span></span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"30sec (3000 frames)\"</span><span class=\"token punctuation\">:</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>estimate_memory<span class=\"token punctuation\">(</span><span class=\"token number\">3000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span><span class=\"token format-spec\">.1f</span><span class=\"token punctuation\">}</span></span><span class=\"token string\"> MB\"</span></span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"60sec (6000 frames)\"</span><span class=\"token punctuation\">:</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>estimate_memory<span class=\"token punctuation\">(</span><span class=\"token number\">6000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span><span class=\"token format-spec\">.1f</span><span class=\"token punctuation\">}</span></span><span class=\"token string\"> MB\"</span></span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"300sec (30000 frames)\"</span><span class=\"token punctuation\">:</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>estimate_memory<span class=\"token punctuation\">(</span><span class=\"token number\">30000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span><span class=\"token format-spec\">.1f</span><span class=\"token punctuation\">}</span></span><span class=\"token string\"> MB\"</span></span>  <span class=\"token comment\"># OOM!</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>여러 가지 최적화 기법을 적용했습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> torch\n<span class=\"token keyword\">from</span> torch<span class=\"token punctuation\">.</span>cuda<span class=\"token punctuation\">.</span>amp <span class=\"token keyword\">import</span> autocast<span class=\"token punctuation\">,</span> GradScaler\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">OptimizedFastConformer</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    메모리 최적화된 FastConformer 래퍼\n    \"\"\"</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> model<span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        self<span class=\"token punctuation\">.</span>model <span class=\"token operator\">=</span> model\n        self<span class=\"token punctuation\">.</span>config <span class=\"token operator\">=</span> config\n\n        <span class=\"token comment\"># Mixed Precision 설정</span>\n        self<span class=\"token punctuation\">.</span>use_fp16 <span class=\"token operator\">=</span> config<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"use_fp16\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token comment\"># Gradient Checkpointing 활성화 (학습 시)</span>\n        <span class=\"token keyword\">if</span> config<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"gradient_checkpointing\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            self<span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span>encoder<span class=\"token punctuation\">.</span>gradient_checkpointing_enable<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">transcribe</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> audio<span class=\"token punctuation\">:</span> torch<span class=\"token punctuation\">.</span>Tensor<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">:</span>\n        <span class=\"token triple-quoted-string string\">\"\"\"\n        최적화된 추론\n        \"\"\"</span>\n        <span class=\"token keyword\">with</span> torch<span class=\"token punctuation\">.</span>no_grad<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            <span class=\"token comment\"># FP16으로 메모리 절반 절약</span>\n            <span class=\"token keyword\">with</span> autocast<span class=\"token punctuation\">(</span>enabled<span class=\"token operator\">=</span>self<span class=\"token punctuation\">.</span>use_fp16<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n                <span class=\"token comment\"># 청크 단위로 처리하여 피크 메모리 감소</span>\n                chunks <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>split_audio<span class=\"token punctuation\">(</span>audio<span class=\"token punctuation\">,</span> chunk_size<span class=\"token operator\">=</span><span class=\"token number\">16000</span> <span class=\"token operator\">*</span> <span class=\"token number\">30</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># 30초</span>\n\n                results <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n                <span class=\"token keyword\">for</span> chunk <span class=\"token keyword\">in</span> chunks<span class=\"token punctuation\">:</span>\n                    result <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span>transcribe<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>chunk<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n                    results<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n                    <span class=\"token comment\"># 중간 결과 메모리 해제</span>\n                    torch<span class=\"token punctuation\">.</span>cuda<span class=\"token punctuation\">.</span>empty_cache<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token string\">' '</span><span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span>results<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">split_audio</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> audio<span class=\"token punctuation\">:</span> torch<span class=\"token punctuation\">.</span>Tensor<span class=\"token punctuation\">,</span> chunk_size<span class=\"token punctuation\">:</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">list</span><span class=\"token punctuation\">:</span>\n        <span class=\"token triple-quoted-string string\">\"\"\"\n        긴 오디오를 청크로 분할\n        오버랩을 두어 경계에서의 품질 저하 방지\n        \"\"\"</span>\n        overlap <span class=\"token operator\">=</span> chunk_size <span class=\"token operator\">//</span> <span class=\"token number\">10</span>  <span class=\"token comment\"># 10% 오버랩</span>\n        chunks <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\n        start <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n        <span class=\"token keyword\">while</span> start <span class=\"token operator\">&lt;</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>audio<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            end <span class=\"token operator\">=</span> <span class=\"token builtin\">min</span><span class=\"token punctuation\">(</span>start <span class=\"token operator\">+</span> chunk_size<span class=\"token punctuation\">,</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>audio<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            chunks<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>audio<span class=\"token punctuation\">[</span>start<span class=\"token punctuation\">:</span>end<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n            start <span class=\"token operator\">=</span> end <span class=\"token operator\">-</span> overlap\n\n        <span class=\"token keyword\">return</span> chunks\n\n\n<span class=\"token comment\"># 최적화 전후 비교</span>\nOPTIMIZATION_RESULTS <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"baseline\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">\"max_audio_length\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"60초\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"memory_usage\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"12GB\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"batch_size\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"optimized\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">\"max_audio_length\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"무제한 (청크 처리)\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"memory_usage\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"4GB\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"batch_size\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># 같은 메모리로 4배 처리량</span>\n        <span class=\"token string\">\"techniques\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n            <span class=\"token string\">\"FP16 (메모리 50% 감소)\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"Gradient Checkpointing (학습 시 40% 감소)\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"청크 단위 처리 (피크 메모리 제어)\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"중간 결과 캐시 해제\"</span>\n        <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"학습-파이프라인\">학습 파이프라인</h2>\n<p>사전학습된 모델을 한국어/일본어에 파인튜닝했습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> nemo<span class=\"token punctuation\">.</span>collections<span class=\"token punctuation\">.</span>asr<span class=\"token punctuation\">.</span>models <span class=\"token keyword\">import</span> EncDecCTCModelBPE\n<span class=\"token keyword\">from</span> nemo<span class=\"token punctuation\">.</span>utils<span class=\"token punctuation\">.</span>exp_manager <span class=\"token keyword\">import</span> exp_manager\n<span class=\"token keyword\">from</span> omegaconf <span class=\"token keyword\">import</span> OmegaConf\n<span class=\"token keyword\">import</span> pytorch_lightning <span class=\"token keyword\">as</span> pl\n\n<span class=\"token comment\"># 파인튜닝 설정</span>\nconfig <span class=\"token operator\">=</span> OmegaConf<span class=\"token punctuation\">.</span>create<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"model\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">\"train_ds\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token string\">\"manifest_filepath\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"train_manifest.json\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"batch_size\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">16</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"num_workers\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"pin_memory\"</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"shuffle\"</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"validation_ds\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token string\">\"manifest_filepath\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"val_manifest.json\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"batch_size\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">16</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"num_workers\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"optim\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token string\">\"name\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"adamw\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"lr\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1e-4</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"weight_decay\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1e-3</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"sched\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token string\">\"name\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"CosineAnnealing\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">\"warmup_steps\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">\"min_lr\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1e-6</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"trainer\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">\"devices\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># 4 GPU</span>\n        <span class=\"token string\">\"accelerator\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"gpu\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"strategy\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"ddp\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"max_epochs\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">50</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"accumulate_grad_batches\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"precision\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">16</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># FP16 학습</span>\n        <span class=\"token string\">\"gradient_clip_val\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 모델 로드 및 파인튜닝</span>\nmodel <span class=\"token operator\">=</span> EncDecCTCModelBPE<span class=\"token punctuation\">.</span>from_pretrained<span class=\"token punctuation\">(</span><span class=\"token string\">\"nvidia/parakeet-ctc-1.1b\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 토크나이저 교체 (한국어/일본어용)</span>\nmodel<span class=\"token punctuation\">.</span>change_vocabulary<span class=\"token punctuation\">(</span>\n    new_tokenizer_dir<span class=\"token operator\">=</span><span class=\"token string\">\"./korean_japanese_tokenizer\"</span><span class=\"token punctuation\">,</span>\n    new_tokenizer_type<span class=\"token operator\">=</span><span class=\"token string\">\"bpe\"</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 학습</span>\ntrainer <span class=\"token operator\">=</span> pl<span class=\"token punctuation\">.</span>Trainer<span class=\"token punctuation\">(</span><span class=\"token operator\">**</span>config<span class=\"token punctuation\">.</span>trainer<span class=\"token punctuation\">)</span>\ntrainer<span class=\"token punctuation\">.</span>fit<span class=\"token punctuation\">(</span>model<span class=\"token punctuation\">)</span></code></pre></div>\n<p>데이터 준비가 가장 중요했습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> json\n<span class=\"token keyword\">from</span> pathlib <span class=\"token keyword\">import</span> Path\n<span class=\"token keyword\">from</span> dataclasses <span class=\"token keyword\">import</span> dataclass\n<span class=\"token keyword\">from</span> typing <span class=\"token keyword\">import</span> Optional\n\n<span class=\"token decorator annotation punctuation\">@dataclass</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">AudioSample</span><span class=\"token punctuation\">:</span>\n    audio_filepath<span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span>\n    text<span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span>\n    duration<span class=\"token punctuation\">:</span> <span class=\"token builtin\">float</span>\n    language<span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span>  <span class=\"token comment\"># \"ko\" or \"ja\"</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">create_manifest</span><span class=\"token punctuation\">(</span>samples<span class=\"token punctuation\">:</span> <span class=\"token builtin\">list</span><span class=\"token punctuation\">[</span>AudioSample<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> output_path<span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    NeMo 형식의 manifest 파일 생성\n\n    포맷:\n    {\"audio_filepath\": \"path/to/audio.wav\", \"text\": \"transcription\", \"duration\": 3.5}\n    \"\"\"</span>\n    <span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span>output_path<span class=\"token punctuation\">,</span> <span class=\"token string\">'w'</span><span class=\"token punctuation\">,</span> encoding<span class=\"token operator\">=</span><span class=\"token string\">'utf-8'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> f<span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">for</span> sample <span class=\"token keyword\">in</span> samples<span class=\"token punctuation\">:</span>\n            entry <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token string\">\"audio_filepath\"</span><span class=\"token punctuation\">:</span> sample<span class=\"token punctuation\">.</span>audio_filepath<span class=\"token punctuation\">,</span>\n                <span class=\"token string\">\"text\"</span><span class=\"token punctuation\">:</span> sample<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">,</span>\n                <span class=\"token string\">\"duration\"</span><span class=\"token punctuation\">:</span> sample<span class=\"token punctuation\">.</span>duration\n            <span class=\"token punctuation\">}</span>\n            f<span class=\"token punctuation\">.</span>write<span class=\"token punctuation\">(</span>json<span class=\"token punctuation\">.</span>dumps<span class=\"token punctuation\">(</span>entry<span class=\"token punctuation\">,</span> ensure_ascii<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">'\\n'</span><span class=\"token punctuation\">)</span>\n\n\n<span class=\"token comment\"># 데이터 품질 체크</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">validate_dataset</span><span class=\"token punctuation\">(</span>manifest_path<span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">dict</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    데이터셋 품질 검증\n    \"\"\"</span>\n    issues <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">\"missing_audio\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"too_short\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"too_long\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"empty_text\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"duration_mismatch\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span>manifest_path<span class=\"token punctuation\">,</span> <span class=\"token string\">'r'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> f<span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">for</span> line <span class=\"token keyword\">in</span> f<span class=\"token punctuation\">:</span>\n            entry <span class=\"token operator\">=</span> json<span class=\"token punctuation\">.</span>loads<span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">)</span>\n\n            <span class=\"token comment\"># 파일 존재 확인</span>\n            <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> Path<span class=\"token punctuation\">(</span>entry<span class=\"token punctuation\">[</span><span class=\"token string\">\"audio_filepath\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>exists<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n                issues<span class=\"token punctuation\">[</span><span class=\"token string\">\"missing_audio\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>entry<span class=\"token punctuation\">[</span><span class=\"token string\">\"audio_filepath\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n                <span class=\"token keyword\">continue</span>\n\n            <span class=\"token comment\"># 너무 짧은 오디오 (1초 미만)</span>\n            <span class=\"token keyword\">if</span> entry<span class=\"token punctuation\">[</span><span class=\"token string\">\"duration\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">:</span>\n                issues<span class=\"token punctuation\">[</span><span class=\"token string\">\"too_short\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>entry<span class=\"token punctuation\">[</span><span class=\"token string\">\"audio_filepath\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n            <span class=\"token comment\"># 너무 긴 오디오 (30초 초과) - 청크로 나눠야 함</span>\n            <span class=\"token keyword\">if</span> entry<span class=\"token punctuation\">[</span><span class=\"token string\">\"duration\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">></span> <span class=\"token number\">30.0</span><span class=\"token punctuation\">:</span>\n                issues<span class=\"token punctuation\">[</span><span class=\"token string\">\"too_long\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>entry<span class=\"token punctuation\">[</span><span class=\"token string\">\"audio_filepath\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n            <span class=\"token comment\"># 빈 텍스트</span>\n            <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> entry<span class=\"token punctuation\">[</span><span class=\"token string\">\"text\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>strip<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n                issues<span class=\"token punctuation\">[</span><span class=\"token string\">\"empty_text\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>entry<span class=\"token punctuation\">[</span><span class=\"token string\">\"audio_filepath\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">return</span> issues\n\n\n<span class=\"token comment\"># 데이터 통계</span>\nDATASET_STATS <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"korean\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">\"total_hours\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5000</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"sources\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"방송 자막\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"유튜브\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"팟캐스트\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"콜센터\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"speakers\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"다수 (10000+)\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"japanese\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">\"total_hours\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"sources\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"NHK\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"유튜브\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"오디오북\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"speakers\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"다수 (5000+)\"</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"결과\">결과</h2>\n<p>최종 성능입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># 평가 결과</span>\nFINAL_RESULTS <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"korean\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">\"CER\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"3.1%\"</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># 기존 4.5% → 3.1%</span>\n        <span class=\"token string\">\"improvement\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"31% 개선\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"test_set\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"내부 테스트셋 50시간\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"japanese\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">\"CER\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"3.8%\"</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># 기존 5.1% → 3.8%</span>\n        <span class=\"token string\">\"improvement\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"25% 개선\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"test_set\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"내부 테스트셋 30시간\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"rtf\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">\"value\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0.18</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"meaning\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"1초 오디오를 0.18초에 처리\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"implication\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"실시간보다 5.5배 빠름\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"latency\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">\"p50\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"85ms\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"p90\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"120ms\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"p99\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"180ms\"</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\"># RTF의 의미</span>\n<span class=\"token triple-quoted-string string\">\"\"\"\nRTF(Real-Time Factor) = 처리 시간 / 오디오 시간\n\nRTF &lt; 1.0 → 실시간 처리 가능\nRTF = 0.18 → 1시간 오디오를 11분에 처리\n\n서비스 관점:\n- 동시 처리 가능한 스트림 수 = 1 / RTF\n- RTF 0.18이면 이론상 GPU 1개로 5.5개 스트림 동시 처리\n\"\"\"</span></code></pre></div>\n<h2 id=\"서빙-최적화\">서빙 최적화</h2>\n<p>실제 서비스에 배포하기 위해 추가 최적화를 진행했습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> triton_python_backend_utils <span class=\"token keyword\">as</span> pb_utils\n<span class=\"token keyword\">import</span> numpy <span class=\"token keyword\">as</span> np\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">TritonFastConformerModel</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    NVIDIA Triton Inference Server용 모델 래퍼\n\n    장점:\n    - 동적 배칭: 여러 요청을 자동으로 묶어서 처리\n    - 모델 앙상블: 전처리 → 추론 → 후처리 파이프라인\n    - 멀티 인스턴스: GPU당 여러 모델 인스턴스 실행\n    \"\"\"</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        self<span class=\"token punctuation\">.</span>model <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>load_optimized_model<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">load_optimized_model</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token triple-quoted-string string\">\"\"\"\n        TensorRT 최적화된 모델 로드\n        \"\"\"</span>\n        <span class=\"token keyword\">import</span> tensorrt <span class=\"token keyword\">as</span> trt\n\n        <span class=\"token comment\"># ONNX → TensorRT 변환 시 최적화</span>\n        <span class=\"token comment\"># - FP16 연산</span>\n        <span class=\"token comment\"># - Layer fusion</span>\n        <span class=\"token comment\"># - Kernel auto-tuning</span>\n\n        <span class=\"token keyword\">return</span> trt_model\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">execute</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> requests<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token triple-quoted-string string\">\"\"\"\n        Triton에서 호출하는 추론 함수\n        \"\"\"</span>\n        responses <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\n        <span class=\"token keyword\">for</span> request <span class=\"token keyword\">in</span> requests<span class=\"token punctuation\">:</span>\n            audio <span class=\"token operator\">=</span> pb_utils<span class=\"token punctuation\">.</span>get_input_tensor_by_name<span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> <span class=\"token string\">\"audio\"</span><span class=\"token punctuation\">)</span>\n            audio_np <span class=\"token operator\">=</span> audio<span class=\"token punctuation\">.</span>as_numpy<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n            <span class=\"token comment\"># 추론</span>\n            <span class=\"token keyword\">with</span> torch<span class=\"token punctuation\">.</span>no_grad<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n                text <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span>transcribe<span class=\"token punctuation\">(</span>audio_np<span class=\"token punctuation\">)</span>\n\n            <span class=\"token comment\"># 응답 생성</span>\n            output <span class=\"token operator\">=</span> pb_utils<span class=\"token punctuation\">.</span>Tensor<span class=\"token punctuation\">(</span><span class=\"token string\">\"text\"</span><span class=\"token punctuation\">,</span> np<span class=\"token punctuation\">.</span>array<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>text<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            response <span class=\"token operator\">=</span> pb_utils<span class=\"token punctuation\">.</span>InferenceResponse<span class=\"token punctuation\">(</span>output_tensors<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span>output<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n            responses<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">return</span> responses\n\n\n<span class=\"token comment\"># Triton 설정</span>\nTRITON_CONFIG <span class=\"token operator\">=</span> <span class=\"token triple-quoted-string string\">\"\"\"\nname: \"fastconformer_korean\"\nplatform: \"python\"\nmax_batch_size: 8\n\ninput [\n  {\n    name: \"audio\"\n    data_type: TYPE_FP32\n    dims: [-1]  # 가변 길이\n  }\n]\n\noutput [\n  {\n    name: \"text\"\n    data_type: TYPE_STRING\n    dims: [1]\n  }\n]\n\ninstance_group [\n  {\n    count: 2\n    kind: KIND_GPU\n  }\n]\n\ndynamic_batching {\n  preferred_batch_size: [4, 8]\n  max_queue_delay_microseconds: 100000\n}\n\"\"\"</span></code></pre></div>\n<h2 id=\"배운-점\">배운 점</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">LESSONS_LEARNED <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"preprocessing\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">\"lesson\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"전처리가 절반이다\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"detail\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"모델 아키텍처보다 데이터 전처리가 성능에 더 큰 영향\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"example\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"자모 분리 로직 개선만으로 CER 1.4%p 개선\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"language_specific\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">\"lesson\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"언어마다 다르다\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"detail\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"영어 논문 그대로 따라하면 안 된다\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"example\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"한국어는 자모, 일본어는 표기 통일이 핵심\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"realtime_challenge\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">\"lesson\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"실시간이 어렵다\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"detail\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"배치 처리는 쉬운데 스트리밍은 완전 다른 문제\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"example\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"캐시 관리, 청크 경계 처리, 지연시간 최적화 필요\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"memory_management\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">\"lesson\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"메모리는 항상 부족하다\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"detail\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"실서비스에서는 동시 요청 처리가 중요\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"example\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"FP16 + 청크 처리로 4배 처리량 확보\"</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>다음에는 화자 분리(Speaker Diarization)도 붙여볼 생각입니다. 회의록 자동 생성 같은 기능을 만들려면 \"누가 말했는지\"를 알아야 하니까요.</p>\n<h2 id=\"참고-자료\">참고 자료</h2>\n<ul>\n<li><a href=\"https://arxiv.org/abs/2305.05084\">FastConformer Paper</a> - NVIDIA</li>\n<li><a href=\"https://github.com/NVIDIA/NeMo\">NeMo Toolkit</a> - NVIDIA ASR 프레임워크</li>\n<li><a href=\"https://huggingface.co/nvidia/parakeet-ctc-1.1b\">Parakeet Models</a> - 사전학습 모델</li>\n<li><a href=\"https://github.com/triton-inference-server/server\">Triton Inference Server</a> - 서빙 프레임워크</li>\n<li><a href=\"https://www.koreascience.or.kr/\">한국어 음성인식 연구 동향</a> - 국내 연구</li>\n</ul>","excerpt":"FastConformer로 STT 엔진 만들면서 배운 것들 Return Zero에서 STT 엔진 개발을 맡게 되었습니다. 한국어와 일본어를 동시에 지원해야 했는데, 기존 모델로는 만족스러운 성능이 나오지 않아서 FastConformer를 도입하게 되었습니다. 그 과정에서 겪은 문제들과 해결 방법을 공유합니다. 왜 FastConformer였나 처음에는 Wh…","frontmatter":{"date":"24.10.01","dateISO":"2024-10-01","description":"한국어/일본어 음성인식 모델 개발 과정에서 겪은 문제와 해결 방법","slug":"/fastconformer-stt-development","heroImage":null,"heroImageAlt":null,"tags":["ai","dev"],"title":"FastConformer로 STT 엔진 만들면서 배운 것들"},"tableOfContents":"<ul>\n<li>\n<p><a href=\"#fastconformer%EB%A1%9C-stt-%EC%97%94%EC%A7%84-%EB%A7%8C%EB%93%A4%EB%A9%B4%EC%84%9C-%EB%B0%B0%EC%9A%B4-%EA%B2%83%EB%93%A4\">FastConformer로 STT 엔진 만들면서 배운 것들</a></p>\n<ul>\n<li>\n<p><a href=\"#%EC%99%9C-fastconformer%EC%98%80%EB%82%98\">왜 FastConformer였나</a></p>\n</li>\n<li>\n<p><a href=\"#nemo-%ED%94%84%EB%A0%88%EC%9E%84%EC%9B%8C%ED%81%AC-%ED%99%9C%EC%9A%A9\">NeMo 프레임워크 활용</a></p>\n</li>\n<li>\n<p><a href=\"#%EC%82%BD%EC%A7%88-%EA%B8%B0%EB%A1%9D\">삽질 기록</a></p>\n<ul>\n<li><a href=\"#1-%ED%95%9C%EA%B5%AD%EC%96%B4-%EC%9E%90%EB%AA%A8-%EB%B6%84%EB%A6%AC-%EB%AC%B8%EC%A0%9C\">1. 한국어 자모 분리 문제</a></li>\n<li><a href=\"#2-%EC%9D%BC%EB%B3%B8%EC%96%B4-%ED%91%9C%EA%B8%B0-%ED%86%B5%EC%9D%BC-%EB%AC%B8%EC%A0%9C\">2. 일본어 표기 통일 문제</a></li>\n<li><a href=\"#3-gpu-%EB%A9%94%EB%AA%A8%EB%A6%AC-%ED%84%B0%EC%A7%90\">3. GPU 메모리 터짐</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%ED%95%99%EC%8A%B5-%ED%8C%8C%EC%9D%B4%ED%94%84%EB%9D%BC%EC%9D%B8\">학습 파이프라인</a></p>\n</li>\n<li>\n<p><a href=\"#%EA%B2%B0%EA%B3%BC\">결과</a></p>\n</li>\n<li>\n<p><a href=\"#%EC%84%9C%EB%B9%99-%EC%B5%9C%EC%A0%81%ED%99%94\">서빙 최적화</a></p>\n</li>\n<li>\n<p><a href=\"#%EB%B0%B0%EC%9A%B4-%EC%A0%90\">배운 점</a></p>\n</li>\n<li>\n<p><a href=\"#%EC%B0%B8%EA%B3%A0-%EC%9E%90%EB%A3%8C\">참고 자료</a></p>\n</li>\n</ul>\n</li>\n</ul>"}},"pageContext":{"id":"e4d22f34-38d2-5d77-996f-30e2d03e840b","frontmatter__slug":"/fastconformer-stt-development","previous":"/llm-stt-evaluation","previousTitle":"LLM으로 STT 품질 평가하기","next":"/speech-to-text-trends-2024","nextTitle":"2024년 STT 기술 동향"}},"staticQueryHashes":["12962592","3399079524","3470099541","4097432363","76375841"],"slicesMap":{}}