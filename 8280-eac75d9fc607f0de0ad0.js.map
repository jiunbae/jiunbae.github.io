{"version":3,"file":"8280-eac75d9fc607f0de0ad0.js","mappings":"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","sources":["webpack://jiunbae.github.io/./src/views/CellularAutomata/engine.ts"],"sourcesContent":["export type RulePreset = 'life' | 'highlife' | 'seeds'\n\ninterface RuleMask {\n  survive: boolean[]\n  birth: boolean[]\n}\n\ntype GenerationListener = (generation: number) => void\n\nconst RULE_CONFIG: Record<RulePreset, { survive: number[]; birth: number[] }> = {\n  life: { survive: [2, 3], birth: [3] },\n  highlife: { survive: [2, 3], birth: [3, 6] },\n  seeds: { survive: [], birth: [2] }\n}\n\nfunction clamp(value: number, min: number, max: number): number {\n  return Math.max(min, Math.min(max, value))\n}\n\nfunction toRuleMask(rule: RulePreset): RuleMask {\n  const survive = Array.from({ length: 9 }, () => false)\n  const birth = Array.from({ length: 9 }, () => false)\n  for (const n of RULE_CONFIG[rule].survive) survive[n] = true\n  for (const n of RULE_CONFIG[rule].birth) birth[n] = true\n  return { survive, birth }\n}\n\nexport class CellularAutomataEngine {\n  private canvas: HTMLCanvasElement\n  private ctx: CanvasRenderingContext2D\n\n  private grid = new Uint8Array(0)\n  private next = new Uint8Array(0)\n  private age = new Uint16Array(0)\n  private cols = 0\n  private rows = 0\n\n  private w = 1\n  private h = 1\n  private dpr = 1\n\n  private cellSize = 8\n  private wrapEdges = true\n  private running = true\n  private generation = 0\n  private tickInterval = 1000 / 14\n  private accumulator = 0\n\n  private rule: RulePreset = 'life'\n  private ruleMask: RuleMask = toRuleMask('life')\n  private animationId = 0\n  private lastTs = 0\n  private disposed = false\n\n  private pointerDown = false\n  private pointerId: number | null = null\n  private paintValue: 0 | 1 = 1\n\n  private resizeObserver: ResizeObserver | null = null\n  private dirty = true\n  private generationListener: GenerationListener | null = null\n\n  constructor(private container: HTMLDivElement) {\n    this.canvas = document.createElement('canvas')\n    this.canvas.style.width = '100%'\n    this.canvas.style.height = '100%'\n    this.canvas.style.display = 'block'\n    this.canvas.style.touchAction = 'none'\n    container.appendChild(this.canvas)\n\n    const ctx = this.canvas.getContext('2d')\n    if (!ctx) {\n      throw new Error('Canvas 2D context is not available')\n    }\n    this.ctx = ctx\n\n    this.resizeCanvas(true)\n    this.randomize(0.22)\n    this.initListeners()\n    this.requestFrame()\n  }\n\n  setRule(rule: RulePreset) {\n    if (this.rule === rule) return\n    this.rule = rule\n    this.ruleMask = toRuleMask(rule)\n  }\n\n  setCellSize(size: number) {\n    const nextSize = Math.round(clamp(size, 4, 22))\n    if (nextSize === this.cellSize) return\n    this.cellSize = nextSize\n    this.resizeCanvas(false)\n  }\n\n  setSpeed(fps: number) {\n    const next = 1000 / clamp(fps, 1, 60)\n    if (this.tickInterval === next) return\n    this.tickInterval = next\n  }\n\n  setRunning(running: boolean) {\n    if (this.running === running) return\n    this.running = running\n    this.lastTs = 0\n    if (running) this.requestFrame()\n  }\n\n  setWrapEdges(enabled: boolean) {\n    if (this.wrapEdges === enabled) return\n    this.wrapEdges = enabled\n  }\n\n  randomize(density: number) {\n    const p = clamp(density, 0, 1)\n    for (let i = 0; i < this.grid.length; i++) {\n      const alive = Math.random() < p ? 1 : 0\n      this.grid[i] = alive\n      this.next[i] = 0\n      this.age[i] = alive === 1 ? 1 : 0\n    }\n    this.generation = 0\n    this.notifyGeneration()\n    this.markDirty()\n  }\n\n  clear() {\n    this.grid.fill(0)\n    this.next.fill(0)\n    this.age.fill(0)\n    this.generation = 0\n    this.notifyGeneration()\n    this.markDirty()\n  }\n\n  step() {\n    this.stepSimulation()\n    this.notifyGeneration()\n    this.markDirty()\n  }\n\n  getGeneration(): number {\n    return this.generation\n  }\n\n  setGenerationListener(listener: GenerationListener | null) {\n    this.generationListener = listener\n    this.notifyGeneration()\n  }\n\n  dispose() {\n    this.disposed = true\n    this.generationListener = null\n    if (this.animationId !== 0) {\n      cancelAnimationFrame(this.animationId)\n      this.animationId = 0\n    }\n\n    this.resizeObserver?.disconnect()\n    this.resizeObserver = null\n\n    this.canvas.removeEventListener('pointerdown', this.onPointerDown)\n    window.removeEventListener('pointermove', this.onPointerMove)\n    window.removeEventListener('pointerup', this.onPointerUp)\n    window.removeEventListener('pointercancel', this.onPointerUp)\n    this.canvas.removeEventListener('contextmenu', this.onContextMenu)\n\n    if (this.canvas.parentElement) {\n      this.canvas.parentElement.removeChild(this.canvas)\n    }\n  }\n\n  private animate = (ts: number) => {\n    if (this.disposed) return\n    this.animationId = 0\n\n    let generationChanged = false\n    if (this.running) {\n      if (this.lastTs === 0) this.lastTs = ts\n      const dt = Math.min(100, ts - this.lastTs)\n      this.lastTs = ts\n\n      this.accumulator += dt\n      let stepped = false\n      while (this.accumulator >= this.tickInterval) {\n        this.stepSimulation()\n        this.accumulator -= this.tickInterval\n        stepped = true\n      }\n      if (stepped) {\n        generationChanged = true\n        this.dirty = true\n      }\n    } else {\n      this.lastTs = 0\n      this.accumulator = 0\n    }\n\n    if (generationChanged) this.notifyGeneration()\n\n    if (this.dirty) {\n      this.draw()\n      this.dirty = false\n    }\n\n    if (this.running || this.dirty) this.requestFrame()\n  }\n\n  private stepSimulation() {\n    if (this.cols === 0 || this.rows === 0) return\n\n    const source = this.grid\n    const target = this.next\n\n    for (let row = 0; row < this.rows; row++) {\n      for (let col = 0; col < this.cols; col++) {\n        const idx = row * this.cols + col\n        const neighbors = this.countNeighbors(source, col, row)\n        const isAlive = source[idx] === 1\n        target[idx] = (isAlive ? this.ruleMask.survive[neighbors] : this.ruleMask.birth[neighbors]) ? 1 : 0\n      }\n    }\n\n    this.grid = target\n    this.next = source\n\n    for (let i = 0; i < this.grid.length; i++) {\n      if (this.grid[i] === 1) {\n        const prevAge = this.age[i]\n        this.age[i] = prevAge < 65535 ? prevAge + 1 : prevAge\n      } else {\n        this.age[i] = 0\n      }\n    }\n\n    this.generation++\n  }\n\n  private countNeighbors(source: Uint8Array, col: number, row: number): number {\n    let count = 0\n\n    for (let oy = -1; oy <= 1; oy++) {\n      for (let ox = -1; ox <= 1; ox++) {\n        if (ox === 0 && oy === 0) continue\n\n        let nx = col + ox\n        let ny = row + oy\n\n        if (this.wrapEdges) {\n          nx = (nx + this.cols) % this.cols\n          ny = (ny + this.rows) % this.rows\n        } else if (nx < 0 || nx >= this.cols || ny < 0 || ny >= this.rows) {\n          continue\n        }\n\n        if (source[ny * this.cols + nx] === 1) {\n          count++\n        }\n      }\n    }\n\n    return count\n  }\n\n  private draw() {\n    this.ctx.clearRect(0, 0, this.w, this.h)\n    this.ctx.fillStyle = '#040812'\n    this.ctx.fillRect(0, 0, this.w, this.h)\n\n    const step = this.cellSize\n    const cellDrawSize = Math.max(1, step - 1)\n\n    for (let row = 0; row < this.rows; row++) {\n      for (let col = 0; col < this.cols; col++) {\n        const idx = row * this.cols + col\n        if (this.grid[idx] === 0) continue\n\n        const age = this.age[idx]\n        const hue = (185 + age * 2.1 + col * 0.45 + row * 0.35) % 360\n        const light = Math.min(74, 40 + age * 1.1)\n        this.ctx.fillStyle = `hsl(${hue} 86% ${light}%)`\n        this.ctx.fillRect(col * step + 0.5, row * step + 0.5, cellDrawSize, cellDrawSize)\n      }\n    }\n\n    if (this.cellSize >= 12) {\n      this.ctx.strokeStyle = 'rgba(124, 162, 255, 0.08)'\n      this.ctx.lineWidth = 1\n      this.ctx.beginPath()\n\n      for (let x = 0; x <= this.cols; x++) {\n        const px = x * this.cellSize + 0.5\n        this.ctx.moveTo(px, 0)\n        this.ctx.lineTo(px, this.h)\n      }\n      for (let y = 0; y <= this.rows; y++) {\n        const py = y * this.cellSize + 0.5\n        this.ctx.moveTo(0, py)\n        this.ctx.lineTo(this.w, py)\n      }\n      this.ctx.stroke()\n    }\n  }\n\n  private resizeCanvas(initial: boolean) {\n    const rect = this.container.getBoundingClientRect()\n    this.w = Math.max(1, Math.floor(rect.width))\n    this.h = Math.max(1, Math.floor(rect.height))\n    this.dpr = Math.min(window.devicePixelRatio || 1, 2)\n\n    this.canvas.width = Math.floor(this.w * this.dpr)\n    this.canvas.height = Math.floor(this.h * this.dpr)\n    this.ctx.setTransform(this.dpr, 0, 0, this.dpr, 0, 0)\n    this.ctx.imageSmoothingEnabled = false\n\n    this.rebuildGrid(!initial)\n  }\n\n  private rebuildGrid(preserve: boolean) {\n    const newCols = Math.max(8, Math.floor(this.w / this.cellSize))\n    const newRows = Math.max(8, Math.floor(this.h / this.cellSize))\n    const newLength = newCols * newRows\n    const newGrid = new Uint8Array(newLength)\n    const newAge = new Uint16Array(newLength)\n\n    if (preserve && this.cols > 0 && this.rows > 0) {\n      const copyCols = Math.min(this.cols, newCols)\n      const copyRows = Math.min(this.rows, newRows)\n      const srcX = Math.floor((this.cols - copyCols) / 2)\n      const srcY = Math.floor((this.rows - copyRows) / 2)\n      const dstX = Math.floor((newCols - copyCols) / 2)\n      const dstY = Math.floor((newRows - copyRows) / 2)\n\n      for (let row = 0; row < copyRows; row++) {\n        for (let col = 0; col < copyCols; col++) {\n          const srcIdx = (srcY + row) * this.cols + (srcX + col)\n          const dstIdx = (dstY + row) * newCols + (dstX + col)\n          newGrid[dstIdx] = this.grid[srcIdx]\n          newAge[dstIdx] = this.age[srcIdx]\n        }\n      }\n    }\n\n    this.cols = newCols\n    this.rows = newRows\n    this.grid = newGrid\n    this.next = new Uint8Array(newLength)\n    this.age = newAge\n    this.accumulator = 0\n    this.markDirty()\n  }\n\n  private markDirty() {\n    this.dirty = true\n    this.requestFrame()\n  }\n\n  private requestFrame() {\n    if (this.disposed || this.animationId !== 0) return\n    this.animationId = requestAnimationFrame(this.animate)\n  }\n\n  private notifyGeneration() {\n    if (!this.generationListener) return\n    this.generationListener(this.generation)\n  }\n\n  private initListeners() {\n    this.resizeObserver = new ResizeObserver(() => this.resizeCanvas(false))\n    this.resizeObserver.observe(this.container)\n\n    this.canvas.addEventListener('pointerdown', this.onPointerDown)\n    window.addEventListener('pointermove', this.onPointerMove)\n    window.addEventListener('pointerup', this.onPointerUp)\n    window.addEventListener('pointercancel', this.onPointerUp)\n    this.canvas.addEventListener('contextmenu', this.onContextMenu)\n  }\n\n  private onPointerDown = (e: PointerEvent) => {\n    if (e.button !== 0) return\n\n    const idx = this.indexFromClient(e.clientX, e.clientY)\n    if (idx < 0) return\n\n    this.pointerDown = true\n    this.pointerId = e.pointerId\n    this.paintValue = this.grid[idx] === 1 ? 0 : 1\n\n    this.paintCell(idx, this.paintValue)\n    this.canvas.setPointerCapture(e.pointerId)\n  }\n\n  private onPointerMove = (e: PointerEvent) => {\n    if (!this.pointerDown || this.pointerId !== e.pointerId) return\n    const idx = this.indexFromClient(e.clientX, e.clientY)\n    if (idx < 0) return\n    this.paintCell(idx, this.paintValue)\n  }\n\n  private onPointerUp = (e: PointerEvent) => {\n    if (this.pointerId !== e.pointerId) return\n    this.pointerDown = false\n    this.pointerId = null\n    if (this.canvas.hasPointerCapture(e.pointerId)) {\n      this.canvas.releasePointerCapture(e.pointerId)\n    }\n  }\n\n  private onContextMenu = (e: MouseEvent) => {\n    e.preventDefault()\n  }\n\n  private paintCell(index: number, value: 0 | 1) {\n    if (this.grid[index] === value) return\n    this.grid[index] = value\n    this.age[index] = value === 1 ? Math.max(1, this.age[index]) : 0\n    this.markDirty()\n  }\n\n  private indexFromClient(clientX: number, clientY: number): number {\n    const rect = this.canvas.getBoundingClientRect()\n    const rx = clientX - rect.left\n    const ry = clientY - rect.top\n    if (rx < 0 || ry < 0 || rx >= rect.width || ry >= rect.height) return -1\n\n    const x = (rx / rect.width) * this.w\n    const y = (ry / rect.height) * this.h\n    const col = Math.floor(x / this.cellSize)\n    const row = Math.floor(y / this.cellSize)\n\n    if (col < 0 || col >= this.cols || row < 0 || row >= this.rows) return -1\n    return row * this.cols + col\n  }\n}\n"],"names":["RULE_CONFIG","life","survive","birth","highlife","seeds","clamp","value","min","max","Math","toRuleMask","rule","Array","from","length","n","CellularAutomataEngine","container","grid","Uint8Array","next","age","Uint16Array","cols","rows","w","h","dpr","cellSize","wrapEdges","running","generation","tickInterval","accumulator","ruleMask","animationId","lastTs","disposed","pointerDown","pointerId","paintValue","resizeObserver","dirty","generationListener","animate","ts","this","generationChanged","dt","stepped","stepSimulation","notifyGeneration","draw","requestFrame","onPointerDown","e","button","idx","indexFromClient","clientX","clientY","paintCell","canvas","setPointerCapture","onPointerMove","onPointerUp","hasPointerCapture","releasePointerCapture","onContextMenu","preventDefault","document","createElement","style","width","height","display","touchAction","appendChild","ctx","getContext","Error","resizeCanvas","randomize","initListeners","_proto","prototype","setRule","setCellSize","size","nextSize","round","setSpeed","fps","setRunning","setWrapEdges","enabled","density","p","i","alive","random","markDirty","clear","fill","step","getGeneration","setGenerationListener","listener","dispose","_this$resizeObserver","cancelAnimationFrame","disconnect","removeEventListener","window","parentElement","removeChild","source","target","row","col","neighbors","countNeighbors","isAlive","prevAge","count","oy","ox","nx","ny","clearRect","fillStyle","fillRect","cellDrawSize","hue","light","strokeStyle","lineWidth","beginPath","x","px","moveTo","lineTo","y","py","stroke","initial","rect","getBoundingClientRect","floor","devicePixelRatio","setTransform","imageSmoothingEnabled","rebuildGrid","preserve","newCols","newRows","newLength","newGrid","newAge","copyCols","copyRows","srcX","srcY","dstX","dstY","srcIdx","dstIdx","requestAnimationFrame","ResizeObserver","observe","addEventListener","index","rx","left","ry","top"],"sourceRoot":""}