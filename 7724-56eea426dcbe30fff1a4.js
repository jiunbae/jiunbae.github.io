"use strict";(self.webpackChunkjiunbae_github_io=self.webpackChunkjiunbae_github_io||[]).push([[7724],{546:function(t,s,i){function o(t){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}function n(t){var s=function(t,s){if("object"!=o(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,s||"default");if("object"!=o(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===s?String:Number)(t)}(t,"string");return"symbol"==o(s)?s:s+""}function e(t,s){for(var i=0;i<s.length;i++){var o=s[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,n(o.key),o)}}function a(t,s,i){return s&&e(t.prototype,s),i&&e(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}i.d(s,{A:function(){return a}})},7724:function(t,s,i){i.r(s),i.d(s,{PhysicsEngine:function(){return D}});var o=i(546),n=i(7116);function e(t,s){return{x:t,y:s}}function a(t,s){return{x:t.x+s.x,y:t.y+s.y}}function r(t,s){return{x:t.x-s.x,y:t.y-s.y}}function h(t,s){return{x:t.x*s,y:t.y*s}}function l(t,s){return t.x*s.x+t.y*s.y}function c(t,s){return t.x*s.y-t.y*s.x}function u(t){return Math.sqrt(t.x*t.x+t.y*t.y)}function d(t){return t.x*t.x+t.y*t.y}function y(t){const s=u(t);return s<1e-10?{x:0,y:0}:{x:t.x/s,y:t.y/s}}function f(t){return{x:-t.y,y:t.x}}function p(t){return{x:-t.x,y:-t.y}}function v(t,s){const i=Math.cos(s),o=Math.sin(s);return{x:t.x*i-t.y*o,y:t.x*o+t.y*i}}function g(t,s,i){return t<s?s:t>i?i:t}let b=0;function m(t,s,i,o){const n=Math.max(i,5),a=Math.PI*n*n*.01,r=.5*a*n*n;return{type:"circle",pos:e(t,s),vel:e(0,0),angle:0,angVel:0,mass:a,invMass:1/a,inertia:r,invInertia:1/r,restitution:o,radius:n,halfW:0,halfH:0,color:M(),id:b++,isStatic:!1}}function x(t,s,i,o,n){const a=Math.max(i,5),r=Math.max(o,5),h=a*r*4*.01,l=h/12*(4*a*a+4*r*r);return{type:"box",pos:e(t,s),vel:e(0,0),angle:0,angVel:0,mass:h,invMass:1/h,inertia:l,invInertia:1/l,restitution:n,radius:Math.sqrt(a*a+r*r),halfW:a,halfH:r,color:M(),id:b++,isStatic:!1}}function M(){return`hsl(${0|360*Math.random()}, ${0|50+30*Math.random()}%, ${0|55+20*Math.random()}%)`}function S(t){const s=t.halfW,i=t.halfH;return[e(-s,-i),e(s,-i),e(s,i),e(-s,i)].map(s=>a(t.pos,v(s,t.angle)))}function A(t){return[v(e(1,0),t.angle),v(e(0,1),t.angle)]}function w(t,s){let i=1/0,o=-1/0;for(const n of t){const t=l(n,s);t<i&&(i=t),t>o&&(o=t)}return{min:i,max:o}}function C(t,s){const i=v(r(t.pos,s.pos),-s.angle),o=r(i,e(g(i.x,-s.halfW,s.halfW),g(i.y,-s.halfH,s.halfH))),n=d(o);if(n>t.radius*t.radius)return null;const a=Math.sqrt(n);let l,c;if(a<1e-6){const o=i.x+s.halfW,n=s.halfW-i.x,a=i.y+s.halfH,r=s.halfH-i.y,h=Math.min(o,n,a,r);l=h===o?e(-1,0):h===n?e(1,0):e(0,h===a?-1:1),c=t.radius+h}else l=h(o,1/a),c=t.radius-a;const u=v(l,s.angle);return{bodyA:t,bodyB:s,normal:u,penetration:c,contactPoint:r(t.pos,h(u,t.radius-.5*c))}}function P(t,s){if("circle"===t.type&&"circle"===s.type)return function(t,s){const i=r(s.pos,t.pos),o=d(i),n=t.radius+s.radius;if(o>n*n)return null;const l=Math.sqrt(o);if(l<1e-6)return{bodyA:t,bodyB:s,normal:e(0,1),penetration:n,contactPoint:t.pos};const c=h(i,1/l),u=n-l;return{bodyA:t,bodyB:s,normal:c,penetration:u,contactPoint:a(t.pos,h(c,t.radius-.5*u))}}(t,s);if("circle"===t.type&&"box"===s.type)return C(t,s);if("box"===t.type&&"circle"===s.type){const i=C(s,t);return i&&(i.bodyA=t,i.bodyB=s,i.normal=p(i.normal)),i}return"box"===t.type&&"box"===s.type?function(t,s){const i=S(t),o=S(s),c=A(t),u=A(s),d=[].concat((0,n.A)(c),(0,n.A)(u));let y=1/0,f=e(0,0);for(const n of d){const t=w(i,n),s=w(o,n),e=Math.min(t.max-s.min,s.max-t.min);if(e<=0)return null;e<y&&(y=e,f=n)}return l(r(s.pos,t.pos),f)<0&&(f=p(f)),{bodyA:t,bodyB:s,normal:f,penetration:y,contactPoint:a(t.pos,h(r(s.pos,t.pos),.5))}}(t,s):null}function I(t){const s=t.bodyA,i=t.bodyB,o=t.normal,n=h(o,Math.max(t.penetration-.5,0)/(s.invMass+i.invMass)*.6);s.pos=r(s.pos,h(n,s.invMass)),i.pos=a(i.pos,h(n,i.invMass));const e=r(t.contactPoint,s.pos),u=r(t.contactPoint,i.pos),d=a(s.vel,h(f(e),s.angVel)),p=l(r(a(i.vel,h(f(u),i.angVel)),d),o);if(p>0)return;const v=Math.min(s.restitution,i.restitution),g=c(e,o),b=c(u,o),m=-(1+v)*p/(s.invMass+i.invMass+g*g*s.invInertia+b*b*i.invInertia),x=h(o,m);s.vel=r(s.vel,h(x,s.invMass)),i.vel=a(i.vel,h(x,i.invMass)),s.angVel-=c(e,x)*s.invInertia,i.angVel+=c(u,x)*i.invInertia;const M=r(a(i.vel,h(f(u),i.angVel)),a(s.vel,h(f(e),s.angVel))),S=y(r(M,h(o,l(M,o)))),A=l(M,S);if(Math.abs(A)<1e-6)return;const w=c(e,S),C=c(u,S);let P=-A/(s.invMass+i.invMass+w*w*s.invInertia+C*C*i.invInertia);Math.abs(P)>.3*m&&(P=.3*m*Math.sign(P));const I=h(S,P);s.vel=r(s.vel,h(I,s.invMass)),i.vel=a(i.vel,h(I,i.invMass)),s.angVel-=c(e,I)*s.invInertia,i.angVel+=c(u,I)*i.invInertia}let E=function(){function t(t,s,i,o){this.cellSize=i,this.cols=Math.max(1,Math.ceil(t/i)),this.rows=Math.max(1,Math.ceil(s/i)),this.cellCapacity=o;const n=this.cols*this.rows;this.grid=new Int32Array(n*o),this.counts=new Int32Array(n)}var s=t.prototype;return s.clear=function(){this.counts.fill(0)},s.insert=function(t,s,i){const o=Math.floor(s/this.cellSize),n=Math.floor(i/this.cellSize);if(o<0||o>=this.cols||n<0||n>=this.rows)return;const e=n*this.cols+o,a=this.counts[e];a<this.cellCapacity&&(this.grid[e*this.cellCapacity+a]=t,this.counts[e]=a+1)},s.query=function(t,s,i,o){const n=Math.max(0,Math.floor((t-i)/this.cellSize)),e=Math.min(this.cols-1,Math.floor((t+i)/this.cellSize)),a=Math.max(0,Math.floor((s-i)/this.cellSize)),r=Math.min(this.rows-1,Math.floor((s+i)/this.cellSize));for(let h=a;h<=r;h++)for(let t=n;t<=e;t++){const s=h*this.cols+t,i=this.counts[s],n=s*this.cellCapacity;for(let t=0;t<i;t++)o(this.grid[n+t])}},s.resize=function(t,s){this.cols=Math.max(1,Math.ceil(t/this.cellSize)),this.rows=Math.max(1,Math.ceil(s/this.cellSize));const i=this.cols*this.rows;this.grid=new Int32Array(i*this.cellCapacity),this.counts=new Int32Array(i)},t}();const T={x:0,y:0};function L(t,s,i){return t.x=s.x-i.x,t.y=s.y-i.y,t}let D=function(){function t(t){this.bodies=[],this.springs=[],this.tool="circle",this.gravity=e(0,400),this.restitution=.5,this.mouse=e(0,0),this.mouseDown=!1,this.dragStart=null,this.springAnchor=null,this.FIXED_DT=1/60,this.accumulator=0,this.lastTime=0,this.animationId=0,this.disposed=!1,this.resizeObserver=null,this.GRID_SIZE=40,this.SPATIAL_CELL_SIZE=80,this.bodyCountChangeCallback=null,this.onMouseDown=t=>{if(this.mouse=this.getMousePos(t),this.mouseDown=!0,"circle"===this.tool||"box"===this.tool)this.dragStart={...this.mouse};else if("spring"===this.tool){const t=this.bodyAtPoint(this.mouse);t&&(this.springAnchor=t)}else"explosion"===this.tool&&this.applyExplosion(this.mouse)},this.onMouseMove=t=>{this.mouse=this.getMousePos(t)},this.onMouseUp=t=>{if(this.mouse=this.getMousePos(t),this.mouseDown=!1,"circle"===this.tool&&this.dragStart){const t=u(r(this.mouse,this.dragStart));if(t>3){const s=m(this.dragStart.x,this.dragStart.y,t,this.restitution);this.bodies.push(s),this.notifyBodyCountChange()}this.dragStart=null}else if("box"===this.tool&&this.dragStart){const t=.5*Math.abs(this.mouse.x-this.dragStart.x),s=.5*Math.abs(this.mouse.y-this.dragStart.y);if(t>3&&s>3){const i=x(.5*(this.mouse.x+this.dragStart.x),.5*(this.mouse.y+this.dragStart.y),t,s,this.restitution);this.bodies.push(i),this.notifyBodyCountChange()}this.dragStart=null}else if("spring"===this.tool&&this.springAnchor){const t=this.bodyAtPoint(this.mouse);if(t&&t!==this.springAnchor){const s=u(r(t.pos,this.springAnchor.pos));this.springs.push({bodyA:this.springAnchor,bodyB:t,restLength:s,stiffness:200,damping:5})}this.springAnchor=null}this.dragStart=null},this.onTouchStart=t=>{t.preventDefault();const s=t.touches[0];if(this.mouse=this.getMousePos(s),this.mouseDown=!0,"circle"===this.tool||"box"===this.tool)this.dragStart={...this.mouse};else if("spring"===this.tool){const t=this.bodyAtPoint(this.mouse);t&&(this.springAnchor=t)}else"explosion"===this.tool&&this.applyExplosion(this.mouse)},this.onTouchMove=t=>{t.preventDefault(),this.mouse=this.getMousePos(t.touches[0])},this.onTouchEnd=()=>{if(this.mouseDown=!1,"circle"===this.tool&&this.dragStart){const t=u(r(this.mouse,this.dragStart));t>3&&(this.bodies.push(m(this.dragStart.x,this.dragStart.y,t,this.restitution)),this.notifyBodyCountChange()),this.dragStart=null}else if("box"===this.tool&&this.dragStart){const t=.5*Math.abs(this.mouse.x-this.dragStart.x),s=.5*Math.abs(this.mouse.y-this.dragStart.y);if(t>3&&s>3){const i=.5*(this.mouse.x+this.dragStart.x),o=.5*(this.mouse.y+this.dragStart.y);this.bodies.push(x(i,o,t,s,this.restitution)),this.notifyBodyCountChange()}this.dragStart=null}else if("spring"===this.tool&&this.springAnchor){const t=this.bodyAtPoint(this.mouse);if(t&&t!==this.springAnchor){const s=u(r(t.pos,this.springAnchor.pos));this.springs.push({bodyA:this.springAnchor,bodyB:t,restLength:s,stiffness:200,damping:5})}this.springAnchor=null}},this.animate=()=>{if(this.disposed)return;this.animationId=requestAnimationFrame(this.animate);const t=performance.now(),s=Math.min(.001*(t-this.lastTime),.1);for(this.lastTime=t,this.accumulator+=s;this.accumulator>=this.FIXED_DT;)this.physicsStep(this.FIXED_DT),this.accumulator-=this.FIXED_DT;this.draw()},this.container=t,this.canvas=document.createElement("canvas"),this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.display="block",t.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d"),this.resizeCanvas();const s=this.container.clientWidth,i=this.container.clientHeight;this.spatialGrid=new E(s,i,this.SPATIAL_CELL_SIZE,20),this.initListeners(),this.lastTime=performance.now(),this.animate()}var s=t.prototype;return s.setTool=function(t){this.tool=t,this.springAnchor=null},s.setGravity=function(t){this.gravity=e(0,t)},s.setRestitution=function(t){this.restitution=g(t,0,1);for(const s of this.bodies)s.restitution=this.restitution},s.clear=function(){this.bodies=[],this.springs=[],this.springAnchor=null,this.notifyBodyCountChange()},s.onBodyCountChange=function(t){this.bodyCountChangeCallback=t},s.notifyBodyCountChange=function(){this.bodyCountChangeCallback&&this.bodyCountChangeCallback(this.bodies.length)},s.dispose=function(){this.disposed=!0,cancelAnimationFrame(this.animationId),this.removeListeners(),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.canvas.parentElement&&this.canvas.parentElement.removeChild(this.canvas)},s.resizeCanvas=function(){const t=Math.min(window.devicePixelRatio,2),s=this.container.clientWidth,i=this.container.clientHeight;this.canvas.width=s*t,this.canvas.height=i*t,this.ctx.setTransform(t,0,0,t,0,0)},s.getMousePos=function(t){const s=this.canvas.getBoundingClientRect();return e(t.clientX-s.left,t.clientY-s.top)},s.bodyAtPoint=function(t){for(let s=this.bodies.length-1;s>=0;s--){const i=this.bodies[s];if("circle"===i.type){if(d(r(t,i.pos))<=i.radius*i.radius)return i}else{const s=v(r(t,i.pos),-i.angle);if(Math.abs(s.x)<=i.halfW&&Math.abs(s.y)<=i.halfH)return i}}return null},s.initListeners=function(){this.canvas.addEventListener("mousedown",this.onMouseDown),this.canvas.addEventListener("mousemove",this.onMouseMove),window.addEventListener("mouseup",this.onMouseUp),this.canvas.addEventListener("touchstart",this.onTouchStart,{passive:!1}),this.canvas.addEventListener("touchmove",this.onTouchMove,{passive:!1}),window.addEventListener("touchend",this.onTouchEnd),this.resizeObserver=new ResizeObserver(()=>{this.disposed||(this.resizeCanvas(),this.spatialGrid.resize(this.container.clientWidth,this.container.clientHeight))}),this.resizeObserver.observe(this.container)},s.removeListeners=function(){this.canvas.removeEventListener("mousedown",this.onMouseDown),this.canvas.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("mouseup",this.onMouseUp),this.canvas.removeEventListener("touchstart",this.onTouchStart),this.canvas.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("touchend",this.onTouchEnd)},s.applyGravityGun=function(t){if(!this.mouseDown||"gravity"!==this.tool)return;for(const s of this.bodies){const i=r(this.mouse,s.pos),o=u(i);if(o<250&&o>1){const n=h(y(i),8e3*t/Math.max(o,30));s.vel=a(s.vel,h(n,s.invMass))}}},s.applyExplosion=function(t){for(const s of this.bodies){const i=r(s.pos,t),o=u(i);if(o<300&&o>1){const t=h(y(i),5e4/Math.max(o,20));s.vel=a(s.vel,h(t,s.invMass))}}},s.physicsStep=function(t){const s=this.container.clientWidth,i=this.container.clientHeight;this.applyGravityGun(t);for(const r of this.bodies)r.isStatic||(r.vel=a(r.vel,h(this.gravity,t)));for(const f of this.springs){const s=r(f.bodyB.pos,f.bodyA.pos),i=u(s);if(i<1e-6)continue;const o=h(s,1/i),n=i-f.restLength,e=l(r(f.bodyB.vel,f.bodyA.vel),o)*f.damping,c=h(o,n*f.stiffness+e);f.bodyA.vel=a(f.bodyA.vel,h(c,f.bodyA.invMass*t)),f.bodyB.vel=r(f.bodyB.vel,h(c,f.bodyB.invMass*t))}for(const r of this.bodies)r.isStatic||(r.pos=a(r.pos,h(r.vel,t)),r.angle+=r.angVel*t,r.angVel*=.998,r.vel=h(r.vel,.999));const o=this.bodies,n=o.length;this.spatialGrid.clear();let e=0;for(let a=0;a<n;a++)o[a].radius>e&&(e=o[a].radius),this.spatialGrid.insert(a,o[a].pos.x,o[a].pos.y);const c=2*e*1.1;for(let a=0;a<n;a++){const t=o[a];this.spatialGrid.query(t.pos.x,t.pos.y,c,s=>{if(s<=a)return;const i=o[s];L(T,t.pos,i.pos);const n=T.x*T.x+T.y*T.y,e=t.radius+i.radius;if(n>e*e*1.2)return;const r=P(t,i);r&&I(r)})}for(const a of o)this.resolveWall(a,s,i);const d=this.bodies.length;this.bodies=this.bodies.filter(t=>t.pos.y<i+500&&t.pos.y>-500&&t.pos.x>-500&&t.pos.x<s+500),this.bodies.length!==d&&this.notifyBodyCountChange();const y=new Set(this.bodies);this.springs=this.springs.filter(t=>y.has(t.bodyA)&&y.has(t.bodyB))},s.resolveWall=function(t,s,i){const o=t.restitution;if("circle"===t.type)t.pos.y+t.radius>i&&(t.pos.y=i-t.radius,t.vel.y=-Math.abs(t.vel.y)*o,t.angVel+=.01*t.vel.x),t.pos.y-t.radius<0&&(t.pos.y=t.radius,t.vel.y=Math.abs(t.vel.y)*o),t.pos.x+t.radius>s&&(t.pos.x=s-t.radius,t.vel.x=-Math.abs(t.vel.x)*o),t.pos.x-t.radius<0&&(t.pos.x=t.radius,t.vel.x=Math.abs(t.vel.x)*o);else{const n=t.radius;t.pos.y+n>i&&(t.pos.y=i-n,t.vel.y=-Math.abs(t.vel.y)*o,t.angVel+=.005*t.vel.x),t.pos.y-n<0&&(t.pos.y=n,t.vel.y=Math.abs(t.vel.y)*o),t.pos.x+n>s&&(t.pos.x=s-n,t.vel.x=-Math.abs(t.vel.x)*o),t.pos.x-n<0&&(t.pos.x=n,t.vel.x=Math.abs(t.vel.x)*o)}},s.draw=function(){const t=this.ctx,s=this.container.clientWidth,i=this.container.clientHeight;t.fillStyle="#0a0a0a",t.fillRect(0,0,s,i),t.strokeStyle="rgba(255, 255, 255, 0.04)",t.lineWidth=1,t.beginPath();for(let o=0;o<s;o+=this.GRID_SIZE)t.moveTo(o,0),t.lineTo(o,i);for(let o=0;o<i;o+=this.GRID_SIZE)t.moveTo(0,o),t.lineTo(s,o);t.stroke(),t.setLineDash([6,4]),t.lineWidth=1.5;for(const o of this.springs){const s=Math.abs(u(r(o.bodyB.pos,o.bodyA.pos))-o.restLength)/o.restLength,i=Math.min(255,120+400*s),n=Math.max(0,180-300*s);t.strokeStyle=`rgba(${0|i}, ${0|n}, 120, 0.7)`,t.beginPath(),t.moveTo(o.bodyA.pos.x,o.bodyA.pos.y),t.lineTo(o.bodyB.pos.x,o.bodyB.pos.y),t.stroke()}t.setLineDash([]);for(const o of this.bodies)t.save(),t.translate(o.pos.x,o.pos.y),t.rotate(o.angle),"circle"===o.type?(t.beginPath(),t.arc(0,0,o.radius,0,2*Math.PI),t.fillStyle=o.color,t.globalAlpha=.85,t.fill(),t.globalAlpha=1,t.strokeStyle="rgba(255, 255, 255, 0.2)",t.lineWidth=1,t.stroke(),t.beginPath(),t.moveTo(0,0),t.lineTo(.8*o.radius,0),t.strokeStyle="rgba(255, 255, 255, 0.3)",t.lineWidth=1.5,t.stroke()):(t.fillStyle=o.color,t.globalAlpha=.85,t.fillRect(-o.halfW,-o.halfH,2*o.halfW,2*o.halfH),t.globalAlpha=1,t.strokeStyle="rgba(255, 255, 255, 0.2)",t.lineWidth=1,t.strokeRect(-o.halfW,-o.halfH,2*o.halfW,2*o.halfH),t.fillStyle="rgba(255, 255, 255, 0.3)",t.beginPath(),t.arc(o.halfW-4,4-o.halfH,2,0,2*Math.PI),t.fill()),t.restore();this.drawToolPreview(t),"spring"===this.tool&&this.springAnchor&&(t.strokeStyle="rgba(255, 180, 60, 0.6)",t.lineWidth=2,t.setLineDash([4,4]),t.beginPath(),t.moveTo(this.springAnchor.pos.x,this.springAnchor.pos.y),t.lineTo(this.mouse.x,this.mouse.y),t.stroke(),t.setLineDash([])),"gravity"===this.tool&&this.mouseDown&&(t.strokeStyle="rgba(100, 200, 255, 0.25)",t.lineWidth=1,t.beginPath(),t.arc(this.mouse.x,this.mouse.y,250,0,2*Math.PI),t.stroke(),t.fillStyle="rgba(100, 200, 255, 0.4)",t.beginPath(),t.arc(this.mouse.x,this.mouse.y,6,0,2*Math.PI),t.fill())},s.drawToolPreview=function(t){if(this.dragStart&&this.mouseDown){if(t.strokeStyle="rgba(255, 255, 255, 0.4)",t.lineWidth=1,t.setLineDash([4,4]),"circle"===this.tool){const s=u(r(this.mouse,this.dragStart));t.beginPath(),t.arc(this.dragStart.x,this.dragStart.y,s,0,2*Math.PI),t.stroke()}else if("box"===this.tool){const s=Math.min(this.dragStart.x,this.mouse.x),i=Math.min(this.dragStart.y,this.mouse.y),o=Math.abs(this.mouse.x-this.dragStart.x),n=Math.abs(this.mouse.y-this.dragStart.y);t.strokeRect(s,i,o,n)}t.setLineDash([])}},(0,o.A)(t,[{key:"bodyCount",get:function(){return this.bodies.length}}])}()}}]);
//# sourceMappingURL=7724-56eea426dcbe30fff1a4.js.map