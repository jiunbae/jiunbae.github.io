"use strict";(self.webpackChunkjiunbae_github_io=self.webpackChunkjiunbae_github_io||[]).push([[8065],{546:function(t,s,i){function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function o(t){var s=function(t,s){if("object"!=e(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,s||"default");if("object"!=e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===s?String:Number)(t)}(t,"string");return"symbol"==e(s)?s:s+""}function n(t,s){for(var i=0;i<s.length;i++){var e=s[i];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,o(e.key),e)}}function h(t,s,i){return s&&n(t.prototype,s),i&&n(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}i.d(s,{A:function(){return h}})},8065:function(t,s,i){i.r(s),i.d(s,{BoidsEngine:function(){return u}});var e=i(546);function o(t,s){return{x:t,y:s}}function n(t,s){return{x:t.x+s.x,y:t.y+s.y}}function h(t){return Math.sqrt(t.x*t.x+t.y*t.y)}function a(t,s){const i=h(t);if(i<1e-10)return{x:0,y:0};const e=s/i;return{x:t.x*e,y:t.y*e}}function r(t,s){return Math.sqrt(t*t+s*s)}const c={x:0,y:0};let l=function(){function t(t,s,i,e){this.cellSize=i,this.cols=Math.ceil(t/i),this.rows=Math.ceil(s/i),this.cellCapacity=e;const o=this.cols*this.rows;this.grid=new Int32Array(o*e),this.counts=new Int32Array(o)}var s=t.prototype;return s.clear=function(){this.counts.fill(0)},s.insert=function(t,s,i){const e=Math.floor(s/this.cellSize),o=Math.floor(i/this.cellSize);if(e<0||e>=this.cols||o<0||o>=this.rows)return;const n=o*this.cols+e,h=this.counts[n];h<this.cellCapacity&&(this.grid[n*this.cellCapacity+h]=t,this.counts[n]=h+1)},s.query=function(t,s,i,e){const o=Math.max(0,Math.floor((t-i)/this.cellSize)),n=Math.min(this.cols-1,Math.floor((t+i)/this.cellSize)),h=Math.max(0,Math.floor((s-i)/this.cellSize)),a=Math.min(this.rows-1,Math.floor((s+i)/this.cellSize));for(let r=h;r<=a;r++)for(let t=o;t<=n;t++){const s=r*this.cols+t,i=this.counts[s],o=s*this.cellCapacity;for(let t=0;t<i;t++)e(this.grid[o+t])}},s.resize=function(t,s){this.cols=Math.ceil(t/this.cellSize),this.rows=Math.ceil(s/this.cellSize);const i=this.cols*this.rows;this.grid=new Int32Array(i*this.cellCapacity),this.counts=new Int32Array(i)},t}(),u=function(){function t(t){this.boids=[],this.predator=null,this.hasPredator=!1,this.showTrails=!1,this.separationWeight=1.5,this.alignmentWeight=1,this.cohesionWeight=1,this.perceptionRadius=50,this.maxSpeed=3,this.minSpeed=1.5,this.maxForce=.15,this.mouseMode="none",this.mousePos=o(0,0),this.mouseInCanvas=!1,this.mouseInfluenceRadius=150,this.w=0,this.h=0,this.animationId=0,this.disposed=!1,this.resizeObserver=null,this.onMouseMove=t=>{const s=this.canvas.getBoundingClientRect();this.mousePos=o(t.clientX-s.left,t.clientY-s.top),this.mouseInCanvas=!0},this.onMouseLeave=()=>{this.mouseInCanvas=!1},this.onTouchMove=t=>{t.preventDefault();const s=this.canvas.getBoundingClientRect(),i=t.touches[0];this.mousePos=o(i.clientX-s.left,i.clientY-s.top),this.mouseInCanvas=!0},this.onTouchEnd=()=>{this.mouseInCanvas=!1},this.animate=()=>{this.disposed||(this.animationId=requestAnimationFrame(this.animate),this.updateBoids(),this.draw())},this.container=t,this.canvas=document.createElement("canvas"),this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.display="block",t.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d"),this.resizeCanvas(),this.spatialHash=new l(this.w,this.h,this.perceptionRadius,30),this.initBoids(1500),this.initListeners(),this.animate()}var s=t.prototype;return s.setBoidCount=function(t){const s=Math.max(100,Math.min(t,5e3));if(s>this.boids.length)for(;this.boids.length<s;)this.boids.push(this.createRandomBoid());else this.boids.length=s},s.setSeparation=function(t){this.separationWeight=t},s.setAlignment=function(t){this.alignmentWeight=t},s.setCohesion=function(t){this.cohesionWeight=t},s.setPerceptionRadius=function(t){this.perceptionRadius=t,this.spatialHash=new l(this.w,this.h,t,30)},s.setMouseMode=function(t){this.mouseMode=t},s.togglePredator=function(){return this.hasPredator=!this.hasPredator,this.hasPredator&&!this.predator&&(this.predator={pos:o(.5*this.w,.5*this.h),vel:o(2*Math.random()-1,2*Math.random()-1),acc:o(0,0)}),this.hasPredator||(this.predator=null),this.hasPredator},s.toggleTrails=function(){if(this.showTrails=!this.showTrails,!this.showTrails)for(const t of this.boids)t.trail=[];return this.showTrails},s.dispose=function(){this.disposed=!0,cancelAnimationFrame(this.animationId),this.removeListeners(),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.canvas.parentElement&&this.canvas.parentElement.removeChild(this.canvas)},s.resizeCanvas=function(){const t=Math.min(window.devicePixelRatio,2);this.w=this.container.clientWidth,this.h=this.container.clientHeight,this.canvas.width=this.w*t,this.canvas.height=this.h*t,this.ctx.setTransform(t,0,0,t,0,0)},s.createRandomBoid=function(){const t=Math.random()*Math.PI*2,s=this.minSpeed+Math.random()*(this.maxSpeed-this.minSpeed);return{pos:o(Math.random()*this.w,Math.random()*this.h),vel:o(Math.cos(t)*s,Math.sin(t)*s),acc:o(0,0),trail:[]}},s.initBoids=function(t){this.boids=[];for(let s=0;s<t;s++)this.boids.push(this.createRandomBoid())},s.initListeners=function(){this.canvas.addEventListener("mousemove",this.onMouseMove),this.canvas.addEventListener("mouseleave",this.onMouseLeave),this.canvas.addEventListener("touchmove",this.onTouchMove,{passive:!1}),window.addEventListener("touchend",this.onTouchEnd),this.resizeObserver=new ResizeObserver(()=>{this.disposed||(this.resizeCanvas(),this.spatialHash.resize(this.w,this.h))}),this.resizeObserver.observe(this.container)},s.removeListeners=function(){this.canvas.removeEventListener("mousemove",this.onMouseMove),this.canvas.removeEventListener("mouseleave",this.onMouseLeave),this.canvas.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("touchend",this.onTouchEnd)},s.wrapDelta=function(t,s){return t>.5*this.w?t-=this.w:t<.5*-this.w&&(t+=this.w),s>.5*this.h?s-=this.h:s<.5*-this.h&&(s+=this.h),o(t,s)},s.wrapDeltaMut=function(t,s){return t>.5*this.w?t-=this.w:t<.5*-this.w&&(t+=this.w),s>.5*this.h?s-=this.h:s<.5*-this.h&&(s+=this.h),c.x=t,c.y=s,c},s.updateBoids=function(){const t=this.w,s=this.h,i=this.boids,e=i.length,n=this.perceptionRadius,h=n*n;this.spatialHash.clear();for(let o=0;o<e;o++){const e=i[o];this.spatialHash.insert(o,e.pos.x,e.pos.y),e.pos.x<n?this.spatialHash.insert(o,e.pos.x+t,e.pos.y):e.pos.x>t-n&&this.spatialHash.insert(o,e.pos.x-t,e.pos.y),e.pos.y<n?this.spatialHash.insert(o,e.pos.x,e.pos.y+s):e.pos.y>s-n&&this.spatialHash.insert(o,e.pos.x,e.pos.y-s)}for(let o=0;o<e;o++){const t=i[o];let s=0,e=0,a=0,c=0,l=0,u=0,p=0,d=0,f=0;this.spatialHash.query(t.pos.x,t.pos.y,n,n=>{if(n===o)return;const r=i[n],m=this.wrapDeltaMut(r.pos.x-t.pos.x,r.pos.y-t.pos.y),v=m.x,y=m.y,x=v*v+y*y;if(x>h||x<1e-6)return;const w=Math.sqrt(x);s-=v/w,e-=y/w,a++,c+=r.vel.x,l+=r.vel.y,u++,p+=v,d+=y,f++});let m=0,v=0;if(a>0){s/=a,e/=a;const i=r(s,e);if(i>0){s=s/i*this.maxSpeed-t.vel.x,e=e/i*this.maxSpeed-t.vel.y;const o=r(s,e);o>this.maxForce&&(s=s/o*this.maxForce,e=e/o*this.maxForce)}m+=s*this.separationWeight,v+=e*this.separationWeight}if(u>0){c/=u,l/=u;const s=r(c,l);if(s>0){c=c/s*this.maxSpeed-t.vel.x,l=l/s*this.maxSpeed-t.vel.y;const i=r(c,l);i>this.maxForce&&(c=c/i*this.maxForce,l=l/i*this.maxForce)}m+=c*this.alignmentWeight,v+=l*this.alignmentWeight}if(f>0){p/=f,d/=f;const s=r(p,d);if(s>0){p=p/s*this.maxSpeed-t.vel.x,d=d/s*this.maxSpeed-t.vel.y;const i=r(p,d);i>this.maxForce&&(p=p/i*this.maxForce,d=d/i*this.maxForce)}m+=p*this.cohesionWeight,v+=d*this.cohesionWeight}if(this.mouseInCanvas&&"none"!==this.mouseMode){const s=this.mousePos.x-t.pos.x,i=this.mousePos.y-t.pos.y,e=s*s+i*i;if(e<this.mouseInfluenceRadius*this.mouseInfluenceRadius&&e>1){const o=Math.sqrt(e),n="attract"===this.mouseMode?1:-1,h=(s/o*this.maxSpeed-t.vel.x)*n,a=(i/o*this.maxSpeed-t.vel.y)*n,c=r(h,a),l=3*this.maxForce;c>l?(m+=h/c*l,v+=a/c*l):(m+=h,v+=a)}}if(this.predator){const s=this.wrapDeltaMut(this.predator.pos.x-t.pos.x,this.predator.pos.y-t.pos.y),i=s.x,e=s.y,o=i*i+e*e,h=2*n;if(o<h*h&&o>1){const s=Math.sqrt(o),n=-i/s*this.maxSpeed-t.vel.x,h=-e/s*this.maxSpeed-t.vel.y,a=r(n,h),c=4*this.maxForce;a>c?(m+=n/a*c,v+=h/a*c):(m+=n,v+=h)}}t.acc.x=m,t.acc.y=v}for(let a=0;a<e;a++){const e=i[a];this.showTrails&&(e.trail.push(o(e.pos.x,e.pos.y)),e.trail.length>5&&e.trail.shift()),e.vel.x+=e.acc.x,e.vel.y+=e.acc.y;const n=r(e.vel.x,e.vel.y);if(n>this.maxSpeed){const t=this.maxSpeed/n;e.vel.x*=t,e.vel.y*=t}else if(n<this.minSpeed&&n>1e-10){const t=this.minSpeed/n;e.vel.x*=t,e.vel.y*=t}e.pos.x+=e.vel.x,e.pos.y+=e.vel.y,e.acc.x=0,e.acc.y=0,e.pos.x<0?e.pos.x+=t:e.pos.x>t&&(e.pos.x-=t),e.pos.y<0?e.pos.y+=s:e.pos.y>s&&(e.pos.y-=s)}this.predator&&this.updatePredator()},s.updatePredator=function(){const t=this.predator,s=this.w,i=this.h;let e=1/0,r=null;for(const o of this.boids){const s=this.wrapDeltaMut(o.pos.x-t.pos.x,o.pos.y-t.pos.y),i=s.x*s.x+s.y*s.y;i<e&&(e=i,r=o)}if(r){const s=function(t){const s=h(t);return s<1e-10?{x:0,y:0}:{x:t.x/s,y:t.y/s}}(this.wrapDelta(r.pos.x-t.pos.x,r.pos.y-t.pos.y)),i=function(t,s){const i=function(t){return t.x*t.x+t.y*t.y}(t);return i>s*s?a(t,s):t}(function(t,s){return{x:t.x-s.x,y:t.y-s.y}}((c=s,l=.9*this.maxSpeed,{x:c.x*l,y:c.y*l}),t.vel),2*this.maxForce);t.acc=i}var c,l;t.vel=n(t.vel,t.acc);h(t.vel)>.9*this.maxSpeed&&(t.vel=a(t.vel,.9*this.maxSpeed)),t.pos=n(t.pos,t.vel),t.acc=o(0,0),t.pos.x<0?t.pos.x+=s:t.pos.x>s&&(t.pos.x-=s),t.pos.y<0?t.pos.y+=i:t.pos.y>i&&(t.pos.y-=i)},s.draw=function(){const t=this.ctx,s=this.w,i=this.h,e=this.boids;if(t.fillStyle="#060612",t.fillRect(0,0,s,i),this.showTrails)for(const o of e){if(o.trail.length<2)continue;const s=(Math.atan2(o.vel.y,o.vel.x)/(2*Math.PI)*360+360)%360;t.beginPath(),t.moveTo(o.trail[0].x,o.trail[0].y);for(let i=1;i<o.trail.length;i++)t.lineTo(o.trail[i].x,o.trail[i].y);t.lineTo(o.pos.x,o.pos.y),t.strokeStyle=`hsla(${0|s}, 80%, 60%, 0.2)`,t.lineWidth=1,t.stroke()}for(const o of e){const s=Math.atan2(o.vel.y,o.vel.x),i=(s/(2*Math.PI)*360+360)%360;t.save(),t.translate(o.pos.x,o.pos.y),t.rotate(s),t.fillStyle=`hsl(${0|i}, 80%, 60%)`,t.beginPath(),t.moveTo(8,0),t.lineTo(-4,4),t.lineTo(-4,-4),t.closePath(),t.fill(),t.restore()}if(this.predator){const s=this.predator,i=Math.atan2(s.vel.y,s.vel.x);t.save(),t.translate(s.pos.x,s.pos.y),t.rotate(i),t.fillStyle="#ff3030",t.beginPath(),t.moveTo(14,0),t.lineTo(-7,7),t.lineTo(-4,0),t.lineTo(-7,-7),t.closePath(),t.fill(),t.shadowColor="#ff3030",t.shadowBlur=12,t.fill(),t.shadowBlur=0,t.restore()}this.mouseInCanvas&&"none"!==this.mouseMode&&(t.strokeStyle="attract"===this.mouseMode?"rgba(100, 200, 255, 0.2)":"rgba(255, 100, 100, 0.2)",t.lineWidth=1,t.beginPath(),t.arc(this.mousePos.x,this.mousePos.y,this.mouseInfluenceRadius,0,2*Math.PI),t.stroke())},(0,e.A)(t,[{key:"boidCount",get:function(){return this.boids.length}}])}()}}]);
//# sourceMappingURL=8065-7d33a31702572b7c4835.js.map