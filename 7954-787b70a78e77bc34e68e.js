"use strict";(self.webpackChunkjiunbae_github_io=self.webpackChunkjiunbae_github_io||[]).push([[7954],{7954:function(t,e,i){i.r(e),i.d(e,{AudioVisualizerScene:function(){return l}});var s=i(546),n=i(3851),a=i(512),o=i(7855),r=i(4164),h=i(4797),c=i(6174);let l=function(){function t(t){this.userBloomStrength=1.5,this.clock=new n.zD7,this.animationId=0,this.disposed=!1,this.audioContext=null,this.analyser=null,this.sourceNode=null,this.mediaStream=null,this.frequencyData=new Uint8Array(0),this.timeDomainData=new Uint8Array(0),this.isPlaying=!1,this.currentMode="terrain",this.terrainMesh=null,this.radialGroup=null,this.radialBars=[],this.waveformMesh=null,this.cameraTargets={terrain:{pos:new n.Pq0(0,12,18),target:new n.Pq0(0,0,0)},radial:{pos:new n.Pq0(0,0,20),target:new n.Pq0(0,0,0)},waveform:{pos:new n.Pq0(0,5,16),target:new n.Pq0(0,0,0)}},this._autoRotate=!0,this.handleContextLost=t=>{t.preventDefault(),cancelAnimationFrame(this.animationId);const e=document.createElement("div");e.style.cssText="position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.8);color:#fff;font:14px/1.5 sans-serif;cursor:pointer;z-index:100",e.textContent="WebGL context lost â€” click to reload",e.addEventListener("click",()=>location.reload()),this.container.style.position="relative",this.container.appendChild(e)},this.handleContextRestored=()=>{location.reload()},this.animate=()=>{if(this.disposed)return;this.animationId=requestAnimationFrame(this.animate);const t=this.clock.getElapsedTime();if(this.isPlaying&&this.analyser&&(this.analyser.getByteFrequencyData(this.frequencyData),this.analyser.getByteTimeDomainData(this.timeDomainData)),this.isPlaying&&this.frequencyData.length>0){let t=0;const e=Math.min(8,this.frequencyData.length);for(let s=0;s<e;s++)t+=this.frequencyData[s];const i=t/e/255;this.bloomPass.strength=this.userBloomStrength*(.7+.6*i)}switch(this.currentMode){case"terrain":this.updateTerrain();break;case"radial":this.updateRadial(),this.radialGroup&&(this.radialGroup.rotation.y+=.002);break;case"waveform":if(this.updateWaveform(),this.waveformMesh){this.waveformMesh.material.uniforms.uTime.value=t}}if("terrain"===this.currentMode&&!this.isPlaying&&this.terrainMesh){const e=this.terrainMesh.geometry,i=e.attributes.position,s=e.attributes.customColor,n=128;for(let a=0;a<n;a++)for(let e=0;e<n;e++){const o=e*n+a,r=Math.sin(.08*a+.5*t)*Math.cos(.08*e+.3*t)*.5;i.setY(o,r);const h=(r+.5)/1;s.setXYZ(o,.2*h,.1+.3*h,.4+.3*(1-h))}i.needsUpdate=!0,s.needsUpdate=!0}this.controls.update(),this.composer.render()},this.onResize=()=>{if(this.disposed)return;const{clientWidth:t,clientHeight:e}=this.container;this.camera.aspect=t/e,this.camera.updateProjectionMatrix(),this.renderer.setSize(t,e),this.composer.setSize(t,e)},this.container=t,this.init(),this.buildTerrain(),this.buildRadial(),this.buildWaveform(),this.setMode("terrain"),this.animate()}var e=t.prototype;return e.init=function(){const{clientWidth:t,clientHeight:e}=this.container;this.renderer=new a.JeP({antialias:!0,alpha:!1}),this.renderer.setSize(t,e),this.renderer.setPixelRatio(Math.min(window.devicePixelRatio,2)),this.renderer.toneMapping=n.FV,this.renderer.toneMappingExposure=1,this.container.appendChild(this.renderer.domElement),this.renderer.domElement.addEventListener("webglcontextlost",this.handleContextLost),this.renderer.domElement.addEventListener("webglcontextrestored",this.handleContextRestored),this.scene=new n.Z58,this.scene.background=new n.Q1f(526352),this.scene.fog=new n.cRK(526352,.012),this.camera=new n.ubm(60,t/e,.1,200),this.camera.position.set(0,12,18),this.controls=new o.N(this.camera,this.renderer.domElement),this.controls.enableDamping=!0,this.controls.dampingFactor=.05,this.controls.autoRotate=this._autoRotate,this.controls.autoRotateSpeed=.3,this.controls.minDistance=5,this.controls.maxDistance=60,this.composer=new r.s(this.renderer),this.composer.addPass(new h.A(this.scene,this.camera)),this.bloomPass=new c.C(new n.I9Y(t,e),1.5,.6,.15),this.composer.addPass(this.bloomPass);const i=new n.$p8(2236996,.6);this.scene.add(i);const s=new n.ZyN(16777215,.4);s.position.set(10,20,10),this.scene.add(s),window.addEventListener("resize",this.onResize)},e.ensureAudioContext=function(){if(!this.disposed)return this.audioContext&&"closed"!==this.audioContext.state||(this.audioContext=new AudioContext),"suspended"===this.audioContext.state&&this.audioContext.resume(),this.audioContext},e.setupAnalyser=function(t){const e=this.ensureAudioContext();e&&(this.analyser=e.createAnalyser(),this.analyser.fftSize=2048,this.analyser.smoothingTimeConstant=.8,t.connect(this.analyser),this.analyser.connect(e.destination),this.frequencyData=new Uint8Array(this.analyser.frequencyBinCount),this.timeDomainData=new Uint8Array(this.analyser.fftSize),this.isPlaying=!0)},e.loadAudioFile=async function(t){this.stopAudio();const e=this.ensureAudioContext();if(!e)return;const i=await t.arrayBuffer(),s=await e.decodeAudioData(i),n=e.createBufferSource();n.buffer=s,n.loop=!0,this.sourceNode=n,this.setupAnalyser(n),n.start(0)},e.startMic=async function(){this.stopAudio();try{const t=await navigator.mediaDevices.getUserMedia({audio:!0});this.mediaStream=t;const e=this.ensureAudioContext();if(!e)return;const i=e.createMediaStreamSource(t);this.sourceNode=i,this.analyser=e.createAnalyser(),this.analyser.fftSize=2048,this.analyser.smoothingTimeConstant=.8,i.connect(this.analyser),this.frequencyData=new Uint8Array(this.analyser.frequencyBinCount),this.timeDomainData=new Uint8Array(this.analyser.fftSize),this.isPlaying=!0}catch(t){throw console.error("Microphone access denied:",t),t}},e.stopAudio=function(){if(this.isPlaying=!1,this.sourceNode){try{this.sourceNode.disconnect(),this.sourceNode instanceof AudioBufferSourceNode&&this.sourceNode.stop()}catch{}this.sourceNode=null}if(this.mediaStream&&(this.mediaStream.getTracks().forEach(t=>t.stop()),this.mediaStream=null),this.analyser){try{this.analyser.disconnect()}catch{}this.analyser=null}this.frequencyData=new Uint8Array(0),this.timeDomainData=new Uint8Array(0)},e.setMode=function(t){this.currentMode=t,this.terrainMesh&&(this.terrainMesh.visible="terrain"===t),this.radialGroup&&(this.radialGroup.visible="radial"===t),this.waveformMesh&&(this.waveformMesh.visible="waveform"===t);const e=this.cameraTargets[t];this.camera.position.copy(e.pos),this.controls.target.copy(e.target),this.controls.update()},e.buildTerrain=function(){const t=new n.bdM(40,40,127,127);t.rotateX(-Math.PI/2);const e=new n.BKk({vertexColors:!0,wireframe:!0,transparent:!0,uniforms:{uOpacity:{value:.85}},vertexShader:"\n        attribute vec3 customColor;\n        varying vec3 vColor;\n        void main() {\n          vColor = customColor;\n          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }\n      ",fragmentShader:"\n        uniform float uOpacity;\n        varying vec3 vColor;\n        void main() {\n          gl_FragColor = vec4(vColor, uOpacity);\n        }\n      "}),i=t.attributes.position.count,s=new Float32Array(3*i);for(let n=0;n<i;n++)s[3*n]=0,s[3*n+1]=.1,s[3*n+2]=.4;t.setAttribute("customColor",new n.THS(s,3)),this.terrainMesh=new n.eaF(t,e),this.scene.add(this.terrainMesh)},e.buildRadial=function(){this.radialGroup=new n.YJl,this.radialBars=[];for(let t=0;t<128;t++){const e=t/128*Math.PI*2,i=new n.iNn(.25,1,.25);i.translate(0,.5,0);const s=t/128,a=(new n.Q1f).setHSL(s,1,.5),o=new n._4j({color:a,emissive:a,emissiveIntensity:.6,roughness:.3,metalness:.5}),r=new n.eaF(i,o);r.position.x=8*Math.cos(e),r.position.z=8*Math.sin(e),r.lookAt(0,0,0),r.rotateX(Math.PI/2),this.radialBars.push(r),this.radialGroup.add(r)}this.scene.add(this.radialGroup)},e.buildWaveform=function(){const t=new n.bdM(30,3,256,4),e=new n.BKk({side:n.$EB,transparent:!0,uniforms:{uTime:{value:0},uIntensity:{value:1}},vertexShader:"\n        varying vec2 vUv;\n        varying float vDisplacement;\n        void main() {\n          vUv = uv;\n          vDisplacement = position.y;\n          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }\n      ",fragmentShader:"\n        uniform float uTime;\n        uniform float uIntensity;\n        varying vec2 vUv;\n        varying float vDisplacement;\n        void main() {\n          float d = abs(vDisplacement) * 0.5;\n          vec3 col1 = vec3(0.1, 0.3, 1.0);\n          vec3 col2 = vec3(1.0, 0.2, 0.8);\n          vec3 col3 = vec3(0.0, 1.0, 0.6);\n          vec3 color = mix(col1, col2, d);\n          color = mix(color, col3, sin(vUv.x * 6.28 + uTime) * 0.3 + 0.3);\n          float glow = exp(-d * 2.0) * uIntensity;\n          color += glow * 0.4;\n          float alpha = 0.6 + glow * 0.4;\n          gl_FragColor = vec4(color, alpha);\n        }\n      "});this.waveformMesh=new n.eaF(t,e),this.scene.add(this.waveformMesh)},e.updateTerrain=function(){if(!this.terrainMesh||0===this.frequencyData.length)return;const t=this.terrainMesh.geometry,e=t.attributes.position,i=t.attributes.customColor,s=128,n=this.frequencyData.length;for(let a=0;a<s;a++){const t=Math.floor(a/s*Math.min(n,512)),o=(this.frequencyData[t]||0)/255;for(let n=0;n<s;n++){const t=n*s+a,r=Math.abs(n-64)/64,h=1-r*r,c=8*o*h;e.setY(t,c);const l=o*h;let d,u,m;if(l<.5){const t=l/.5;d=0*t,u=.3+.7*t,m=1-.7*t}else{const t=(l-.5)/.5;d=1*t,u=1-.8*t,m=.3-.3*t}i.setXYZ(t,d,u,m)}}e.needsUpdate=!0,i.needsUpdate=!0},e.updateRadial=function(){if(!this.radialGroup||0===this.frequencyData.length)return;const t=this.radialBars.length,e=this.frequencyData.length;for(let i=0;i<t;i++){const s=Math.floor(i/t*Math.min(e,512)),n=(this.frequencyData[s]||0)/255,a=.2+12*n;this.radialBars[i].scale.y=a;this.radialBars[i].material.emissiveIntensity=.3+1.5*n}},e.updateWaveform=function(){if(!this.waveformMesh||0===this.timeDomainData.length)return;const t=this.waveformMesh.geometry.attributes.position,e=t.count;for(let i=0;i<257;i++){const s=Math.floor(i/257*this.timeDomainData.length),n=((this.timeDomainData[s]||128)-128)/128;for(let a=0;a<5;a++){const s=257*a+i;if(s>=e)continue;const o=1-Math.abs(a-2)/2;t.setY(s,4*n*o);const r=2*Math.sin(.05*i+.5*this.clock.getElapsedTime())*o;t.setZ(s,.6*(a-2)+.3*r)}}t.needsUpdate=!0},e.dispose=function(){this.disposed=!0,cancelAnimationFrame(this.animationId),window.removeEventListener("resize",this.onResize),this.stopAudio(),this.audioContext&&"closed"!==this.audioContext.state&&this.audioContext.close(),this.controls.dispose(),this.scene.traverse(t=>{t instanceof n.eaF&&(t.geometry.dispose(),Array.isArray(t.material)?t.material.forEach(t=>t.dispose()):t.material.dispose())}),this.renderer.domElement.removeEventListener("webglcontextlost",this.handleContextLost),this.renderer.domElement.removeEventListener("webglcontextrestored",this.handleContextRestored),this.renderer.dispose(),this.composer.dispose(),this.renderer.domElement.parentElement&&this.renderer.domElement.parentElement.removeChild(this.renderer.domElement)},(0,s.A)(t,[{key:"autoRotate",get:function(){return this._autoRotate},set:function(t){this._autoRotate=t,this.controls&&(this.controls.autoRotate=t)}},{key:"bloomStrength",get:function(){var t,e;return null!==(t=null===(e=this.bloomPass)||void 0===e?void 0:e.strength)&&void 0!==t?t:1.5},set:function(t){this.userBloomStrength=t,this.bloomPass&&(this.bloomPass.strength=t)}}])}()}}]);
//# sourceMappingURL=7954-787b70a78e77bc34e68e.js.map