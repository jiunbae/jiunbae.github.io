{"version":3,"file":"358-3b17d4edc943abbeca6f.js","mappings":"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","sources":["webpack://jiunbae.github.io/./src/views/ParticleGalaxy/scene.ts"],"sourcesContent":["import * as THREE from 'three'\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js'\nimport { EffectComposer } from 'three/examples/jsm/postprocessing/EffectComposer.js'\nimport { RenderPass } from 'three/examples/jsm/postprocessing/RenderPass.js'\nimport { UnrealBloomPass } from 'three/examples/jsm/postprocessing/UnrealBloomPass.js'\n\n/* -------------------------------------------------------------------------- */\n/*  Constants                                                                  */\n/* -------------------------------------------------------------------------- */\n\nconst PARTICLE_COUNT = 80_000\nconst NUM_ARMS = 4\nconst ARM_SPREAD = 0.45           // gaussian scatter width (radians)\nconst GALAXY_RADIUS = 40\nconst GALAXY_THICKNESS = 1.2\nconst CORE_RADIUS = 4\nconst BASE_ORBIT_SPEED = 0.08     // base angular velocity\nconst MAX_ATTRACTORS = 12\nconst ATTRACTOR_STRENGTH = 120\nconst ATTRACTOR_SOFTENING = 2.0   // prevent infinite force at zero distance\n\n/* -------------------------------------------------------------------------- */\n/*  Shaders                                                                    */\n/* -------------------------------------------------------------------------- */\n\nconst vertexShader = /* glsl */ `\n  uniform float uTime;\n  uniform float uPixelRatio;\n  uniform vec3  uAttractors[${MAX_ATTRACTORS}];\n  uniform int   uAttractorCount;\n  uniform float uAttractorStrength;\n  uniform float uAttractorSoftening;\n\n  attribute vec3  aVelocity;\n  attribute float aMass;\n  attribute float aOrbitSpeed;\n  attribute float aPhase;\n  attribute float aRadius;\n\n  varying vec3 vColor;\n  varying float vAlpha;\n\n  /* Convert speed magnitude to a star colour (black-body inspired) */\n  vec3 speedToColor(float speed) {\n    // Slow (red/orange) -> medium (yellow/white) -> fast (blue/white)\n    float t = clamp(speed * 3.0, 0.0, 1.0);\n    vec3 cold = vec3(1.0, 0.35, 0.15);   // cool red-orange\n    vec3 warm = vec3(1.0, 0.85, 0.5);    // warm yellow\n    vec3 hot  = vec3(0.6, 0.75, 1.0);    // hot blue-white\n    vec3 col = mix(cold, warm, smoothstep(0.0, 0.4, t));\n    col = mix(col, hot, smoothstep(0.4, 1.0, t));\n    return col;\n  }\n\n  void main() {\n    /* ---- orbital motion ---- */\n    float angle = aPhase + uTime * aOrbitSpeed;\n    float r = aRadius;\n\n    /* base spiral position */\n    vec3 pos;\n    pos.x = cos(angle) * r;\n    pos.z = sin(angle) * r;\n    pos.y = aVelocity.y; // stored vertical offset\n\n    /* add wobble from initial velocity */\n    pos.x += sin(uTime * aVelocity.x * 0.5 + aPhase) * 0.3;\n    pos.z += cos(uTime * aVelocity.z * 0.5 + aPhase) * 0.3;\n\n    /* ---- gravitational attractors ---- */\n    vec3 totalAccel = vec3(0.0);\n    for (int i = 0; i < ${MAX_ATTRACTORS}; i++) {\n      if (i >= uAttractorCount) break;\n      vec3 toAttractor = uAttractors[i] - pos;\n      float dist2 = dot(toAttractor, toAttractor) + uAttractorSoftening;\n      float force = uAttractorStrength / dist2;\n      totalAccel += normalize(toAttractor) * force;\n    }\n    pos += totalAccel * 0.02;\n\n    /* ---- velocity magnitude for colouring ---- */\n    float tangentialSpeed = aOrbitSpeed * r;\n    float attractorPull = length(totalAccel);\n    float speed = tangentialSpeed + attractorPull * 0.15;\n\n    vColor = speedToColor(speed);\n\n    /* brighter in core */\n    float coreBrightness = smoothstep(GALAXY_RADIUS, 0.0, r) * 0.4;\n    vColor += coreBrightness;\n\n    /* alpha: slightly fade outer particles */\n    vAlpha = 0.7 + 0.3 * smoothstep(GALAXY_RADIUS, 0.0, r);\n\n    /* ---- projection ---- */\n    vec4 mvPos = modelViewMatrix * vec4(pos, 1.0);\n    gl_Position = projectionMatrix * mvPos;\n\n    /* size: bigger when closer, smaller far away; mass affects size */\n    float baseSize = aMass * 1.8 + 0.8;\n    gl_PointSize = baseSize * uPixelRatio * (300.0 / -mvPos.z);\n    gl_PointSize = clamp(gl_PointSize, 0.5, 64.0);\n  }\n`\n\nconst fragmentShader = /* glsl */ `\n  varying vec3 vColor;\n  varying float vAlpha;\n\n  void main() {\n    /* soft glow point-sprite */\n    float d = length(gl_PointCoord - 0.5);\n    if (d > 0.5) discard;\n\n    /* gaussian-ish glow */\n    float intensity = exp(-d * d * 8.0);\n\n    /* add a bright core with soft halo */\n    float core = smoothstep(0.15, 0.0, d);\n    vec3 col = vColor * intensity + vec3(1.0) * core * 0.3;\n\n    float alpha = intensity * vAlpha;\n    gl_FragColor = vec4(col, alpha);\n  }\n`\n\n/* -------------------------------------------------------------------------- */\n/*  Scene class                                                                */\n/* -------------------------------------------------------------------------- */\n\nexport class ParticleGalaxyScene {\n  private renderer!: THREE.WebGLRenderer\n  private scene!: THREE.Scene\n  private camera!: THREE.PerspectiveCamera\n  private controls!: OrbitControls\n  private composer!: EffectComposer\n  private bloomPass!: UnrealBloomPass\n  private points!: THREE.Points\n  private material!: THREE.ShaderMaterial\n  private raycaster = new THREE.Raycaster()\n  private galaxyPlane!: THREE.Mesh\n  private clock = new THREE.Clock()\n  private animationId = 0\n  private disposed = false\n\n  private attractorPositions: THREE.Vector3[] = []\n\n  /* ---- public API ---- */\n\n  get autoRotate(): boolean {\n    return this.controls?.autoRotate ?? true\n  }\n  set autoRotate(v: boolean) {\n    if (this.controls) this.controls.autoRotate = v\n  }\n\n  get bloomStrength(): number {\n    return this.bloomPass?.strength ?? 1.5\n  }\n  set bloomStrength(v: number) {\n    if (this.bloomPass) this.bloomPass.strength = v\n  }\n\n  get particleCount(): number {\n    return PARTICLE_COUNT\n  }\n\n  get attractorCount(): number {\n    return this.attractorPositions.length\n  }\n\n  addAttractor(ndcX: number, ndcY: number) {\n    if (this.attractorPositions.length >= MAX_ATTRACTORS) return\n\n    const mouse = new THREE.Vector2(ndcX, ndcY)\n    this.raycaster.setFromCamera(mouse, this.camera)\n    const hits = this.raycaster.intersectObject(this.galaxyPlane)\n    if (hits.length === 0) return\n\n    const p = hits[0].point\n    this.attractorPositions.push(p.clone())\n    this.syncAttractorUniforms()\n  }\n\n  clearAttractors() {\n    this.attractorPositions = []\n    this.syncAttractorUniforms()\n  }\n\n  resetCamera() {\n    if (!this.camera || !this.controls) return\n    this.camera.position.set(0, 35, 45)\n    this.controls.target.set(0, 0, 0)\n    this.controls.update()\n  }\n\n  /* ---- lifecycle ---- */\n\n  constructor(private container: HTMLDivElement) {\n    this.init()\n    this.createGalaxy()\n    this.animate()\n  }\n\n  /* ---- initialisation ---- */\n\n  private init() {\n    const { clientWidth: w, clientHeight: h } = this.container\n\n    // Renderer\n    this.renderer = new THREE.WebGLRenderer({ antialias: false, alpha: false })\n    this.renderer.setSize(w, h)\n    this.renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2))\n    this.renderer.toneMapping = THREE.ACESFilmicToneMapping\n    this.renderer.toneMappingExposure = 1.0\n    this.container.appendChild(this.renderer.domElement)\n\n    this.renderer.domElement.addEventListener('webglcontextlost', this.handleContextLost)\n    this.renderer.domElement.addEventListener('webglcontextrestored', this.handleContextRestored)\n\n    // Scene\n    this.scene = new THREE.Scene()\n    this.scene.background = new THREE.Color(0x050510)\n    this.scene.fog = new THREE.FogExp2(0x050510, 0.006)\n\n    // Camera -- looking down at galaxy from an angle\n    this.camera = new THREE.PerspectiveCamera(55, w / h, 0.1, 500)\n    this.camera.position.set(0, 35, 45)\n\n    // Controls\n    this.controls = new OrbitControls(this.camera, this.renderer.domElement)\n    this.controls.enableDamping = true\n    this.controls.dampingFactor = 0.05\n    this.controls.autoRotate = true\n    this.controls.autoRotateSpeed = 0.3\n    this.controls.minDistance = 10\n    this.controls.maxDistance = 150\n    this.controls.maxPolarAngle = Math.PI / 2.05\n\n    // Post-processing\n    this.composer = new EffectComposer(this.renderer)\n    this.composer.addPass(new RenderPass(this.scene, this.camera))\n    this.bloomPass = new UnrealBloomPass(\n      new THREE.Vector2(w, h),\n      1.5,   // strength\n      0.6,   // radius\n      0.15   // threshold\n    )\n    this.composer.addPass(this.bloomPass)\n\n    // Invisible plane for raycast (galaxy disc)\n    const planeGeo = new THREE.PlaneGeometry(200, 200)\n    const planeMat = new THREE.MeshBasicMaterial({ visible: false })\n    this.galaxyPlane = new THREE.Mesh(planeGeo, planeMat)\n    this.galaxyPlane.rotation.x = -Math.PI / 2\n    this.scene.add(this.galaxyPlane)\n\n    window.addEventListener('resize', this.onResize)\n  }\n\n  /* ---- galaxy particle generation ---- */\n\n  private createGalaxy() {\n    const positions = new Float32Array(PARTICLE_COUNT * 3)\n    const velocities = new Float32Array(PARTICLE_COUNT * 3)\n    const masses = new Float32Array(PARTICLE_COUNT)\n    const orbitSpeeds = new Float32Array(PARTICLE_COUNT)\n    const phases = new Float32Array(PARTICLE_COUNT)\n    const radii = new Float32Array(PARTICLE_COUNT)\n\n    for (let i = 0; i < PARTICLE_COUNT; i++) {\n      // Pick a spiral arm\n      const arm = Math.floor(Math.random() * NUM_ARMS)\n      const armAngle = (arm / NUM_ARMS) * Math.PI * 2\n\n      // Radius: weighted toward centre (exponential distribution)\n      const t = Math.random()\n      const r = CORE_RADIUS + (GALAXY_RADIUS - CORE_RADIUS) * Math.pow(t, 0.6)\n\n      // Logarithmic spiral: angle increases with log(r)\n      const spiralAngle = armAngle + Math.log(1 + r) * 1.2\n\n      // Gaussian scatter around arm\n      const scatter = this.gaussianRandom() * ARM_SPREAD * (r / GALAXY_RADIUS + 0.3)\n      const angle = spiralAngle + scatter\n\n      // Vertical scatter (thin disc, thicker in core)\n      const heightScale = GALAXY_THICKNESS * (1.0 - 0.6 * (r / GALAXY_RADIUS))\n      const y = this.gaussianRandom() * heightScale * 0.5\n\n      // Position\n      positions[i * 3 + 0] = Math.cos(angle) * r\n      positions[i * 3 + 1] = y\n      positions[i * 3 + 2] = Math.sin(angle) * r\n\n      // Velocity (for wobble and colour, not true physics)\n      velocities[i * 3 + 0] = (Math.random() - 0.5) * 0.6\n      velocities[i * 3 + 1] = y // store vertical offset\n      velocities[i * 3 + 2] = (Math.random() - 0.5) * 0.6\n\n      // Mass (affects render size)\n      masses[i] = 0.3 + Math.random() * 0.7\n      // Bright core stars\n      if (r < CORE_RADIUS * 1.5) {\n        masses[i] += 0.3\n      }\n\n      // Orbit: Keplerian-ish -- inner stars orbit faster\n      orbitSpeeds[i] = BASE_ORBIT_SPEED / Math.sqrt(r * 0.5 + 1.0)\n\n      // Phase: the spiral angle is the starting phase\n      phases[i] = angle\n\n      // Radius\n      radii[i] = r\n    }\n\n    // Add some central bulge particles\n    const bulgeCount = Math.floor(PARTICLE_COUNT * 0.05)\n    for (let i = 0; i < bulgeCount; i++) {\n      const idx = i // overwrite first bulgeCount particles\n      const r = Math.random() * CORE_RADIUS\n      const angle = Math.random() * Math.PI * 2\n      const y = this.gaussianRandom() * GALAXY_THICKNESS * 0.8\n\n      positions[idx * 3 + 0] = Math.cos(angle) * r\n      positions[idx * 3 + 1] = y\n      positions[idx * 3 + 2] = Math.sin(angle) * r\n\n      velocities[idx * 3 + 1] = y\n      masses[idx] = 0.5 + Math.random() * 0.8\n      orbitSpeeds[idx] = BASE_ORBIT_SPEED * (0.5 + Math.random() * 1.5) / Math.sqrt(r + 1.0)\n      phases[idx] = angle\n      radii[idx] = r\n    }\n\n    const geo = new THREE.BufferGeometry()\n    geo.setAttribute('position', new THREE.BufferAttribute(positions, 3))\n    geo.setAttribute('aVelocity', new THREE.BufferAttribute(velocities, 3))\n    geo.setAttribute('aMass', new THREE.BufferAttribute(masses, 1))\n    geo.setAttribute('aOrbitSpeed', new THREE.BufferAttribute(orbitSpeeds, 1))\n    geo.setAttribute('aPhase', new THREE.BufferAttribute(phases, 1))\n    geo.setAttribute('aRadius', new THREE.BufferAttribute(radii, 1))\n\n    // Build the initial attractor uniform array (all zeros)\n    const attractorArray: THREE.Vector3[] = []\n    for (let i = 0; i < MAX_ATTRACTORS; i++) {\n      attractorArray.push(new THREE.Vector3(0, 0, 0))\n    }\n\n    this.material = new THREE.ShaderMaterial({\n      transparent: true,\n      depthWrite: false,\n      blending: THREE.AdditiveBlending,\n      uniforms: {\n        uTime: { value: 0 },\n        uPixelRatio: { value: Math.min(window.devicePixelRatio, 2) },\n        uAttractors: { value: attractorArray },\n        uAttractorCount: { value: 0 },\n        uAttractorStrength: { value: ATTRACTOR_STRENGTH },\n        uAttractorSoftening: { value: ATTRACTOR_SOFTENING },\n      },\n      vertexShader,\n      fragmentShader,\n      defines: {\n        GALAXY_RADIUS: GALAXY_RADIUS.toFixed(1),\n      },\n    })\n\n    this.points = new THREE.Points(geo, this.material)\n    this.scene.add(this.points)\n  }\n\n  private gaussianRandom(): number {\n    // Box-Muller transform\n    let u = 0\n    let v = 0\n    while (u === 0) u = Math.random()\n    while (v === 0) v = Math.random()\n    return Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v)\n  }\n\n  private syncAttractorUniforms() {\n    if (!this.material) return\n    const arr = this.material.uniforms.uAttractors.value as THREE.Vector3[]\n    for (let i = 0; i < MAX_ATTRACTORS; i++) {\n      if (i < this.attractorPositions.length) {\n        arr[i].copy(this.attractorPositions[i])\n      } else {\n        arr[i].set(0, 0, 0)\n      }\n    }\n    this.material.uniforms.uAttractorCount.value = this.attractorPositions.length\n  }\n\n  /* ---- animation loop ---- */\n\n  private handleContextLost = (e: Event) => {\n    e.preventDefault()\n    cancelAnimationFrame(this.animationId)\n    const overlay = document.createElement('div')\n    overlay.style.cssText = 'position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.8);color:#fff;font:14px/1.5 sans-serif;cursor:pointer;z-index:100'\n    overlay.textContent = 'WebGL context lost â€” click to reload'\n    overlay.addEventListener('click', () => location.reload())\n    this.container.style.position = 'relative'\n    this.container.appendChild(overlay)\n  }\n\n  private handleContextRestored = () => {\n    location.reload()\n  }\n\n  private animate = () => {\n    if (this.disposed) return\n    this.animationId = requestAnimationFrame(this.animate)\n\n    const elapsed = this.clock.getElapsedTime()\n    this.controls.update()\n\n    if (this.material) {\n      this.material.uniforms.uTime.value = elapsed\n    }\n\n    this.composer.render()\n  }\n\n  /* ---- resize ---- */\n\n  private onResize = () => {\n    if (this.disposed) return\n    const { clientWidth: w, clientHeight: h } = this.container\n    this.camera.aspect = w / h\n    this.camera.updateProjectionMatrix()\n    this.renderer.setSize(w, h)\n    this.composer.setSize(w, h)\n  }\n\n  /* ---- cleanup ---- */\n\n  dispose() {\n    this.disposed = true\n    cancelAnimationFrame(this.animationId)\n    window.removeEventListener('resize', this.onResize)\n    this.controls.dispose()\n\n    if (this.points) {\n      this.points.geometry.dispose()\n      ;(this.points.material as THREE.Material).dispose()\n    }\n\n    this.scene.traverse(child => {\n      if (child instanceof THREE.Mesh) {\n        child.geometry.dispose()\n        if (Array.isArray(child.material)) {\n          child.material.forEach(m => m.dispose())\n        } else {\n          child.material.dispose()\n        }\n      }\n    })\n\n    this.renderer.domElement.removeEventListener('webglcontextlost', this.handleContextLost)\n    this.renderer.domElement.removeEventListener('webglcontextrestored', this.handleContextRestored)\n    this.renderer.dispose()\n    this.composer.dispose()\n    if (this.renderer.domElement.parentElement) {\n      this.renderer.domElement.parentElement.removeChild(this.renderer.domElement)\n    }\n  }\n}\n"],"names":["PARTICLE_COUNT","ParticleGalaxyScene","container","raycaster","THREE","clock","animationId","disposed","attractorPositions","handleContextLost","e","preventDefault","cancelAnimationFrame","this","overlay","document","createElement","style","cssText","textContent","addEventListener","location","reload","position","appendChild","handleContextRestored","animate","requestAnimationFrame","elapsed","getElapsedTime","controls","update","material","uniforms","uTime","value","composer","render","onResize","clientWidth","w","clientHeight","h","camera","aspect","updateProjectionMatrix","renderer","setSize","init","createGalaxy","_proto","prototype","addAttractor","ndcX","ndcY","length","mouse","setFromCamera","hits","intersectObject","galaxyPlane","p","point","push","clone","syncAttractorUniforms","clearAttractors","resetCamera","set","target","antialias","alpha","setPixelRatio","Math","min","window","devicePixelRatio","toneMapping","toneMappingExposure","domElement","scene","background","fog","OrbitControls","enableDamping","dampingFactor","autoRotate","autoRotateSpeed","minDistance","maxDistance","maxPolarAngle","PI","EffectComposer","addPass","RenderPass","bloomPass","UnrealBloomPass","planeGeo","planeMat","visible","rotation","x","add","positions","Float32Array","velocities","masses","orbitSpeeds","phases","radii","i","armAngle","floor","random","t","r","pow","angle","log","gaussianRandom","heightScale","y","cos","sin","CORE_RADIUS","sqrt","bulgeCount","idx","geo","setAttribute","attractorArray","transparent","depthWrite","blending","uPixelRatio","uAttractors","uAttractorCount","uAttractorStrength","uAttractorSoftening","vertexShader","fragmentShader","defines","GALAXY_RADIUS","toFixed","points","u","v","arr","copy","dispose","removeEventListener","geometry","traverse","child","Array","isArray","forEach","m","parentElement","removeChild","_createClass","key","get","_this$controls$autoRo","_this$controls","_this$bloomPass$stren","_this$bloomPass","strength"],"sourceRoot":""}