"use strict";(self.webpackChunkjiunbae_github_io=self.webpackChunkjiunbae_github_io||[]).push([[2839],{2839:function(t,i,e){function s(t,i,e){return Math.max(i,Math.min(e,t))}function n(t){return Math.max(0,Math.min(255,Math.round(t)))}e.r(i),e.d(i,{WaveInterferenceEngine:function(){return h}});let h=function(){function t(t){this.imageData=null,this.pixels=null,this.w=1,this.h=1,this.dpr=1,this.lowW=1,this.lowH=1,this.resolution=4,this.frequency=1.2,this.wavelength=34,this.damping=.008,this.amplitude=1,this.palette="neon",this.running=!0,this.sources=[],this.time=0,this.lastTs=0,this.animationId=0,this.disposed=!1,this.dragSourceIndex=null,this.pointerId=null,this.resizeObserver=null,this.dirty=!0,this.sourceCountListener=null,this.maxSources=8,this.paletteSteps=1024,this.paletteLut=new Uint8ClampedArray(3*this.paletteSteps),this.attenuationLut=new Float32Array(0),this.attenuationMaxDist=0,this.sourceX=new Float32Array(this.maxSources),this.sourceY=new Float32Array(this.maxSources),this.sourcePhase=new Float32Array(this.maxSources),this.sourceStrength=new Float32Array(this.maxSources),this.animate=t=>{if(this.disposed)return;this.animationId=0,0===this.lastTs&&(this.lastTs=t);const i=Math.min(.05,(t-this.lastTs)/1e3);if(this.lastTs=t,this.running){this.time+=i*this.frequency*Math.PI*2;for(const t of this.sources)t.phase+=i*t.speed*this.frequency*2.3;this.dirty=!0}this.dirty&&(this.renderField(),this.dirty=!1),this.running||this.dirty?this.requestFrame():this.lastTs=0},this.onPointerDown=t=>{if(0!==t.button)return;const i=this.clientToWorld(t.clientX,t.clientY);if(!i)return;const e=this.findNearestSource(i.x,i.y,26);e>=0?this.dragSourceIndex=e:this.sources.length<this.maxSources?(this.sources.push(this.createSource(i.x,i.y)),this.dragSourceIndex=this.sources.length-1,this.notifySourceCountChanged(),this.markDirty()):this.dragSourceIndex=this.findNearestSource(i.x,i.y,1/0),this.pointerId=t.pointerId,this.canvas.setPointerCapture(t.pointerId)},this.onPointerMove=t=>{if(this.pointerId!==t.pointerId||null===this.dragSourceIndex)return;const i=this.clientToWorld(t.clientX,t.clientY);if(!i)return;const e=this.sources[this.dragSourceIndex];e&&(e.x=s(i.x,0,this.w),e.y=s(i.y,0,this.h),this.markDirty())},this.onPointerUp=t=>{this.pointerId===t.pointerId&&(this.dragSourceIndex=null,this.pointerId=null,this.canvas.hasPointerCapture(t.pointerId)&&this.canvas.releasePointerCapture(t.pointerId),this.markDirty())},this.onContextMenu=t=>{if(t.preventDefault(),this.sources.length<=1)return;const i=this.clientToWorld(t.clientX,t.clientY);if(!i)return;const e=this.findNearestSource(i.x,i.y,30);e>=0&&(this.sources.splice(e,1),null!==this.dragSourceIndex&&this.dragSourceIndex>=this.sources.length&&(this.dragSourceIndex=null),this.notifySourceCountChanged(),this.markDirty())},this.container=t,this.canvas=document.createElement("canvas"),this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.display="block",this.canvas.style.touchAction="none",t.appendChild(this.canvas);const i=this.canvas.getContext("2d");if(!i)throw new Error("Canvas 2D context is not available");this.ctx=i,this.bufferCanvas=document.createElement("canvas");const e=this.bufferCanvas.getContext("2d");if(!e)throw new Error("Offscreen 2D context is not available");this.bufferCtx=e,this.resizeCanvas(),this.rebuildPaletteLut(),this.resetSources(),this.initListeners(),this.requestFrame()}var i=t.prototype;return i.setRunning=function(t){this.running!==t&&(this.running=t,t||(this.lastTs=0),this.markDirty())},i.setFrequency=function(t){const i=s(t,.2,4);this.frequency!==i&&(this.frequency=i,this.markDirty())},i.setWavelength=function(t){const i=s(t,8,160);this.wavelength!==i&&(this.wavelength=i,this.markDirty())},i.setDamping=function(t){const i=s(t,0,.04);this.damping!==i&&(this.damping=i,this.rebuildAttenuationLut(),this.markDirty())},i.setAmplitude=function(t){const i=s(t,.2,3);this.amplitude!==i&&(this.amplitude=i,this.markDirty())},i.setResolution=function(t){const i=Math.round(s(t,2,12));i!==this.resolution&&(this.resolution=i,this.resizeBuffers(),this.markDirty())},i.setPalette=function(t){this.palette!==t&&(this.palette=t,this.rebuildPaletteLut(),this.markDirty())},i.setSourceCount=function(t){const i=Math.round(s(t,1,this.maxSources));if(i!==this.sources.length){if(i<this.sources.length)return this.sources.length=i,null!==this.dragSourceIndex&&this.dragSourceIndex>=i&&(this.dragSourceIndex=null),this.notifySourceCountChanged(),void this.markDirty();for(;this.sources.length<i;)this.sources.push(this.createSource(Math.random()*this.w,Math.random()*this.h));this.notifySourceCountChanged(),this.markDirty()}},i.getSourceCount=function(){return this.sources.length},i.setSourceCountListener=function(t){this.sourceCountListener=t,this.notifySourceCountChanged()},i.resetSources=function(){const t=.5*this.w,i=.5*this.h,e=Math.max(40,.24*Math.min(this.w,this.h));this.sources=[this.createSource(t-e,i+.15*e),this.createSource(t+e,i+.15*e),this.createSource(t,i-.85*e)],this.notifySourceCountChanged(),this.markDirty()},i.dispose=function(){var t;this.disposed=!0,this.sourceCountListener=null,0!==this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=0),null===(t=this.resizeObserver)||void 0===t||t.disconnect(),this.resizeObserver=null,this.canvas.removeEventListener("pointerdown",this.onPointerDown),window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("pointercancel",this.onPointerUp),this.canvas.removeEventListener("contextmenu",this.onContextMenu),this.canvas.parentElement&&this.canvas.parentElement.removeChild(this.canvas)},i.createSource=function(t,i){return{x:s(t,0,this.w),y:s(i,0,this.h),phase:Math.random()*Math.PI*2,speed:.6+1.4*Math.random(),strength:.85+.45*Math.random()}},i.renderField=function(){if(!this.imageData||!this.pixels)return;const t=this.sources.length,i=t>0?1/t:0,e=1/this.wavelength,n=this.attenuationLut,h=this.attenuationMaxDist,r=this.paletteLut,o=this.paletteSteps-1;for(let s=0;s<t;s++){const t=this.sources[s];this.sourceX[s]=t.x,this.sourceY[s]=t.y,this.sourcePhase[s]=t.phase-this.time,this.sourceStrength[s]=t.strength*this.amplitude}let a=0;for(let u=0;u<this.lowH;u++){const c=(u+.5)/this.lowH*this.h;for(let u=0;u<this.lowW;u++){const l=(u+.5)/this.lowW*this.w;let d=0;for(let i=0;i<t;i++){const t=l-this.sourceX[i],s=c-this.sourceY[i],r=Math.sqrt(t*t+s*s),o=n[Math.min(h,0|r)];d+=Math.sin(r*e+this.sourcePhase[i])*o*this.sourceStrength[i]}const f=s(d*i,-1,1),p=3*Math.round(.5*(f+1)*o);this.pixels[a++]=r[p],this.pixels[a++]=r[p+1],this.pixels[a++]=r[p+2],this.pixels[a++]=255}}this.bufferCtx.putImageData(this.imageData,0,0),this.ctx.imageSmoothingEnabled=!1,this.ctx.drawImage(this.bufferCanvas,0,0,this.w,this.h),this.drawSources()},i.samplePalette=function(t){const i=.5*(t+1);if("sunset"===this.palette){return[n(80+175*i),n(25+155*Math.pow(1-2*Math.abs(i-.5),.85)),n(28+130*(1-i))]}if("mono"===this.palette){const t=n(22+210*i);return[n(.9*t),n(.95*t),t]}return[n(30+220*Math.pow(i,1.1)),n(10+210*Math.pow(1-2*Math.abs(i-.5),.75)),n(75+170*Math.pow(1-i,.8))]},i.drawSources=function(){for(let t=0;t<this.sources.length;t++){const i=this.sources[t],e=5+1.5*Math.sin(2*this.time+t);this.ctx.beginPath(),this.ctx.arc(i.x,i.y,e+8,0,2*Math.PI),this.ctx.fillStyle="rgba(255, 255, 255, 0.08)",this.ctx.fill(),this.ctx.beginPath(),this.ctx.arc(i.x,i.y,e,0,2*Math.PI),this.ctx.fillStyle="rgba(255, 255, 255, 0.8)",this.ctx.fill(),this.ctx.beginPath(),this.ctx.arc(i.x,i.y,e+12,0,2*Math.PI),this.ctx.strokeStyle="rgba(255, 255, 255, 0.26)",this.ctx.lineWidth=1.2,this.ctx.stroke()}},i.resizeCanvas=function(){const t=this.container.getBoundingClientRect();this.w=Math.max(1,Math.floor(t.width)),this.h=Math.max(1,Math.floor(t.height)),this.dpr=Math.min(window.devicePixelRatio||1,2),this.canvas.width=Math.floor(this.w*this.dpr),this.canvas.height=Math.floor(this.h*this.dpr),this.ctx.setTransform(this.dpr,0,0,this.dpr,0,0),this.ctx.imageSmoothingEnabled=!1,this.resizeBuffers(),this.rebuildAttenuationLut();for(const i of this.sources)i.x=s(i.x,0,this.w),i.y=s(i.y,0,this.h);this.markDirty()},i.resizeBuffers=function(){this.lowW=Math.max(12,Math.ceil(this.w/this.resolution)),this.lowH=Math.max(12,Math.ceil(this.h/this.resolution)),this.bufferCanvas.width=this.lowW,this.bufferCanvas.height=this.lowH,this.imageData=this.bufferCtx.createImageData(this.lowW,this.lowH),this.pixels=this.imageData.data},i.rebuildPaletteLut=function(){for(let t=0;t<this.paletteSteps;t++){const i=t/(this.paletteSteps-1)*2-1,[e,s,n]=this.samplePalette(i),h=3*t;this.paletteLut[h]=e,this.paletteLut[h+1]=s,this.paletteLut[h+2]=n}},i.rebuildAttenuationLut=function(){this.attenuationMaxDist=Math.ceil(Math.sqrt(this.w*this.w+this.h*this.h))+2,this.attenuationLut=new Float32Array(this.attenuationMaxDist+1);for(let t=0;t<=this.attenuationMaxDist;t++)this.attenuationLut[t]=Math.exp(-t*this.damping)},i.markDirty=function(){this.dirty=!0,this.requestFrame()},i.requestFrame=function(){this.disposed||0!==this.animationId||(this.animationId=requestAnimationFrame(this.animate))},i.notifySourceCountChanged=function(){this.sourceCountListener&&this.sourceCountListener(this.sources.length)},i.initListeners=function(){this.resizeObserver=new ResizeObserver(()=>this.resizeCanvas()),this.resizeObserver.observe(this.container),this.canvas.addEventListener("pointerdown",this.onPointerDown),window.addEventListener("pointermove",this.onPointerMove),window.addEventListener("pointerup",this.onPointerUp),window.addEventListener("pointercancel",this.onPointerUp),this.canvas.addEventListener("contextmenu",this.onContextMenu)},i.clientToWorld=function(t,i){const e=this.canvas.getBoundingClientRect(),s=t-e.left,n=i-e.top;return s<0||n<0||s>=e.width||n>=e.height?null:{x:s/e.width*this.w,y:n/e.height*this.h}},i.findNearestSource=function(t,i,e){let s=e*e,n=-1;for(let h=0;h<this.sources.length;h++){const e=this.sources[h],r=e.x-t,o=e.y-i,a=r*r+o*o;a<=s&&(s=a,n=h)}return n},t}()}}]);
//# sourceMappingURL=2839-351fa55676cb541af47f.js.map